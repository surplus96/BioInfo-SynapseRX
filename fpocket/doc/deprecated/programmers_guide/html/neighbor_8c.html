<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>fpocket: neighbor.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<img src="fpocket_logo_small.png" width="545" height="150">
<!-- Generated by Doxygen 1.5.6 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>neighbor.c File Reference</h1><code>#include &quot;<a class="el" href="neighbor_8h-source.html">../headers/neighbor.h</a>&quot;</code><br>

<p>
<a href="neighbor_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structs__atm.html">s_atm</a> **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="neighbor_8c.html#48bd2094854cf343b3f75e93997bea04">get_mol_atm_neigh</a> (<a class="el" href="structs__atm.html">s_atm</a> **atoms, int natoms, <a class="el" href="structs__atm.html">s_atm</a> **all, int nall, float dcrit, int *nneigh)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structs__vvertice.html">s_vvertice</a> **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="neighbor_8c.html#7bed24829e9d106de97de75a5538199a">get_mol_vert_neigh</a> (<a class="el" href="structs__atm.html">s_atm</a> **atoms, int natoms, <a class="el" href="structs__vvertice.html">s_vvertice</a> **pvert, int nvert, float dcrit, int *nneigh)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structs__atm.html">s_atm</a> **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="neighbor_8c.html#60519bcf15270301f71419d124eb930c">get_mol_ctd_atm_neigh</a> (<a class="el" href="structs__atm.html">s_atm</a> **atoms, int natoms, <a class="el" href="structs__vvertice.html">s_vvertice</a> **pvert, int nvert, float vdcrit, int interface_search, int *nneigh)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="neighbor_8c.html#3740ecf8c19f6a9a230fc19553ec23ba">count_pocket_lig_vert_ovlp</a> (<a class="el" href="structs__atm.html">s_atm</a> **lig, int nlig, <a class="el" href="structs__vvertice.html">s_vvertice</a> **pvert, int nvert, float dcrit)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="neighbor_8c.html#72eb34a8654b78fc8fe8e64b8d49b31a">count_atm_prop_vert_neigh</a> (<a class="el" href="structs__atm.html">s_atm</a> **lig, int nlig, <a class="el" href="structs__vvertice.html">s_vvertice</a> **pvert, int nvert, float dcrit, int n_lig_molecules)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="neighbor_8c.html#1215d56fbeeaba7b178aec0cc1f922e7">count_vert_neigh_P</a> (<a class="el" href="structs__vvertice.html">s_vvertice</a> **pvert, int nvert, <a class="el" href="structs__vvertice.html">s_vvertice</a> **pvert_all, int nvert_all, float dcrit)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="neighbor_8c.html#2fa53fdb1334321a4ae1afb8748ef9fe">count_vert_neigh</a> (<a class="el" href="structs__vsort.html">s_vsort</a> *lsort, <a class="el" href="structs__vvertice.html">s_vvertice</a> **pvert, int nvert, float dcrit)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="72eb34a8654b78fc8fe8e64b8d49b31a"></a><!-- doxytag: member="neighbor.c::count_atm_prop_vert_neigh" ref="72eb34a8654b78fc8fe8e64b8d49b31a" args="(s_atm **lig, int nlig, s_vvertice **pvert, int nvert, float dcrit, int n_lig_molecules)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float count_atm_prop_vert_neigh           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs__atm.html">s_atm</a> **&nbsp;</td>
          <td class="paramname"> <em>lig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nlig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs__vvertice.html">s_vvertice</a> **&nbsp;</td>
          <td class="paramname"> <em>pvert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nvert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>dcrit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>n_lig_molecules</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
## FUNCTION: count_pocket_lig_vert_ovlp<p>
## SPECIFICATION: Return the proportion of atoms given in parameter that have at least one vertice that lies within dcrit A<p>
## PARAMETRES: @ <a class="el" href="structs__atm.html">s_atm</a> **lig : The molecule. @ int nlig : Number of atoms in the molecule @ <a class="el" href="structs__vvertice.html">s_vvertice</a> *pvert : List of vertices to check. @ int nvert : Number of verties (tipically in a given pocket) @ float dcrit : The distance criteria.s<p>
## RETURN: The proportion of atoms with dcrit A of at least 1 vertice. 
<p>Definition at line <a class="el" href="neighbor_8c-source.html#l00610">610</a> of file <a class="el" href="neighbor_8c-source.html">neighbor.c</a>.</p>

<p>References <a class="el" href="calc_8c-source.html#l00075">dist()</a>, <a class="el" href="sort_8c-source.html#l00328">free_s_vsort()</a>, <a class="el" href="sort_8c-source.html#l00086">get_sorted_list()</a>, <a class="el" href="sort_8h-source.html#l00053">M_VERTICE_TYPE</a>, <a class="el" href="sort_8h-source.html#l00076">s_vsort::nelem</a>, <a class="el" href="atom_8h-source.html#l00063">s_atm::res_id</a>, <a class="el" href="atom_8h-source.html#l00054">s_atm::sort_x</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::x</a>, <a class="el" href="atom_8h-source.html#l00056">s_atm::x</a>, <a class="el" href="sort_8h-source.html#l00075">s_vsort::xsort</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::y</a>, <a class="el" href="atom_8h-source.html#l00056">s_atm::y</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::z</a>, and <a class="el" href="atom_8h-source.html#l00056">s_atm::z</a>.</p>

<p>Referenced by <a class="el" href="tpocket_8c-source.html#l00661">check_pockets()</a>, and <a class="el" href="dpocket_8c-source.html#l00184">desc_pocket()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00612"></a>00612 {
<a name="l00613"></a>00613         <a class="code" href="structs__vsort.html">s_vsort</a> *lsort =  <a class="code" href="sort_8c.html#3afb407984fd4e83707cea780a621b48">get_sorted_list</a>(lig, nlig, pvert, nvert) ;
<a name="l00614"></a>00614         <a class="code" href="structs__vect__elem.html">s_vect_elem</a> *xsort = lsort-&gt;<a class="code" href="structs__vsort.html#fea6a2eedfb487567f7862273ba26d2c">xsort</a> ;
<a name="l00615"></a>00615 
<a name="l00616"></a>00616         <span class="keywordtype">int</span> ip, im, i,
<a name="l00617"></a>00617                 stopm, stopp,
<a name="l00618"></a>00618                 nb_neigh,
<a name="l00619"></a>00619                 sort_x,
<a name="l00620"></a>00620                 ntest_x,
<a name="l00621"></a>00621                 dim = lsort-&gt;<a class="code" href="structs__vsort.html#de445c6ef700258e18810d3cf0dd5c76">nelem</a> ;
<a name="l00622"></a>00622 
<a name="l00623"></a>00623         <span class="keywordtype">float</span> vvalx, vvaly, vvalz ;
<a name="l00624"></a>00624         <span class="keywordtype">int</span> multi_nb_neigh[n_lig_molecules];
<a name="l00625"></a>00625         <span class="keywordtype">int</span> multi_nb_lig_atoms[n_lig_molecules];
<a name="l00626"></a>00626         
<a name="l00627"></a>00627         <span class="keywordtype">int</span> c_lig_mol=0;
<a name="l00628"></a>00628         <span class="keywordtype">float</span> max_prop=0.0;
<a name="l00629"></a>00629         <span class="keywordtype">float</span> tmp=0.0;
<a name="l00630"></a>00630         <span class="keywordtype">char</span> chain_tmp[2];
<a name="l00631"></a>00631         <span class="keywordtype">int</span> resnumber_tmp;
<a name="l00632"></a>00632         strcpy(chain_tmp,lig[0]-&gt;chain);
<a name="l00633"></a>00633         resnumber_tmp = lig[0]-&gt;<a class="code" href="structs__atm.html#7c42c076ce151f4af210bef730b2b88f">res_id</a>;
<a name="l00634"></a>00634         
<a name="l00635"></a>00635         <a class="code" href="structs__vvertice.html">s_vvertice</a> *curvp = NULL, *curvm = NULL ;
<a name="l00636"></a>00636 
<a name="l00637"></a>00637         nb_neigh = 0 ;
<a name="l00638"></a>00638         multi_nb_neigh[0]=0;
<a name="l00639"></a>00639         multi_nb_lig_atoms[0]=0;
<a name="l00640"></a>00640         <span class="keywordflow">for</span>(i = 0 ; i &lt; nlig ; i++) {
<a name="l00641"></a>00641                 <span class="comment">/*check if we are in a new ligand molecule*/</span>
<a name="l00642"></a>00642                 <span class="keywordflow">if</span>(strcmp(chain_tmp,lig[i]-&gt;chain) !=0 || resnumber_tmp!=lig[i]-&gt;res_id){
<a name="l00643"></a>00643                     c_lig_mol++;
<a name="l00644"></a>00644                     strcpy(chain_tmp,lig[i]-&gt;chain);
<a name="l00645"></a>00645                     resnumber_tmp =lig[i]-&gt;<a class="code" href="structs__atm.html#7c42c076ce151f4af210bef730b2b88f">res_id</a>;
<a name="l00646"></a>00646                     multi_nb_neigh[c_lig_mol]=0;
<a name="l00647"></a>00647                     multi_nb_lig_atoms[c_lig_mol]=0;
<a name="l00648"></a>00648                 }
<a name="l00649"></a>00649                 multi_nb_lig_atoms[c_lig_mol]++;
<a name="l00650"></a>00650                 <a class="code" href="structs__atm.html">s_atm</a> *cur = lig[i] ;
<a name="l00651"></a>00651 
<a name="l00652"></a>00652         <span class="comment">/* Reinitialize variables */</span>
<a name="l00653"></a>00653                 stopm = 0; stopp = 0;
<a name="l00654"></a>00654                 sort_x = cur-&gt;<a class="code" href="structs__atm.html#05407d7638ff7f6fc210026306def9b5">sort_x</a> ;
<a name="l00655"></a>00655                 ntest_x = 1 ;
<a name="l00656"></a>00656                 vvalx = cur-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a> ; vvaly = cur-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a> ; vvalz = cur-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a> ;
<a name="l00657"></a>00657 
<a name="l00658"></a>00658         <span class="comment">/* Search neighbors */</span>
<a name="l00659"></a>00659                 <span class="keywordflow">while</span>(!stopm || !stopp) {
<a name="l00660"></a>00660                 <span class="comment">/* Do the neighbor search while we are in tab and we dont reach a</span>
<a name="l00661"></a>00661 <span class="comment">                 * distance up to our criteria */</span>
<a name="l00662"></a>00662                         ip = ntest_x + sort_x ;
<a name="l00663"></a>00663                         <span class="keywordflow">if</span>(ip &gt;= dim) stopp = 1 ;
<a name="l00664"></a>00664 
<a name="l00665"></a>00665                         <span class="keywordflow">if</span>(stopp == 0 &amp;&amp; xsort[ip].type == <a class="code" href="sort_8h.html#957ea96624166be576b450587c537518">M_VERTICE_TYPE</a>) {
<a name="l00666"></a>00666                                 curvp = (<a class="code" href="structs__vvertice.html">s_vvertice</a>*) xsort[ip].data ;
<a name="l00667"></a>00667 
<a name="l00668"></a>00668                                 <span class="keywordflow">if</span>(curvp-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a> - vvalx &gt; dcrit) stopp = 1 ;
<a name="l00669"></a>00669                                 <span class="keywordflow">else</span> {
<a name="l00670"></a>00670                                 <span class="comment">/* OK we have an atom which is near our vertice on X, so</span>
<a name="l00671"></a>00671 <span class="comment">                                 * calculate real distance */</span>
<a name="l00672"></a>00672                                         <span class="keywordflow">if</span>(<a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(curvp-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a>, curvp-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a>, curvp-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a>, vvalx, vvaly, vvalz) &lt; dcrit) {
<a name="l00673"></a>00673                                         <span class="comment">/* Distance OK, break the loop */</span>
<a name="l00674"></a>00674                                                 multi_nb_neigh[c_lig_mol]++;
<a name="l00675"></a>00675                                                 nb_neigh ++ ; break ;
<a name="l00676"></a>00676                                         }
<a name="l00677"></a>00677                                 }
<a name="l00678"></a>00678                         }
<a name="l00679"></a>00679 
<a name="l00680"></a>00680                         im = sort_x - ntest_x ;
<a name="l00681"></a>00681                         <span class="keywordflow">if</span>(im &lt; 0) stopm = 1 ;
<a name="l00682"></a>00682 
<a name="l00683"></a>00683                         <span class="keywordflow">if</span>(stopm == 0 &amp;&amp; xsort[im].type == <a class="code" href="sort_8h.html#957ea96624166be576b450587c537518">M_VERTICE_TYPE</a>) {
<a name="l00684"></a>00684                                 curvm = (<a class="code" href="structs__vvertice.html">s_vvertice</a>*) xsort[im].data ;
<a name="l00685"></a>00685 
<a name="l00686"></a>00686                                 <span class="keywordflow">if</span>(vvalx - curvm-&gt;x &gt; dcrit) stopm = 1 ;
<a name="l00687"></a>00687                                 <span class="keywordflow">else</span> {
<a name="l00688"></a>00688                                 <span class="comment">/* OK we have an atom which is near our vertice on X, so</span>
<a name="l00689"></a>00689 <span class="comment">                                 * calculate real distance */</span>
<a name="l00690"></a>00690                                         <span class="keywordflow">if</span>(<a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(curvm-&gt;x, curvm-&gt;y, curvm-&gt;z, vvalx, vvaly, vvalz) &lt; dcrit){
<a name="l00691"></a>00691                                         <span class="comment">/* Distance OK, see if the molecule is not one part of the</span>
<a name="l00692"></a>00692 <span class="comment">                                         * input, and if we have not already seen it. */</span>
<a name="l00693"></a>00693                                                 multi_nb_neigh[c_lig_mol]++;
<a name="l00694"></a>00694                                                 nb_neigh++ ; break ;
<a name="l00695"></a>00695                                         }
<a name="l00696"></a>00696                                 }
<a name="l00697"></a>00697                         }
<a name="l00698"></a>00698 
<a name="l00699"></a>00699                         ntest_x += 1 ;
<a name="l00700"></a>00700                 }
<a name="l00701"></a>00701         }
<a name="l00702"></a>00702         <span class="comment">/*get only the max proportion between overlap for different lig mols*/</span>
<a name="l00703"></a>00703         <span class="keywordflow">for</span>(i=0;i&lt;n_lig_molecules;i++){
<a name="l00704"></a>00704             tmp=(float)multi_nb_neigh[i]/(<span class="keywordtype">float</span>)multi_nb_lig_atoms[i];
<a name="l00705"></a>00705             <span class="keywordflow">if</span>(tmp&gt;max_prop) max_prop=tmp;
<a name="l00706"></a>00706         }
<a name="l00707"></a>00707         <a class="code" href="sort_8c.html#2d54fddd06b48f2e6ba36822ecbd499e">free_s_vsort</a>(lsort);
<a name="l00708"></a>00708         <span class="keywordflow">return</span> max_prop;
<a name="l00709"></a>00709 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="3740ecf8c19f6a9a230fc19553ec23ba"></a><!-- doxytag: member="neighbor.c::count_pocket_lig_vert_ovlp" ref="3740ecf8c19f6a9a230fc19553ec23ba" args="(s_atm **lig, int nlig, s_vvertice **pvert, int nvert, float dcrit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float count_pocket_lig_vert_ovlp           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs__atm.html">s_atm</a> **&nbsp;</td>
          <td class="paramname"> <em>lig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nlig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs__vvertice.html">s_vvertice</a> **&nbsp;</td>
          <td class="paramname"> <em>pvert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nvert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>dcrit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
## FUNCTION: count_pocket_lig_vert_ovlp<p>
## SPECIFICATION: Return the proportion of alpha sphere given in parameter that lies within dcrit A of the ligand -&gt; we loop on each ligand atom and we count the number of unique vertices next to each atoms using dist-crit.<p>
## PARAMETRES: @ <a class="el" href="structs__atm.html">s_atm</a> **lig : The molecule. @ int nlig : Number of atoms in the molecule @ <a class="el" href="structs__vvertice.html">s_vvertice</a> *pvert : List of vertices to check. @ int nvert : Number of verties (tipically in a given pocket) @ float dcrit : The distance criteria.s<p>
## RETURN: A tab of pointers to the neighbours. 
<p>Definition at line <a class="el" href="neighbor_8c-source.html#l00503">503</a> of file <a class="el" href="neighbor_8c-source.html">neighbor.c</a>.</p>

<p>References <a class="el" href="calc_8c-source.html#l00075">dist()</a>, <a class="el" href="sort_8c-source.html#l00328">free_s_vsort()</a>, <a class="el" href="sort_8c-source.html#l00086">get_sorted_list()</a>, <a class="el" href="sort_8h-source.html#l00053">M_VERTICE_TYPE</a>, <a class="el" href="sort_8h-source.html#l00076">s_vsort::nelem</a>, <a class="el" href="voronoi_8h-source.html#l00070">s_vvertice::seen</a>, <a class="el" href="atom_8h-source.html#l00054">s_atm::sort_x</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::x</a>, <a class="el" href="atom_8h-source.html#l00056">s_atm::x</a>, <a class="el" href="sort_8h-source.html#l00075">s_vsort::xsort</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::y</a>, <a class="el" href="atom_8h-source.html#l00056">s_atm::y</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::z</a>, and <a class="el" href="atom_8h-source.html#l00056">s_atm::z</a>.</p>

<p>Referenced by <a class="el" href="tpocket_8c-source.html#l00661">check_pockets()</a>, and <a class="el" href="dpocket_8c-source.html#l00184">desc_pocket()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00506"></a>00506 {
<a name="l00507"></a>00507         <a class="code" href="structs__vsort.html">s_vsort</a> *lsort =  <a class="code" href="sort_8c.html#3afb407984fd4e83707cea780a621b48">get_sorted_list</a>(lig, nlig, pvert, nvert) ;
<a name="l00508"></a>00508         <a class="code" href="structs__vect__elem.html">s_vect_elem</a> *xsort = lsort-&gt;<a class="code" href="structs__vsort.html#fea6a2eedfb487567f7862273ba26d2c">xsort</a> ;
<a name="l00509"></a>00509 
<a name="l00510"></a>00510         <span class="keywordtype">int</span> ip, im, i,
<a name="l00511"></a>00511                 stopm, stopp,
<a name="l00512"></a>00512                 nb_neigh,
<a name="l00513"></a>00513                 sort_x,
<a name="l00514"></a>00514                 ntest_x,
<a name="l00515"></a>00515                 dim = lsort-&gt;<a class="code" href="structs__vsort.html#de445c6ef700258e18810d3cf0dd5c76">nelem</a> ;
<a name="l00516"></a>00516 
<a name="l00517"></a>00517         <span class="keywordtype">float</span> vvalx, vvaly, vvalz ;
<a name="l00518"></a>00518         
<a name="l00519"></a>00519         <a class="code" href="structs__vvertice.html">s_vvertice</a> *ids[nvert] ;
<a name="l00520"></a>00520         <span class="keywordflow">for</span>(i = 0 ; i &lt; nvert ; i++) {
<a name="l00521"></a>00521                 pvert[i]-&gt;<a class="code" href="structs__vvertice.html#00f72ba072dc86c5e55096c2dace01f2">seen</a> = 0 ;
<a name="l00522"></a>00522                 ids[i] = NULL ;
<a name="l00523"></a>00523         }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525         <a class="code" href="structs__vvertice.html">s_vvertice</a> *curvp = NULL, *curvm = NULL ;
<a name="l00526"></a>00526 
<a name="l00527"></a>00527         nb_neigh = 0 ;
<a name="l00528"></a>00528         <span class="keywordflow">for</span>(i = 0 ; i &lt; nlig ; i++) {
<a name="l00529"></a>00529                 <a class="code" href="structs__atm.html">s_atm</a> *cur = lig[i] ;
<a name="l00530"></a>00530 
<a name="l00531"></a>00531         <span class="comment">/* Reinitialize variables */</span>
<a name="l00532"></a>00532                 stopm = 0; stopp = 0;
<a name="l00533"></a>00533                 sort_x = cur-&gt;<a class="code" href="structs__atm.html#05407d7638ff7f6fc210026306def9b5">sort_x</a> ;
<a name="l00534"></a>00534                 ntest_x = 1 ;
<a name="l00535"></a>00535                 vvalx = cur-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a> ; vvaly = cur-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a> ; vvalz = cur-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a> ;
<a name="l00536"></a>00536 
<a name="l00537"></a>00537         <span class="comment">/* Search neighbors */</span>
<a name="l00538"></a>00538                 <span class="keywordflow">while</span>(!stopm || !stopp) {
<a name="l00539"></a>00539                 <span class="comment">/* Do the neighbor search while wa are in tab and we dont reach a</span>
<a name="l00540"></a>00540 <span class="comment">                 * distance up to our criteria */</span>
<a name="l00541"></a>00541                         ip = ntest_x + sort_x ;
<a name="l00542"></a>00542                         <span class="keywordflow">if</span>(ip &gt;= dim) stopp = 1 ;
<a name="l00543"></a>00543 
<a name="l00544"></a>00544                         <span class="keywordflow">if</span>(stopp == 0 &amp;&amp; xsort[ip].type == <a class="code" href="sort_8h.html#957ea96624166be576b450587c537518">M_VERTICE_TYPE</a>) {
<a name="l00545"></a>00545                                 curvp = (<a class="code" href="structs__vvertice.html">s_vvertice</a>*) xsort[ip].data ;
<a name="l00546"></a>00546 
<a name="l00547"></a>00547                                 <span class="keywordflow">if</span>(curvp-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a> - vvalx &gt; dcrit) stopp = 1 ;
<a name="l00548"></a>00548                                 <span class="keywordflow">else</span> {
<a name="l00549"></a>00549                                 <span class="comment">/* OK we have an atom which is near our vertice on X, so</span>
<a name="l00550"></a>00550 <span class="comment">                                 * calculate real distance */</span>
<a name="l00551"></a>00551                                         <span class="keywordflow">if</span>(<a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(curvp-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a>, curvp-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a>, curvp-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a>, vvalx, vvaly, vvalz) &lt; dcrit) {
<a name="l00552"></a>00552                                         <span class="comment">/* Distance OK, see if the molecule have not been already seen. */</span>
<a name="l00553"></a>00553                                                 <span class="keywordflow">if</span>(! curvp-&gt;<a class="code" href="structs__vvertice.html#00f72ba072dc86c5e55096c2dace01f2">seen</a>) {
<a name="l00554"></a>00554                                                         ids[nb_neigh] = curvp ;
<a name="l00555"></a>00555                                                         curvp-&gt;<a class="code" href="structs__vvertice.html#00f72ba072dc86c5e55096c2dace01f2">seen</a> = 1 ;
<a name="l00556"></a>00556                                                         nb_neigh ++ ;
<a name="l00557"></a>00557                                                 }
<a name="l00558"></a>00558                                         }
<a name="l00559"></a>00559                                 }
<a name="l00560"></a>00560                         }
<a name="l00561"></a>00561 
<a name="l00562"></a>00562                         im = sort_x - ntest_x ;
<a name="l00563"></a>00563                         <span class="keywordflow">if</span>(im &lt; 0) stopm = 1 ;
<a name="l00564"></a>00564 
<a name="l00565"></a>00565                         <span class="keywordflow">if</span>(stopm == 0 &amp;&amp; xsort[im].type == <a class="code" href="sort_8h.html#957ea96624166be576b450587c537518">M_VERTICE_TYPE</a>) {
<a name="l00566"></a>00566                                 curvm = (<a class="code" href="structs__vvertice.html">s_vvertice</a>*) xsort[im].data ;
<a name="l00567"></a>00567 
<a name="l00568"></a>00568                                 <span class="keywordflow">if</span>(vvalx - curvm-&gt;x &gt; dcrit) stopm = 1 ;
<a name="l00569"></a>00569                                 <span class="keywordflow">else</span> {
<a name="l00570"></a>00570                                 <span class="comment">/* OK we have an atom which is near our vertice on X, so</span>
<a name="l00571"></a>00571 <span class="comment">                                 * calculate real distance */</span>
<a name="l00572"></a>00572                                         <span class="keywordflow">if</span>(<a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(curvm-&gt;x, curvm-&gt;y, curvm-&gt;z, vvalx, vvaly, vvalz) &lt; dcrit){
<a name="l00573"></a>00573                                         <span class="comment">/* Distance OK, see if the molecule is not one part of the</span>
<a name="l00574"></a>00574 <span class="comment">                                         * input, and if we have not already seen it. */</span>
<a name="l00575"></a>00575                                                 <span class="keywordflow">if</span>(!curvm-&gt;seen) {
<a name="l00576"></a>00576                                                         ids[nb_neigh] = curvm ;
<a name="l00577"></a>00577                                                         curvm-&gt;<a class="code" href="structs__vvertice.html#00f72ba072dc86c5e55096c2dace01f2">seen</a> = 1 ;
<a name="l00578"></a>00578                                                         nb_neigh ++ ;
<a name="l00579"></a>00579                                                 }
<a name="l00580"></a>00580                                         }
<a name="l00581"></a>00581                                 }
<a name="l00582"></a>00582                         }
<a name="l00583"></a>00583 
<a name="l00584"></a>00584                         ntest_x += 1 ;
<a name="l00585"></a>00585                 }
<a name="l00586"></a>00586         }
<a name="l00587"></a>00587 
<a name="l00588"></a>00588         <a class="code" href="sort_8c.html#2d54fddd06b48f2e6ba36822ecbd499e">free_s_vsort</a>(lsort) ;
<a name="l00589"></a>00589         <span class="keywordflow">return</span> (<span class="keywordtype">float</span>)nb_neigh/(float)nvert ;
<a name="l00590"></a>00590 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="2fa53fdb1334321a4ae1afb8748ef9fe"></a><!-- doxytag: member="neighbor.c::count_vert_neigh" ref="2fa53fdb1334321a4ae1afb8748ef9fe" args="(s_vsort *lsort, s_vvertice **pvert, int nvert, float dcrit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int count_vert_neigh           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs__vsort.html">s_vsort</a> *&nbsp;</td>
          <td class="paramname"> <em>lsort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs__vvertice.html">s_vvertice</a> **&nbsp;</td>
          <td class="paramname"> <em>pvert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nvert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>dcrit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
## FUNCTION: count_vert_neigh<p>
## SPECIFICATION: Count the number of vertices that lies within a distance &lt;= dist_crit from a list of query vertices. The user must provide the list of sorted vertices (that should include the query vertices and all other vertices to consider), the query vertices and the distance criteria.<p>
Note that if the query vertices are not present in the list of ordered vertices, the function will return 0.<p>
## PARAMETRES: @ <a class="el" href="structs__vsort.html">s_vsort</a> *lsort : List of sorted vertices. @ <a class="el" href="structs__vvertice.html">s_vvertice</a> **pvert : List of pointer to query vertices @ int nvert : Number of query vertices @ float dcrit : The distance criteria.<p>
## RETURN: int: The total number of vertices lying within dist_crit A of the query vertices 
<p>Definition at line <a class="el" href="neighbor_8c-source.html#l00770">770</a> of file <a class="el" href="neighbor_8c-source.html">neighbor.c</a>.</p>

<p>References <a class="el" href="sort_8h-source.html#l00065">s_vect_elem::data</a>, <a class="el" href="calc_8c-source.html#l00075">dist()</a>, <a class="el" href="sort_8h-source.html#l00076">s_vsort::nelem</a>, <a class="el" href="voronoi_8h-source.html#l00070">s_vvertice::seen</a>, <a class="el" href="voronoi_8h-source.html#l00080">s_vvertice::sort_x</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::x</a>, <a class="el" href="sort_8h-source.html#l00075">s_vsort::xsort</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::y</a>, and <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::z</a>.</p>

<p>Referenced by <a class="el" href="neighbor_8c-source.html#l00733">count_vert_neigh_P()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00771"></a>00771 {
<a name="l00772"></a>00772         <a class="code" href="structs__vect__elem.html">s_vect_elem</a> *xsort = lsort-&gt;<a class="code" href="structs__vsort.html#fea6a2eedfb487567f7862273ba26d2c">xsort</a> ;
<a name="l00773"></a>00773 
<a name="l00774"></a>00774         <a class="code" href="structs__vvertice.html">s_vvertice</a> *vcur = NULL ;
<a name="l00775"></a>00775 
<a name="l00776"></a>00776         <span class="keywordtype">int</span> ip, im, i,
<a name="l00777"></a>00777                 stopm, stopp,
<a name="l00778"></a>00778                 nb_neigh,
<a name="l00779"></a>00779                 sort_x,
<a name="l00780"></a>00780                 ntest_x,
<a name="l00781"></a>00781                 dim = lsort-&gt;<a class="code" href="structs__vsort.html#de445c6ef700258e18810d3cf0dd5c76">nelem</a> ;
<a name="l00782"></a>00782 
<a name="l00783"></a>00783         <span class="keywordtype">float</span> vvalx, vvaly, vvalz;
<a name="l00784"></a>00784 
<a name="l00785"></a>00785         <span class="comment">/* Set all vertices to NOT SEEN, except the query vertices */</span>
<a name="l00786"></a>00786         <span class="keywordflow">for</span>(i = 0 ; i &lt; dim ; i++) ((<a class="code" href="structs__vvertice.html">s_vvertice</a>*) lsort-&gt;<a class="code" href="structs__vsort.html#fea6a2eedfb487567f7862273ba26d2c">xsort</a>[i].<a class="code" href="structs__vect__elem.html#dee718cfa819e62df8d0025cfa0a0b77">data</a>)-&gt;seen = 0 ;
<a name="l00787"></a>00787         <span class="keywordflow">for</span>(i = 0 ; i &lt; nvert ; i++) pvert[i]-&gt;seen = 2 ;
<a name="l00788"></a>00788 
<a name="l00789"></a>00789         <a class="code" href="structs__vvertice.html">s_vvertice</a> *curvp = NULL, *curvm = NULL ;
<a name="l00790"></a>00790         nb_neigh = 0 ;
<a name="l00791"></a>00791         <span class="keywordflow">for</span>(i = 0 ; i &lt; nvert ; i++) {
<a name="l00792"></a>00792                 vcur = pvert[i] ;
<a name="l00793"></a>00793 
<a name="l00794"></a>00794                 <span class="comment">/* Reinitialize variables */</span>
<a name="l00795"></a>00795                 stopm = 0; stopp = 0;
<a name="l00796"></a>00796                 sort_x = vcur-&gt;<a class="code" href="structs__vvertice.html#a47fae81830953dca2c9262abc8ff876">sort_x</a> ;
<a name="l00797"></a>00797                 ntest_x = 1 ;
<a name="l00798"></a>00798                 vvalx = vcur-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a> ; vvaly = vcur-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a> ; vvalz = vcur-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a> ;
<a name="l00799"></a>00799 
<a name="l00800"></a>00800                 <span class="comment">/* Search neighbors */</span>
<a name="l00801"></a>00801                 <span class="keywordflow">while</span>(!stopm || !stopp) {
<a name="l00802"></a>00802                         <span class="comment">/* Do the neighbor search while wa are in tab and we dont reach a</span>
<a name="l00803"></a>00803 <span class="comment">                         * distance up to our criteria */</span>
<a name="l00804"></a>00804                         ip = ntest_x + sort_x ;
<a name="l00805"></a>00805 
<a name="l00806"></a>00806                         <span class="comment">/* Stop the search if we reach dim*/</span>
<a name="l00807"></a>00807                         <span class="keywordflow">if</span>(ip &gt;= dim) stopp = 1 ;
<a name="l00808"></a>00808 
<a name="l00809"></a>00809                         <span class="keywordflow">if</span>(stopp == 0) {
<a name="l00810"></a>00810                                 curvp = (<a class="code" href="structs__vvertice.html">s_vvertice</a>*) xsort[ip].data ;
<a name="l00811"></a>00811 
<a name="l00812"></a>00812                                 <span class="comment">/* Stop the search the distance on X is &gt; dcrit*/</span>
<a name="l00813"></a>00813                                 <span class="keywordflow">if</span>(curvp-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a> - vvalx &gt; dcrit) stopp = 1 ;
<a name="l00814"></a>00814                                 <span class="comment">/* Check if the current vertice has not already been counted */</span>
<a name="l00815"></a>00815                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(curvp-&gt;<a class="code" href="structs__vvertice.html#00f72ba072dc86c5e55096c2dace01f2">seen</a> == 0) {
<a name="l00816"></a>00816                                         <span class="keywordflow">if</span>(<a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(curvp-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a>, curvp-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a>, curvp-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a>, vvalx, vvaly, vvalz) &lt; dcrit) {
<a name="l00817"></a>00817                                                 <span class="comment">/* Distance OK, count and mark the vertice */</span>
<a name="l00818"></a>00818                                                 curvp-&gt;<a class="code" href="structs__vvertice.html#00f72ba072dc86c5e55096c2dace01f2">seen</a> = 1 ;
<a name="l00819"></a>00819                                                 nb_neigh ++ ;
<a name="l00820"></a>00820                                         }
<a name="l00821"></a>00821                                 }
<a name="l00822"></a>00822                         }
<a name="l00823"></a>00823 
<a name="l00824"></a>00824                         im = sort_x - ntest_x ;
<a name="l00825"></a>00825                         <span class="keywordflow">if</span>(im &lt; 0) stopm = 1 ;
<a name="l00826"></a>00826 
<a name="l00827"></a>00827                         <span class="keywordflow">if</span>(stopm == 0) {
<a name="l00828"></a>00828                                 curvm = (<a class="code" href="structs__vvertice.html">s_vvertice</a>*) xsort[im].data ;
<a name="l00829"></a>00829 
<a name="l00830"></a>00830                                 <span class="comment">/* Stop the search the distance on X is &gt; dcrit*/</span>
<a name="l00831"></a>00831                                 <span class="keywordflow">if</span>(vvalx - curvm-&gt;x &gt; dcrit) stopm = 1 ;
<a name="l00832"></a>00832                                 <span class="comment">/* Check if the current vertice has not already been counted */</span>
<a name="l00833"></a>00833                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(curvp-&gt;<a class="code" href="structs__vvertice.html#00f72ba072dc86c5e55096c2dace01f2">seen</a> == 0) {
<a name="l00834"></a>00834                                 <span class="comment">/* OK we have an atom which is near our vertice on X, so</span>
<a name="l00835"></a>00835 <span class="comment">                                 * calculate real distance */</span>
<a name="l00836"></a>00836                                         <span class="keywordflow">if</span>(<a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(curvm-&gt;x, curvm-&gt;y, curvm-&gt;z, vvalx, vvaly, vvalz) &lt; dcrit){
<a name="l00837"></a>00837                                                 <span class="comment">/* Distance OK, count and mark the vertice */</span>
<a name="l00838"></a>00838                                                 curvm-&gt;seen = 1 ;
<a name="l00839"></a>00839                                                 nb_neigh ++ ;
<a name="l00840"></a>00840                                         }
<a name="l00841"></a>00841                                 }
<a name="l00842"></a>00842                         }
<a name="l00843"></a>00843 
<a name="l00844"></a>00844                         ntest_x += 1 ;
<a name="l00845"></a>00845                 }
<a name="l00846"></a>00846         }
<a name="l00847"></a>00847 
<a name="l00848"></a>00848         <span class="keywordflow">return</span> nb_neigh ;
<a name="l00849"></a>00849 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="1215d56fbeeaba7b178aec0cc1f922e7"></a><!-- doxytag: member="neighbor.c::count_vert_neigh_P" ref="1215d56fbeeaba7b178aec0cc1f922e7" args="(s_vvertice **pvert, int nvert, s_vvertice **pvert_all, int nvert_all, float dcrit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int count_vert_neigh_P           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs__vvertice.html">s_vvertice</a> **&nbsp;</td>
          <td class="paramname"> <em>pvert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nvert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs__vvertice.html">s_vvertice</a> **&nbsp;</td>
          <td class="paramname"> <em>pvert_all</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nvert_all</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>dcrit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
## FUNCTION: count_vert_neigh_P<p>
## SPECIFICATION: Count the number of vertices that lies within a distance &lt;= dist_crit from a list of query vertices. The user must provide the query vertices, the full list of vertices to consider, and the distance criteria.<p>
## PARAMETRES: @ <a class="el" href="structs__vvertice.html">s_vvertice</a> *pvert : List of pointer to query vertices @ int nvert : Number of query vertices @ <a class="el" href="structs__vvertice.html">s_vvertice</a> *pvert_all : List of pointer to all vertice to consider @ int nvert_all : Total number of vertices to consider @ float dcrit : The distance criteria.<p>
## RETURN: int: The total number of vertices lying within dist_crit A of the query vertices 
<p>Definition at line <a class="el" href="neighbor_8c-source.html#l00733">733</a> of file <a class="el" href="neighbor_8c-source.html">neighbor.c</a>.</p>

<p>References <a class="el" href="neighbor_8c-source.html#l00770">count_vert_neigh()</a>, <a class="el" href="sort_8c-source.html#l00328">free_s_vsort()</a>, and <a class="el" href="sort_8c-source.html#l00086">get_sorted_list()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00736"></a>00736 {
<a name="l00737"></a>00737         <a class="code" href="structs__vsort.html">s_vsort</a> *lsort =  <a class="code" href="sort_8c.html#3afb407984fd4e83707cea780a621b48">get_sorted_list</a>(NULL, 0, pvert_all, nvert_all) ;
<a name="l00738"></a>00738         <span class="keywordtype">int</span> res = <a class="code" href="neighbor_8c.html#2fa53fdb1334321a4ae1afb8748ef9fe">count_vert_neigh</a>(lsort, pvert, nvert, dcrit) ;
<a name="l00739"></a>00739 
<a name="l00740"></a>00740         <a class="code" href="sort_8c.html#2d54fddd06b48f2e6ba36822ecbd499e">free_s_vsort</a>(lsort) ;
<a name="l00741"></a>00741         
<a name="l00742"></a>00742         <span class="keywordflow">return</span> res ;
<a name="l00743"></a>00743 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="48bd2094854cf343b3f75e93997bea04"></a><!-- doxytag: member="neighbor.c::get_mol_atm_neigh" ref="48bd2094854cf343b3f75e93997bea04" args="(s_atm **atoms, int natoms, s_atm **all, int nall, float dcrit, int *nneigh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structs__atm.html">s_atm</a>** get_mol_atm_neigh           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs__atm.html">s_atm</a> **&nbsp;</td>
          <td class="paramname"> <em>atoms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>natoms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs__atm.html">s_atm</a> **&nbsp;</td>
          <td class="paramname"> <em>all</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nall</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>dcrit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>nneigh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
## FUNCTION: get_mol_atm_neigh<p>
## SPECIFICATION: Return a list of pointer to the atoms situated a distance lower or equal to dcrit from a molecule represented by a list of atoms.<p>
This functon use a list of atoms that is sorted on the X dimension to accelerate the research.<p>
## PARAMETRES: @ <a class="el" href="structs__atm.html">s_atm</a> **atoms : The molecule atoms. @ int natoms : Number of atoms in the molecule @ <a class="el" href="structs__pdb.html">s_pdb</a> *pdb : The pdb structure containing all atoms of the system @ float dcrit : The distance criteria. @ int *nneigh : OUTPUT A pointer to the number of neighbour found, will be modified in the function...<p>
## RETURN: A tab of pointers to the neighbours, with the number of neighbors stored in nneigh 
<p>Definition at line <a class="el" href="neighbor_8c-source.html#l00090">90</a> of file <a class="el" href="neighbor_8c-source.html">neighbor.c</a>.</p>

<p>References <a class="el" href="calc_8c-source.html#l00075">dist()</a>, <a class="el" href="sort_8c-source.html#l00328">free_s_vsort()</a>, <a class="el" href="sort_8c-source.html#l00086">get_sorted_list()</a>, <a class="el" href="atom_8h-source.html#l00063">s_atm::id</a>, <a class="el" href="atom_8c-source.html#l00258">is_in_lst_atm()</a>, <a class="el" href="memhandler_8c-source.html#l00121">my_malloc()</a>, <a class="el" href="memhandler_8c-source.html#l00184">my_realloc()</a>, <a class="el" href="sort_8h-source.html#l00076">s_vsort::nelem</a>, <a class="el" href="atom_8h-source.html#l00054">s_atm::sort_x</a>, <a class="el" href="atom_8h-source.html#l00056">s_atm::x</a>, <a class="el" href="sort_8h-source.html#l00075">s_vsort::xsort</a>, <a class="el" href="atom_8h-source.html#l00056">s_atm::y</a>, and <a class="el" href="atom_8h-source.html#l00056">s_atm::z</a>.</p>

<p>Referenced by <a class="el" href="tpocket_8c-source.html#l00601">get_actual_pocket_DEPRECATED()</a>, and <a class="el" href="dpocket_8c-source.html#l00336">get_explicit_desc()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00092"></a>00092 {       
<a name="l00093"></a>00093         <span class="comment">/* No vertices, we only search atoms... */</span>
<a name="l00094"></a>00094         <a class="code" href="structs__vsort.html">s_vsort</a> *lsort =  <a class="code" href="sort_8c.html#3afb407984fd4e83707cea780a621b48">get_sorted_list</a>(all, nall, NULL, 0) ;
<a name="l00095"></a>00095         <a class="code" href="structs__vect__elem.html">s_vect_elem</a> *xsort = lsort-&gt;<a class="code" href="structs__vsort.html#fea6a2eedfb487567f7862273ba26d2c">xsort</a> ;
<a name="l00096"></a>00096 
<a name="l00097"></a>00097         <span class="keywordtype">int</span> ip, im,
<a name="l00098"></a>00098                 stopm, stopp,
<a name="l00099"></a>00099                 nb_neigh,
<a name="l00100"></a>00100                 sort_x,
<a name="l00101"></a>00101                 ntest_x,
<a name="l00102"></a>00102                 dim = lsort-&gt;<a class="code" href="structs__vsort.html#de445c6ef700258e18810d3cf0dd5c76">nelem</a> ;
<a name="l00103"></a>00103         
<a name="l00104"></a>00104         <span class="keywordtype">float</span> vvalx, vvaly, vvalz;
<a name="l00105"></a>00105         
<a name="l00106"></a>00106         <span class="keywordtype">int</span> real_size = 10,
<a name="l00107"></a>00107                 i, seen ;
<a name="l00108"></a>00108         
<a name="l00109"></a>00109         <a class="code" href="structs__atm.html">s_atm</a> *curap = NULL, *curam = NULL ;
<a name="l00110"></a>00110         <a class="code" href="structs__atm.html">s_atm</a> **neigh = (<a class="code" href="structs__atm.html">s_atm</a>**)<a class="code" href="memhandler_8c.html#52d7260a38c396cb2dd1dd7abcfd61cb">my_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structs__atm.html">s_atm</a>*)*real_size) ;
<a name="l00111"></a>00111         
<a name="l00112"></a>00112         nb_neigh = 0 ;
<a name="l00113"></a>00113         <span class="keywordflow">for</span>(i = 0 ; i &lt; natoms ; i++) {
<a name="l00114"></a>00114                 <a class="code" href="structs__atm.html">s_atm</a> *cur = atoms[i] ;
<a name="l00115"></a>00115         
<a name="l00116"></a>00116         <span class="comment">/* Reinitialize variables */</span>
<a name="l00117"></a>00117                 stopm = 0; stopp = 0;
<a name="l00118"></a>00118                 sort_x = cur-&gt;<a class="code" href="structs__atm.html#05407d7638ff7f6fc210026306def9b5">sort_x</a> ;
<a name="l00119"></a>00119                 ntest_x = 1 ;
<a name="l00120"></a>00120                 vvalx = cur-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a> ; vvaly = cur-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a> ; vvalz = cur-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a> ;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122         <span class="comment">/* Search neighbors */</span>
<a name="l00123"></a>00123                 <span class="keywordflow">while</span>(!stopm || !stopp) {
<a name="l00124"></a>00124                 <span class="comment">/* Do the neighbor search while wa are in tab and we dont reach a </span>
<a name="l00125"></a>00125 <span class="comment">                 * distance up to our criteria */</span>
<a name="l00126"></a>00126                         ip = ntest_x + sort_x ;
<a name="l00127"></a>00127                         <span class="keywordflow">if</span>(ip &gt;= dim) stopp = 1 ;
<a name="l00128"></a>00128         
<a name="l00129"></a>00129                         <span class="keywordflow">if</span>(stopp == 0) {
<a name="l00130"></a>00130                                 curap = (<a class="code" href="structs__atm.html">s_atm</a>*) xsort[ip].data ;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132                                 <span class="keywordflow">if</span>(curap-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a> - vvalx &gt; dcrit) stopp = 1 ;
<a name="l00133"></a>00133                                 <span class="keywordflow">else</span> {
<a name="l00134"></a>00134                                 <span class="comment">/* OK we have an atom which is near our vertice on X, so </span>
<a name="l00135"></a>00135 <span class="comment">                                 * calculate real distance */</span>
<a name="l00136"></a>00136                                         <span class="keywordflow">if</span>(<a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(curap-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a>, curap-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a>, curap-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a>, vvalx, vvaly, vvalz) &lt; dcrit) {
<a name="l00137"></a>00137                                         <span class="comment">/* Distance OK, see if the molecule is not one part of the </span>
<a name="l00138"></a>00138 <span class="comment">                                                input, and if we have not already seen it. */</span>
<a name="l00139"></a>00139                                                 seen = <a class="code" href="atom_8c.html#a72221368b25d51716e4d59f02a8d753">is_in_lst_atm</a>(atoms, natoms, curap-&gt;<a class="code" href="structs__atm.html#88237f06aa7a10cd6b382c19b800f230">id</a>) 
<a name="l00140"></a>00140                                                            + <a class="code" href="atom_8c.html#a72221368b25d51716e4d59f02a8d753">is_in_lst_atm</a>(neigh, nb_neigh, curap-&gt;<a class="code" href="structs__atm.html#88237f06aa7a10cd6b382c19b800f230">id</a>) ;
<a name="l00141"></a>00141                                                 <span class="keywordflow">if</span>(!seen) {
<a name="l00142"></a>00142                                                         <span class="keywordflow">if</span>(nb_neigh &gt;= real_size-1) {
<a name="l00143"></a>00143                                                                 real_size *= 2 ;
<a name="l00144"></a>00144                                                                 neigh =(<a class="code" href="structs__atm.html">s_atm</a>**) <a class="code" href="memhandler_8c.html#ede15d67c845c05e9b2bfb59b8ab6cf7">my_realloc</a>(neigh, <span class="keyword">sizeof</span>(<a class="code" href="structs__atm.html">s_atm</a>)*real_size) ;
<a name="l00145"></a>00145                                                         }
<a name="l00146"></a>00146                                                         neigh[nb_neigh] = curap ;
<a name="l00147"></a>00147                                                         nb_neigh ++ ;
<a name="l00148"></a>00148                                                 }
<a name="l00149"></a>00149                                         }
<a name="l00150"></a>00150                                 }
<a name="l00151"></a>00151                         }
<a name="l00152"></a>00152         
<a name="l00153"></a>00153                         im = sort_x - ntest_x ;
<a name="l00154"></a>00154                         <span class="keywordflow">if</span>(im &lt; 0) stopm = 1 ;
<a name="l00155"></a>00155 
<a name="l00156"></a>00156                         <span class="keywordflow">if</span>(stopm == 0) {
<a name="l00157"></a>00157                                 curam = (<a class="code" href="structs__atm.html">s_atm</a>*) xsort[im].data ;
<a name="l00158"></a>00158         
<a name="l00159"></a>00159                                 <span class="keywordflow">if</span>(vvalx - curam-&gt;x &gt; dcrit) stopm = 1 ;
<a name="l00160"></a>00160                                 <span class="keywordflow">else</span> {
<a name="l00161"></a>00161                                 <span class="comment">/* OK we have an atom which is near our vertice on X, so </span>
<a name="l00162"></a>00162 <span class="comment">                                 * calculate real distance */</span>
<a name="l00163"></a>00163                                         <span class="keywordflow">if</span>(<a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(curam-&gt;x, curam-&gt;y, curam-&gt;z, vvalx, vvaly, vvalz) &lt; dcrit){
<a name="l00164"></a>00164                                         <span class="comment">/* Distance OK, see if the molecule is not one part of the </span>
<a name="l00165"></a>00165 <span class="comment">                                                input, and if we have not already seen it. */</span>
<a name="l00166"></a>00166                                                 seen = <a class="code" href="atom_8c.html#a72221368b25d51716e4d59f02a8d753">is_in_lst_atm</a>(atoms, natoms, curam-&gt;<a class="code" href="structs__atm.html#88237f06aa7a10cd6b382c19b800f230">id</a>) 
<a name="l00167"></a>00167                                                            + <a class="code" href="atom_8c.html#a72221368b25d51716e4d59f02a8d753">is_in_lst_atm</a>(neigh, nb_neigh, curam-&gt;<a class="code" href="structs__atm.html#88237f06aa7a10cd6b382c19b800f230">id</a>) ;
<a name="l00168"></a>00168                                                 <span class="keywordflow">if</span>(!seen) {
<a name="l00169"></a>00169                                                         <span class="keywordflow">if</span>(nb_neigh &gt;= real_size-1) {
<a name="l00170"></a>00170                                                                 real_size *= 2 ;
<a name="l00171"></a>00171                                                                 neigh = (<a class="code" href="structs__atm.html">s_atm</a>**)<a class="code" href="memhandler_8c.html#ede15d67c845c05e9b2bfb59b8ab6cf7">my_realloc</a>(neigh, <span class="keyword">sizeof</span>(<a class="code" href="structs__atm.html">s_atm</a>)*real_size) ;
<a name="l00172"></a>00172                                                         }
<a name="l00173"></a>00173                                                         neigh[nb_neigh] = curam ;
<a name="l00174"></a>00174                                                         nb_neigh ++ ;
<a name="l00175"></a>00175                                                 }
<a name="l00176"></a>00176                                         }
<a name="l00177"></a>00177                                 }
<a name="l00178"></a>00178                         }
<a name="l00179"></a>00179                         
<a name="l00180"></a>00180                         ntest_x += 1 ;
<a name="l00181"></a>00181                 }
<a name="l00182"></a>00182         }
<a name="l00183"></a>00183         
<a name="l00184"></a>00184         *nneigh = nb_neigh ;
<a name="l00185"></a>00185         <a class="code" href="sort_8c.html#2d54fddd06b48f2e6ba36822ecbd499e">free_s_vsort</a>(lsort) ;
<a name="l00186"></a>00186 
<a name="l00187"></a>00187         <span class="keywordflow">return</span> neigh ;
<a name="l00188"></a>00188 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="60519bcf15270301f71419d124eb930c"></a><!-- doxytag: member="neighbor.c::get_mol_ctd_atm_neigh" ref="60519bcf15270301f71419d124eb930c" args="(s_atm **atoms, int natoms, s_vvertice **pvert, int nvert, float vdcrit, int interface_search, int *nneigh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structs__atm.html">s_atm</a>** get_mol_ctd_atm_neigh           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs__atm.html">s_atm</a> **&nbsp;</td>
          <td class="paramname"> <em>atoms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>natoms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs__vvertice.html">s_vvertice</a> **&nbsp;</td>
          <td class="paramname"> <em>pvert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nvert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>vdcrit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>interface_search</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>nneigh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
## FUNCTION: get_mol_ctd_atm_neigh<p>
## SPECIFICATION: Return a list of atoms contacted by voronoi vertices situated at dcrit of a given molecule represented by a list of its atoms.<p>
## PARAMETRES: @ <a class="el" href="structs__atm.html">s_atm</a> **atoms : The molecule. @ int natoms : Number of atoms in the molecule @ <a class="el" href="structs__lst__vvertice.html">s_lst_vvertice</a> *lvert : Full list of vertices present in the system @ float dcrit : The distance criteria. @ int interface_search : Perform an interface-type search ? @ int *nneigh : OUTPUT A pointer to the number of neighbour found, will be modified in the function...<p>
## RETURN: A tab of pointers to atoms describing the pocket. 
<p>Definition at line <a class="el" href="neighbor_8c-source.html#l00332">332</a> of file <a class="el" href="neighbor_8c-source.html">neighbor.c</a>.</p>

<p>References <a class="el" href="calc_8c-source.html#l00075">dist()</a>, <a class="el" href="sort_8c-source.html#l00328">free_s_vsort()</a>, <a class="el" href="sort_8c-source.html#l00086">get_sorted_list()</a>, <a class="el" href="neighbor_8h-source.html#l00052">M_INTERFACE_SEARCH_DIST</a>, <a class="el" href="sort_8h-source.html#l00053">M_VERTICE_TYPE</a>, <a class="el" href="memhandler_8c-source.html#l00121">my_malloc()</a>, <a class="el" href="memhandler_8c-source.html#l00184">my_realloc()</a>, <a class="el" href="voronoi_8h-source.html#l00084">s_vvertice::neigh</a>, <a class="el" href="sort_8h-source.html#l00076">s_vsort::nelem</a>, <a class="el" href="atom_8h-source.html#l00063">s_atm::seen</a>, <a class="el" href="atom_8h-source.html#l00054">s_atm::sort_x</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::x</a>, <a class="el" href="atom_8h-source.html#l00056">s_atm::x</a>, <a class="el" href="sort_8h-source.html#l00075">s_vsort::xsort</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::y</a>, <a class="el" href="atom_8h-source.html#l00056">s_atm::y</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::z</a>, and <a class="el" href="atom_8h-source.html#l00056">s_atm::z</a>.</p>

<p>Referenced by <a class="el" href="tpocket_8c-source.html#l00556">get_actual_pocket()</a>, and <a class="el" href="dpocket_8c-source.html#l00336">get_explicit_desc()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00335"></a>00335 {
<a name="l00336"></a>00336         <a class="code" href="structs__vsort.html">s_vsort</a> *lsort =  <a class="code" href="sort_8c.html#3afb407984fd4e83707cea780a621b48">get_sorted_list</a>(atoms, natoms, pvert, nvert) ;
<a name="l00337"></a>00337         <a class="code" href="structs__vect__elem.html">s_vect_elem</a> *xsort = lsort-&gt;<a class="code" href="structs__vsort.html#fea6a2eedfb487567f7862273ba26d2c">xsort</a> ;
<a name="l00338"></a>00338 
<a name="l00339"></a>00339         <span class="keywordtype">int</span> ip, im,                     <span class="comment">/* Current indexes in the tab (start at the current </span>
<a name="l00340"></a>00340 <span class="comment">                                                   atom position, and check the tab in each directions */</span>
<a name="l00341"></a>00341                 stopm, stopp,   <span class="comment">/* Say weteher the algorithm has to continue the search </span>
<a name="l00342"></a>00342 <span class="comment">                                                   in each direction */</span>
<a name="l00343"></a>00343                 nb_neigh = 0,
<a name="l00344"></a>00344                 sort_x = 0,             <span class="comment">/* Index of the current ligand atom in the sorted list.*/</span>
<a name="l00345"></a>00345                 ntest_x = 0,
<a name="l00346"></a>00346                 dim = lsort-&gt;<a class="code" href="structs__vsort.html#de445c6ef700258e18810d3cf0dd5c76">nelem</a>,
<a name="l00347"></a>00347                 real_size = 10,
<a name="l00348"></a>00348                 i, j ;
<a name="l00349"></a>00349 
<a name="l00350"></a>00350         <span class="keywordtype">float</span> lx, ly, lz;
<a name="l00351"></a>00351         
<a name="l00352"></a>00352         <a class="code" href="structs__vvertice.html">s_vvertice</a> *curvp = NULL, *curvm = NULL ;
<a name="l00353"></a>00353         <a class="code" href="structs__atm.html">s_atm</a> *curatm = NULL ;
<a name="l00354"></a>00354         <a class="code" href="structs__atm.html">s_atm</a> **neigh = (<a class="code" href="structs__atm.html">s_atm</a>**)<a class="code" href="memhandler_8c.html#52d7260a38c396cb2dd1dd7abcfd61cb">my_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structs__atm.html">s_atm</a>*)*real_size) ;
<a name="l00355"></a>00355 
<a name="l00356"></a>00356         <span class="keywordflow">for</span>(i = 0 ; i &lt; nvert ; i++) {
<a name="l00357"></a>00357                 <span class="keywordflow">for</span>(j = 0 ; j &lt; 4 ; j++) {
<a name="l00358"></a>00358                         pvert[i]-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[j]-&gt;<a class="code" href="structs__atm.html#46d588698400fc19733301d687cf98bd">seen</a> = 0 ;
<a name="l00359"></a>00359                 }
<a name="l00360"></a>00360         }
<a name="l00361"></a>00361 
<a name="l00362"></a>00362         <span class="keywordflow">for</span>(i = 0 ; i &lt; natoms ; i++) {
<a name="l00363"></a>00363                 <a class="code" href="structs__atm.html">s_atm</a> *cur = atoms[i] ;
<a name="l00364"></a>00364         
<a name="l00365"></a>00365         <span class="comment">/* Reinitialize variables */</span>
<a name="l00366"></a>00366                 stopm = 0; stopp = 0;           <span class="comment">/* We can search in each directions */</span>
<a name="l00367"></a>00367                 sort_x = cur-&gt;<a class="code" href="structs__atm.html#05407d7638ff7f6fc210026306def9b5">sort_x</a> ;          <span class="comment">/* Get the index of the current lidang atom </span>
<a name="l00368"></a>00368 <span class="comment">                                                                           in the sorted list. */</span>
<a name="l00369"></a>00369                 ntest_x = 1 ;
<a name="l00370"></a>00370 
<a name="l00371"></a>00371                 <span class="comment">/* Coordinates of the current atom of the ligand */</span>
<a name="l00372"></a>00372                 lx = cur-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a> ; ly = cur-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a> ; lz = cur-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a> ;
<a name="l00373"></a>00373 
<a name="l00374"></a>00374         <span class="comment">/* Search neighbors */</span>
<a name="l00375"></a>00375                 <span class="keywordflow">while</span>(!stopm || !stopp) {
<a name="l00376"></a>00376                 <span class="comment">/* Do the neighbor search while we are in tab and we dont reach a </span>
<a name="l00377"></a>00377 <span class="comment">                 * distance up to our criteria */</span>
<a name="l00378"></a>00378                         ip = ntest_x + sort_x ;
<a name="l00379"></a>00379                         
<a name="l00380"></a>00380                         <span class="comment">/* If we are out of the tab, stop the search in this direction */</span>
<a name="l00381"></a>00381                         <span class="keywordflow">if</span>(ip &gt;= dim) stopp = 1 ;       
<a name="l00382"></a>00382         
<a name="l00383"></a>00383                         <span class="keywordflow">if</span>(stopp == 0 &amp;&amp; xsort[ip].type == <a class="code" href="sort_8h.html#957ea96624166be576b450587c537518">M_VERTICE_TYPE</a>) {
<a name="l00384"></a>00384                                 curvp = (<a class="code" href="structs__vvertice.html">s_vvertice</a>*) xsort[ip].data ;
<a name="l00385"></a>00385                                 
<a name="l00386"></a>00386                                 <span class="comment">/* Stop when the distance reaches the criteria */</span>
<a name="l00387"></a>00387                                 <span class="keywordflow">if</span>(curvp-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a> - lx &gt; vdcrit) stopp = 1 ;
<a name="l00388"></a>00388                                 <span class="keywordflow">else</span> {
<a name="l00389"></a>00389                                 <span class="comment">/*OK we have a vertice which is near our atom on the X axe, </span>
<a name="l00390"></a>00390 <span class="comment">                                  so calculate real distance */</span>
<a name="l00391"></a>00391                                         <span class="keywordflow">if</span>(<a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(curvp-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a>, curvp-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a>, curvp-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a>, lx, ly, lz) &lt; vdcrit) {
<a name="l00392"></a>00392                                         <span class="comment">/* If the distance from the atom to the vertice is small enough*/</span>
<a name="l00393"></a>00393                                                 <span class="keywordflow">for</span>(j = 0 ; j &lt; 4 ; j++) {
<a name="l00394"></a>00394                                                         curatm = curvp-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[j] ;
<a name="l00395"></a>00395                                                         <span class="keywordflow">if</span>(! curatm-&gt;<a class="code" href="structs__atm.html#46d588698400fc19733301d687cf98bd">seen</a>) {
<a name="l00396"></a>00396                                                                 <span class="keywordflow">if</span>(interface_search &amp;&amp; 
<a name="l00397"></a>00397                                                                 <a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(curatm-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a>, curatm-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a>, curatm-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a>, lx, ly, lz) 
<a name="l00398"></a>00398                                                                                 &lt; <a class="code" href="neighbor_8h.html#3db317405b27a1c423003ae4d7ac5b31">M_INTERFACE_SEARCH_DIST</a>) {
<a name="l00399"></a>00399                                                                 <span class="comment">/* If we have not seen yet this atom and if he </span>
<a name="l00400"></a>00400 <span class="comment">                                                                 * is not too far away from the ligand, add it*/</span>
<a name="l00401"></a>00401                                                                         <span class="keywordflow">if</span>(nb_neigh &gt;= real_size-1) {
<a name="l00402"></a>00402                                                                                 real_size *= 2 ;
<a name="l00403"></a>00403                                                                                 neigh = (<a class="code" href="structs__atm.html">s_atm</a>**)<a class="code" href="memhandler_8c.html#ede15d67c845c05e9b2bfb59b8ab6cf7">my_realloc</a>(neigh, <span class="keyword">sizeof</span>(<a class="code" href="structs__atm.html">s_atm</a>)*real_size) ;
<a name="l00404"></a>00404                                                                         }
<a name="l00405"></a>00405                                                                         neigh[nb_neigh] = curatm ;
<a name="l00406"></a>00406                                                                         curatm-&gt;<a class="code" href="structs__atm.html#46d588698400fc19733301d687cf98bd">seen</a> = 1 ;
<a name="l00407"></a>00407                                                                         nb_neigh ++ ;
<a name="l00408"></a>00408                                                                 }
<a name="l00409"></a>00409                                                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!interface_search) {
<a name="l00410"></a>00410                                                                 <span class="comment">/* If we have not seen yet this atom and if he </span>
<a name="l00411"></a>00411 <span class="comment">                                                                 * is not too far away from the ligand, add it*/</span>
<a name="l00412"></a>00412                                                                         <span class="keywordflow">if</span>(nb_neigh &gt;= real_size-1) {
<a name="l00413"></a>00413                                                                                 real_size *= 2 ;
<a name="l00414"></a>00414                                                                                 neigh = (<a class="code" href="structs__atm.html">s_atm</a>**)<a class="code" href="memhandler_8c.html#ede15d67c845c05e9b2bfb59b8ab6cf7">my_realloc</a>(neigh, <span class="keyword">sizeof</span>(<a class="code" href="structs__atm.html">s_atm</a>)*real_size) ;
<a name="l00415"></a>00415                                                                         }
<a name="l00416"></a>00416                                                                         curatm-&gt;<a class="code" href="structs__atm.html#46d588698400fc19733301d687cf98bd">seen</a> = 1 ;
<a name="l00417"></a>00417                                                                         neigh[nb_neigh] = curatm ;
<a name="l00418"></a>00418                                                                         nb_neigh ++ ;
<a name="l00419"></a>00419                                                                 }
<a name="l00420"></a>00420                                                         } 
<a name="l00421"></a>00421                                                 }
<a name="l00422"></a>00422                                         }
<a name="l00423"></a>00423                                 }
<a name="l00424"></a>00424                         }
<a name="l00425"></a>00425         
<a name="l00426"></a>00426                         im = sort_x - ntest_x ;
<a name="l00427"></a>00427                         <span class="comment">/* If we are out of the tab, stop the search in this direction */</span>
<a name="l00428"></a>00428                         <span class="keywordflow">if</span>(im &lt; 0) stopm = 1 ;          
<a name="l00429"></a>00429 
<a name="l00430"></a>00430                         <span class="keywordflow">if</span>(stopm == 0 &amp;&amp; xsort[im].type == <a class="code" href="sort_8h.html#957ea96624166be576b450587c537518">M_VERTICE_TYPE</a>) {
<a name="l00431"></a>00431                                 curvm = (<a class="code" href="structs__vvertice.html">s_vvertice</a>*) xsort[im].data ;
<a name="l00432"></a>00432         
<a name="l00433"></a>00433                                 <span class="keywordflow">if</span>(lx - curvm-&gt;x &gt; vdcrit) stopm = 1 ;
<a name="l00434"></a>00434                                 <span class="keywordflow">else</span> {
<a name="l00435"></a>00435                                 <span class="comment">/* OK we have a vertice which is near our atom on the X axe, </span>
<a name="l00436"></a>00436 <span class="comment">                                 * so calculate real distance*/</span>
<a name="l00437"></a>00437                                         <span class="keywordflow">if</span>(<a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(curvm-&gt;x, curvm-&gt;y, curvm-&gt;z, lx, ly, lz) &lt; vdcrit) {
<a name="l00438"></a>00438                                         <span class="comment">/* If the distance from the atom to the vertice is small enough */</span>
<a name="l00439"></a>00439                                                 <span class="keywordflow">for</span>(j = 0 ; j &lt; 4 ; j++) {
<a name="l00440"></a>00440                                                         curatm = curvm-&gt;neigh[j] ;
<a name="l00441"></a>00441                                                         <span class="keywordflow">if</span>(! curatm-&gt;<a class="code" href="structs__atm.html#46d588698400fc19733301d687cf98bd">seen</a>) {
<a name="l00442"></a>00442                                                                 <span class="keywordflow">if</span>(interface_search &amp;&amp; 
<a name="l00443"></a>00443                                                                 <a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(curatm-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a>, curatm-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a>, curatm-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a>, lx, ly, lz) 
<a name="l00444"></a>00444                                                                                 &lt; <a class="code" href="neighbor_8h.html#3db317405b27a1c423003ae4d7ac5b31">M_INTERFACE_SEARCH_DIST</a>) { 
<a name="l00445"></a>00445                                                                 <span class="comment">/* If we have not seen yet this atom and if he </span>
<a name="l00446"></a>00446 <span class="comment">                                                                 * is not too far away from the ligand, add it */</span>
<a name="l00447"></a>00447                                                                         <span class="keywordflow">if</span>(nb_neigh &gt;= real_size-1) {
<a name="l00448"></a>00448                                                                                 real_size *= 2 ;
<a name="l00449"></a>00449                                                                                 neigh = (<a class="code" href="structs__atm.html">s_atm</a>**)
<a name="l00450"></a>00450                                                                                 <a class="code" href="memhandler_8c.html#ede15d67c845c05e9b2bfb59b8ab6cf7">my_realloc</a>(neigh, <span class="keyword">sizeof</span>(<a class="code" href="structs__atm.html">s_atm</a>)*real_size) ;
<a name="l00451"></a>00451                                                                         }
<a name="l00452"></a>00452                                                                         curatm-&gt;<a class="code" href="structs__atm.html#46d588698400fc19733301d687cf98bd">seen</a> = 1 ;
<a name="l00453"></a>00453                                                                         neigh[nb_neigh] = curatm ;
<a name="l00454"></a>00454                                                                         nb_neigh ++ ;
<a name="l00455"></a>00455                                                                 }
<a name="l00456"></a>00456                                                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!interface_search) {
<a name="l00457"></a>00457                                                                 <span class="comment">/* If we have not seen yet this atom and if he </span>
<a name="l00458"></a>00458 <span class="comment">                                                                 * is not too far away from the ligand, add it */</span>
<a name="l00459"></a>00459                                                                         <span class="keywordflow">if</span>(nb_neigh &gt;= real_size-1) {
<a name="l00460"></a>00460                                                                                 real_size *= 2 ;
<a name="l00461"></a>00461                                                                                 neigh = (<a class="code" href="structs__atm.html">s_atm</a>**)<a class="code" href="memhandler_8c.html#ede15d67c845c05e9b2bfb59b8ab6cf7">my_realloc</a>(neigh, <span class="keyword">sizeof</span>(<a class="code" href="structs__atm.html">s_atm</a>)*real_size) ;
<a name="l00462"></a>00462                                                                         }
<a name="l00463"></a>00463                                                                         curatm-&gt;<a class="code" href="structs__atm.html#46d588698400fc19733301d687cf98bd">seen</a> = 1 ;
<a name="l00464"></a>00464                                                                         neigh[nb_neigh] = curatm ;
<a name="l00465"></a>00465                                                                         nb_neigh ++ ;
<a name="l00466"></a>00466                                                                 }
<a name="l00467"></a>00467                                                         } 
<a name="l00468"></a>00468                                                 }
<a name="l00469"></a>00469                                         }
<a name="l00470"></a>00470                                 }
<a name="l00471"></a>00471                         }
<a name="l00472"></a>00472                         
<a name="l00473"></a>00473                         ntest_x += 1 ;
<a name="l00474"></a>00474                 }
<a name="l00475"></a>00475         }
<a name="l00476"></a>00476         
<a name="l00477"></a>00477         *nneigh = nb_neigh ;
<a name="l00478"></a>00478         <a class="code" href="sort_8c.html#2d54fddd06b48f2e6ba36822ecbd499e">free_s_vsort</a>(lsort) ;
<a name="l00479"></a>00479 
<a name="l00480"></a>00480         <span class="keywordflow">return</span> neigh ;
<a name="l00481"></a>00481 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="7bed24829e9d106de97de75a5538199a"></a><!-- doxytag: member="neighbor.c::get_mol_vert_neigh" ref="7bed24829e9d106de97de75a5538199a" args="(s_atm **atoms, int natoms, s_vvertice **pvert, int nvert, float dcrit, int *nneigh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structs__vvertice.html">s_vvertice</a>** get_mol_vert_neigh           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs__atm.html">s_atm</a> **&nbsp;</td>
          <td class="paramname"> <em>atoms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>natoms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs__vvertice.html">s_vvertice</a> **&nbsp;</td>
          <td class="paramname"> <em>pvert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nvert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>dcrit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>nneigh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
## FUNCTION: get_mol_vert_neigh<p>
## SPECIFICATION: Return a list of pointer to the vertices situated a distance lower or equal to dcrit of a molecule represented by it's list of atoms.<p>
This functon use a list of atoms that is sorted on the X dimension to accelerate the research.<p>
## PARAMETRES: @ <a class="el" href="structs__atm.html">s_atm</a> **atoms : The molecule. @ int natoms : Number of atoms in the molecule @ <a class="el" href="structs__lst__vvertice.html">s_lst_vvertice</a> *lvert : Full list of vertices present in the system @ float dcrit : The distance criteria. @ int *nneigh : OUTPUT A pointer to the number of neighbour found, will be modified in the function...<p>
## RETURN: A tab of pointers to the neighbours. 
<p>Definition at line <a class="el" href="neighbor_8c-source.html#l00213">213</a> of file <a class="el" href="neighbor_8c-source.html">neighbor.c</a>.</p>

<p>References <a class="el" href="calc_8c-source.html#l00075">dist()</a>, <a class="el" href="sort_8c-source.html#l00328">free_s_vsort()</a>, <a class="el" href="sort_8c-source.html#l00086">get_sorted_list()</a>, <a class="el" href="voronoi_8h-source.html#l00070">s_vvertice::id</a>, <a class="el" href="voronoi_8c-source.html#l00567">is_in_lst_vert()</a>, <a class="el" href="sort_8h-source.html#l00053">M_VERTICE_TYPE</a>, <a class="el" href="memhandler_8c-source.html#l00121">my_malloc()</a>, <a class="el" href="memhandler_8c-source.html#l00184">my_realloc()</a>, <a class="el" href="sort_8h-source.html#l00076">s_vsort::nelem</a>, <a class="el" href="atom_8h-source.html#l00054">s_atm::sort_x</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::x</a>, <a class="el" href="atom_8h-source.html#l00056">s_atm::x</a>, <a class="el" href="sort_8h-source.html#l00075">s_vsort::xsort</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::y</a>, <a class="el" href="atom_8h-source.html#l00056">s_atm::y</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::z</a>, and <a class="el" href="atom_8h-source.html#l00056">s_atm::z</a>.</p>

<p>Referenced by <a class="el" href="dpocket_8c-source.html#l00336">get_explicit_desc()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00216"></a>00216 {       
<a name="l00217"></a>00217         <a class="code" href="structs__vsort.html">s_vsort</a> *lsort =  <a class="code" href="sort_8c.html#3afb407984fd4e83707cea780a621b48">get_sorted_list</a>(atoms, natoms, pvert, nvert) ;
<a name="l00218"></a>00218         <a class="code" href="structs__vect__elem.html">s_vect_elem</a> *xsort = lsort-&gt;<a class="code" href="structs__vsort.html#fea6a2eedfb487567f7862273ba26d2c">xsort</a> ;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220         <span class="keywordtype">int</span> ip, im,
<a name="l00221"></a>00221                 stopm, stopp,
<a name="l00222"></a>00222                 nb_neigh,
<a name="l00223"></a>00223                 sort_x,
<a name="l00224"></a>00224                 ntest_x,
<a name="l00225"></a>00225                 dim = lsort-&gt;<a class="code" href="structs__vsort.html#de445c6ef700258e18810d3cf0dd5c76">nelem</a> ;
<a name="l00226"></a>00226         
<a name="l00227"></a>00227         <span class="keywordtype">float</span> vvalx, vvaly, vvalz;
<a name="l00228"></a>00228         
<a name="l00229"></a>00229         <span class="keywordtype">int</span> real_size = 10,
<a name="l00230"></a>00230                 i, seen ;
<a name="l00231"></a>00231         
<a name="l00232"></a>00232         <a class="code" href="structs__vvertice.html">s_vvertice</a> *curvp = NULL, *curvm = NULL ;
<a name="l00233"></a>00233         <a class="code" href="structs__vvertice.html">s_vvertice</a> **neigh = (<a class="code" href="structs__vvertice.html">s_vvertice</a>**)<a class="code" href="memhandler_8c.html#52d7260a38c396cb2dd1dd7abcfd61cb">my_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structs__vvertice.html">s_vvertice</a>*)*real_size) ;
<a name="l00234"></a>00234         
<a name="l00235"></a>00235         nb_neigh = 0 ;
<a name="l00236"></a>00236         <span class="keywordflow">for</span>(i = 0 ; i &lt; natoms ; i++) {
<a name="l00237"></a>00237                 <a class="code" href="structs__atm.html">s_atm</a> *cur = atoms[i] ;
<a name="l00238"></a>00238         
<a name="l00239"></a>00239         <span class="comment">/* Reinitialize variables */</span>
<a name="l00240"></a>00240                 stopm = 0; stopp = 0;
<a name="l00241"></a>00241                 sort_x = cur-&gt;<a class="code" href="structs__atm.html#05407d7638ff7f6fc210026306def9b5">sort_x</a> ;
<a name="l00242"></a>00242                 ntest_x = 1 ;
<a name="l00243"></a>00243                 vvalx = cur-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a> ; vvaly = cur-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a> ; vvalz = cur-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a> ;
<a name="l00244"></a>00244 
<a name="l00245"></a>00245         <span class="comment">/* Search neighbors */</span>
<a name="l00246"></a>00246                 <span class="keywordflow">while</span>(!stopm || !stopp) {
<a name="l00247"></a>00247                 <span class="comment">/* Do the neighbor search while wa are in tab and we dont reach a </span>
<a name="l00248"></a>00248 <span class="comment">                 * distance up to our criteria */</span>
<a name="l00249"></a>00249                         ip = ntest_x + sort_x ;
<a name="l00250"></a>00250                         <span class="keywordflow">if</span>(ip &gt;= dim) stopp = 1 ;
<a name="l00251"></a>00251         
<a name="l00252"></a>00252                         <span class="keywordflow">if</span>(stopp == 0 &amp;&amp; xsort[ip].type == <a class="code" href="sort_8h.html#957ea96624166be576b450587c537518">M_VERTICE_TYPE</a>) {
<a name="l00253"></a>00253                                 curvp = (<a class="code" href="structs__vvertice.html">s_vvertice</a>*) xsort[ip].data ;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255                                 <span class="keywordflow">if</span>(curvp-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a> - vvalx &gt; dcrit) stopp = 1 ;
<a name="l00256"></a>00256                                 <span class="keywordflow">else</span> {
<a name="l00257"></a>00257                                 <span class="comment">/* OK we have an atom which is near our vertice on X, so </span>
<a name="l00258"></a>00258 <span class="comment">                                 * calculate real distance */</span>
<a name="l00259"></a>00259                                         <span class="keywordflow">if</span>(<a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(curvp-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a>, curvp-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a>, curvp-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a>, vvalx, vvaly, vvalz) &lt; dcrit) {
<a name="l00260"></a>00260                                         <span class="comment">/* Distance OK, see if the molecule have not been already seen. */</span>
<a name="l00261"></a>00261                                                 seen = <a class="code" href="voronoi_8c.html#e3ecf2620f9bec82cc0180c2efd5c091">is_in_lst_vert</a>(neigh, nb_neigh, curvp-&gt;<a class="code" href="structs__vvertice.html#e66571bccd6d8e3f809b4315fdcbf65e">id</a>) ;
<a name="l00262"></a>00262                                                 <span class="keywordflow">if</span>(!seen) {
<a name="l00263"></a>00263                                                         <span class="keywordflow">if</span>(nb_neigh &gt;= real_size-1) {
<a name="l00264"></a>00264                                                                 real_size *= 2 ;
<a name="l00265"></a>00265                                                                 neigh = (<a class="code" href="structs__vvertice.html">s_vvertice</a> **)<a class="code" href="memhandler_8c.html#ede15d67c845c05e9b2bfb59b8ab6cf7">my_realloc</a>(neigh, 
<a name="l00266"></a>00266                                                                                                 <span class="keyword">sizeof</span>(<a class="code" href="structs__vvertice.html">s_vvertice</a>)*real_size) ;
<a name="l00267"></a>00267                                                         }
<a name="l00268"></a>00268                                                         neigh[nb_neigh] = curvp ;
<a name="l00269"></a>00269                                                         nb_neigh ++ ;
<a name="l00270"></a>00270                                                 }
<a name="l00271"></a>00271                                         }
<a name="l00272"></a>00272                                 }
<a name="l00273"></a>00273                         }
<a name="l00274"></a>00274         
<a name="l00275"></a>00275                         im = sort_x - ntest_x ;
<a name="l00276"></a>00276                         <span class="keywordflow">if</span>(im &lt; 0) stopm = 1 ;
<a name="l00277"></a>00277 
<a name="l00278"></a>00278                         <span class="keywordflow">if</span>(stopm == 0 &amp;&amp; xsort[im].type == <a class="code" href="sort_8h.html#957ea96624166be576b450587c537518">M_VERTICE_TYPE</a>) {
<a name="l00279"></a>00279                                 curvm = (<a class="code" href="structs__vvertice.html">s_vvertice</a>*) xsort[im].data ;
<a name="l00280"></a>00280         
<a name="l00281"></a>00281                                 <span class="keywordflow">if</span>(vvalx - curvm-&gt;x &gt; dcrit) stopm = 1 ;
<a name="l00282"></a>00282                                 <span class="keywordflow">else</span> {
<a name="l00283"></a>00283                                 <span class="comment">/* OK we have an atom which is near our vertice on X, so </span>
<a name="l00284"></a>00284 <span class="comment">                                 * calculate real distance */</span>
<a name="l00285"></a>00285                                         <span class="keywordflow">if</span>(<a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(curvm-&gt;x, curvm-&gt;y, curvm-&gt;z, vvalx, vvaly, vvalz) &lt; dcrit){
<a name="l00286"></a>00286                                         <span class="comment">/* Distance OK, see if the molecule is not one part of the </span>
<a name="l00287"></a>00287 <span class="comment">                                         * input, and if we have not already seen it. */</span>
<a name="l00288"></a>00288                                                 seen = <a class="code" href="voronoi_8c.html#e3ecf2620f9bec82cc0180c2efd5c091">is_in_lst_vert</a>(neigh, nb_neigh, curvm-&gt;<a class="code" href="structs__vvertice.html#e66571bccd6d8e3f809b4315fdcbf65e">id</a>) ;
<a name="l00289"></a>00289                                                 <span class="keywordflow">if</span>(!seen) {
<a name="l00290"></a>00290                                                         <span class="keywordflow">if</span>(nb_neigh &gt;= real_size-1) {
<a name="l00291"></a>00291                                                                 real_size *= 2 ;
<a name="l00292"></a>00292                                                                 neigh = (<a class="code" href="structs__vvertice.html">s_vvertice</a>**)<a class="code" href="memhandler_8c.html#ede15d67c845c05e9b2bfb59b8ab6cf7">my_realloc</a>(neigh, <span class="keyword">sizeof</span>(<a class="code" href="structs__vvertice.html">s_vvertice</a>)*real_size) ;
<a name="l00293"></a>00293                                                         }
<a name="l00294"></a>00294                                                         neigh[nb_neigh] = curvm ;
<a name="l00295"></a>00295                                                         nb_neigh ++ ;
<a name="l00296"></a>00296                                                 }
<a name="l00297"></a>00297                                         }
<a name="l00298"></a>00298                                 }
<a name="l00299"></a>00299                         }
<a name="l00300"></a>00300                         
<a name="l00301"></a>00301                         ntest_x += 1 ;
<a name="l00302"></a>00302                 }
<a name="l00303"></a>00303         }
<a name="l00304"></a>00304         
<a name="l00305"></a>00305         *nneigh = nb_neigh ;
<a name="l00306"></a>00306         <a class="code" href="sort_8c.html#2d54fddd06b48f2e6ba36822ecbd499e">free_s_vsort</a>(lsort) ;
<a name="l00307"></a>00307 
<a name="l00308"></a>00308         <span class="keywordflow">return</span> neigh ;
<a name="l00309"></a>00309 }
</pre></div>
<p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Jun 7 16:44:23 2010 for fpocket by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
