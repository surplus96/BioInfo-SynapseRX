<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>fpocket: tpocket.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<img src="fpocket_logo_small.png" width="545" height="150">
<!-- Generated by Doxygen 1.5.6 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>tpocket.c File Reference</h1><code>#include &quot;<a class="el" href="tpocket_8h-source.html">../headers/tpocket.h</a>&quot;</code><br>

<p>
<a href="tpocket_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tpocket_8c.html#8cd4d6f69c53d2fc3655e1a77ae1f0c0">test_fpocket</a> (<a class="el" href="structs__tparams.html">s_tparams</a> *par)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tpocket_8c.html#ef1f6d3f495f1245b15ee0507078f853">test_set</a> (<a class="el" href="structs__tparams.html">s_tparams</a> *par, int i, float ddata[][M_NDDATA], int idata[][M_NIDATA])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structs__atm.html">s_atm</a> **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tpocket_8c.html#e363bc6ecb6d690b378de02edefc02d7">get_actual_pocket</a> (<a class="el" href="structs__pdb.html">s_pdb</a> *cpdb, <a class="el" href="structs__pdb.html">s_pdb</a> *cpdb_nolig, int i, <a class="el" href="structs__tparams.html">s_tparams</a> *par, int *nb_atm)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structs__atm.html">s_atm</a> **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tpocket_8c.html#acc267e0329f8f2875cc0d2819bb88b8">get_actual_pocket_DEPRECATED</a> (<a class="el" href="structs__pdb.html">s_pdb</a> *cpdb, float lig_dist_crit, int *nb_atm)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tpocket_8c.html#081ca9804d0a726ea01ed54d22ea4b51">check_pockets</a> (<a class="el" href="structc__lst__pockets.html">c_lst_pockets</a> *pockets, <a class="el" href="structs__atm.html">s_atm</a> **accpck, int naccpck, <a class="el" href="structs__atm.html">s_atm</a> **lig, int nalig, <a class="el" href="structs__atm.html">s_atm</a> **alneigh, int nlneigh, float ddata[][M_NDDATA], int idata[][M_NIDATA], int i)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tpocket_8c.html#38be2f04793a64026710b077203bb3ea">set_overlap_volumes</a> (<a class="el" href="structs__pocket.html">s_pocket</a> *pocket, <a class="el" href="structs__atm.html">s_atm</a> **lig, int natoms, float lig_vol, <a class="el" href="structs__fparams.html">s_fparams</a> *params)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tpocket_8c.html#fc101509a7044f511ab7ba086f181be4">set_mc_overlap_volume</a> (<a class="el" href="structs__atm.html">s_atm</a> **lig, int natoms, float lig_vol, <a class="el" href="structs__pocket.html">s_pocket</a> *pocket, int niter)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tpocket_8c.html#95fe61d30e081cb52dac47d841c562cf">set_basic_overlap_volume</a> (<a class="el" href="structs__atm.html">s_atm</a> **lig, int natoms, float lig_vol, <a class="el" href="structs__pocket.html">s_pocket</a> *pocket, int idiscret)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="081ca9804d0a726ea01ed54d22ea4b51"></a><!-- doxytag: member="tpocket.c::check_pockets" ref="081ca9804d0a726ea01ed54d22ea4b51" args="(c_lst_pockets *pockets, s_atm **accpck, int naccpck, s_atm **lig, int nalig, s_atm **alneigh, int nlneigh, float ddata[][M_NDDATA], int idata[][M_NIDATA], int i)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void check_pockets           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structc__lst__pockets.html">c_lst_pockets</a> *&nbsp;</td>
          <td class="paramname"> <em>pockets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs__atm.html">s_atm</a> **&nbsp;</td>
          <td class="paramname"> <em>accpck</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>naccpck</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs__atm.html">s_atm</a> **&nbsp;</td>
          <td class="paramname"> <em>lig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nalig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs__atm.html">s_atm</a> **&nbsp;</td>
          <td class="paramname"> <em>alneigh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nlneigh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>ddata</em>[][M_NDDATA], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>idata</em>[][M_NIDATA], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>i</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
## FUNCTION: check_pockets<p>
## SPECIFICATION: Checking the pocket prediction for one data set. (apo+complex+ligand) This function will calculate three criterias: 1 - Overlap using the first definition of the pocket (atoms contacted by vertices next to the ligand) 2 - Overlap using the second definition of the pocket (atoms situated at N A of the ligand) 3 - Smallest distance of each ligand atom from the barycenter of the pocket. Cutoff: 4A<p>
The two arrays ddata and idata given in paramet are used as output.<p>
## PARAMETRES: @ <a class="el" href="structc__lst__pockets.html">c_lst_pockets</a> *pockets: The pockets found for this set. @ <a class="el" href="structs__atm.html">s_atm</a> accpck : The actual pocket using first definition @ int naccpckk : Number of atoms in the actual pocket definition 1 @ <a class="el" href="structs__atm.html">s_atm</a> lig : Ligand atoms @ int nalig : Number of ligand atoms @ <a class="el" href="structs__atm.html">s_atm</a> alneigh : The actual pocket using second definition @ int nlneigh : Number of atoms in the actual pocket definition 2 @ float ddata[][] : Used to store statistics for the evaluation (float) @ float idata[][] : Used to store statistics for the evaluation (integers) @ int i : ID if the current test set. Used to fill the two following statistic arrays<p>
## RETURN: void 
<p>Definition at line <a class="el" href="tpocket_8c-source.html#l00661">661</a> of file <a class="el" href="tpocket_8c-source.html">tpocket.c</a>.</p>

<p>References <a class="el" href="atom_8c-source.html#l00287">atm_corsp()</a>, <a class="el" href="pocket_8h-source.html#l00064">s_pocket::bary</a>, <a class="el" href="neighbor_8c-source.html#l00610">count_atm_prop_vert_neigh()</a>, <a class="el" href="pocket_8c-source.html#l01325">count_pocket_contacted_atms()</a>, <a class="el" href="neighbor_8c-source.html#l00503">count_pocket_lig_vert_ovlp()</a>, <a class="el" href="calc_8c-source.html#l00075">dist()</a>, <a class="el" href="pocket_8h-source.html#l00089">c_lst_pockets::first</a>, <a class="el" href="pocket_8c-source.html#l01269">get_pocket_contacted_atms()</a>, <a class="el" href="pocket_8c-source.html#l01369">get_pocket_pvertices()</a>, <a class="el" href="tpocket_8h-source.html#l00056">M_CRIT1_VAL</a>, <a class="el" href="tpocket_8h-source.html#l00057">M_CRIT2_VAL</a>, <a class="el" href="tpocket_8h-source.html#l00058">M_CRIT3_VAL</a>, <a class="el" href="tpocket_8h-source.html#l00070">M_CRIT4</a>, <a class="el" href="tpocket_8h-source.html#l00053">M_CRIT4_D</a>, <a class="el" href="tpocket_8h-source.html#l00059">M_CRIT4_VAL</a>, <a class="el" href="tpocket_8h-source.html#l00071">M_CRIT5</a>, <a class="el" href="tpocket_8h-source.html#l00054">M_CRIT5_D</a>, <a class="el" href="tpocket_8h-source.html#l00060">M_CRIT5_VAL</a>, <a class="el" href="tpocket_8h-source.html#l00072">M_CRIT6</a>, <a class="el" href="tpocket_8h-source.html#l00067">M_MAXPCT1</a>, <a class="el" href="tpocket_8h-source.html#l00068">M_MAXPCT2</a>, <a class="el" href="tpocket_8h-source.html#l00069">M_MINDST</a>, <a class="el" href="tpocket_8h-source.html#l00092">M_NATM3</a>, <a class="el" href="tpocket_8h-source.html#l00093">M_NATM6</a>, <a class="el" href="tpocket_8h-source.html#l00073">M_OREL1</a>, <a class="el" href="tpocket_8h-source.html#l00074">M_OREL2</a>, <a class="el" href="tpocket_8h-source.html#l00075">M_OREL3</a>, <a class="el" href="tpocket_8h-source.html#l00076">M_OREL4</a>, <a class="el" href="tpocket_8h-source.html#l00077">M_OREL5</a>, <a class="el" href="tpocket_8h-source.html#l00078">M_OREL6</a>, <a class="el" href="tpocket_8h-source.html#l00081">M_POCKETVOL_C3</a>, <a class="el" href="tpocket_8h-source.html#l00082">M_POCKETVOL_C6</a>, <a class="el" href="tpocket_8h-source.html#l00086">M_POS1</a>, <a class="el" href="tpocket_8h-source.html#l00087">M_POS2</a>, <a class="el" href="tpocket_8h-source.html#l00088">M_POS3</a>, <a class="el" href="tpocket_8h-source.html#l00089">M_POS4</a>, <a class="el" href="tpocket_8h-source.html#l00090">M_POS5</a>, <a class="el" href="tpocket_8h-source.html#l00091">M_POS6</a>, <a class="el" href="memhandler_8c-source.html#l00255">my_free()</a>, <a class="el" href="pocket_8h-source.html#l00080">node_pocket::next</a>, <a class="el" href="pocket_8h-source.html#l00061">s_pocket::pdesc</a>, <a class="el" href="pocket_8h-source.html#l00082">node_pocket::pocket</a>, <a class="el" href="atom_8h-source.html#l00063">s_atm::res_id</a>, <a class="el" href="pocket_8h-source.html#l00070">s_pocket::size</a>, and <a class="el" href="descriptors_8h-source.html#l00058">s_desc::volume</a>.</p>

<p>Referenced by <a class="el" href="tpocket_8c-source.html#l00440">test_set()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00664"></a>00664 {
<a name="l00665"></a>00665         <span class="keywordtype">int</span> found [] = {0, 0, 0, 0, 0, 0} ;
<a name="l00666"></a>00666         <span class="keywordtype">int</span> npneigh = 0, pos, j ;
<a name="l00667"></a>00667         <span class="keywordtype">float</span> ov1, ov2, ov3, ov4, dst = 0.0 ;
<a name="l00668"></a>00668         <span class="comment">/* float ovol ; */</span>
<a name="l00669"></a>00669         
<a name="l00670"></a>00670         <a class="code" href="structs__atm.html">s_atm</a> **pneigh = NULL ;
<a name="l00671"></a>00671         <a class="code" href="structs__vvertice.html">s_vvertice</a> **pvert = NULL ;
<a name="l00672"></a>00672         
<a name="l00673"></a>00673         <a class="code" href="structnode__pocket.html">node_pocket</a> *ncur = NULL ;
<a name="l00674"></a>00674         <a class="code" href="structs__pocket.html">s_pocket</a> *pcur = NULL ;
<a name="l00675"></a>00675         
<a name="l00676"></a>00676         <span class="comment">/* Check the correspondance for each pocket found */</span>
<a name="l00677"></a>00677         ncur = pockets-&gt;<a class="code" href="structc__lst__pockets.html#cf82eb35ce757228759a9af7675f5ad9">first</a> ;
<a name="l00678"></a>00678 
<a name="l00679"></a>00679         <span class="keywordtype">int</span> n_lig_molecules=1;
<a name="l00680"></a>00680         <span class="keywordtype">char</span> chain_tmp[2];
<a name="l00681"></a>00681         <span class="keywordtype">int</span> resnumber_tmp;
<a name="l00682"></a>00682         strcpy(chain_tmp,lig[0]-&gt;chain);
<a name="l00683"></a>00683         resnumber_tmp = lig[0]-&gt;<a class="code" href="structs__atm.html#7c42c076ce151f4af210bef730b2b88f">res_id</a>;
<a name="l00684"></a>00684         
<a name="l00685"></a>00685         <span class="keywordflow">for</span> (j = 1 ; j &lt; nalig ; j++) {
<a name="l00686"></a>00686             <span class="keywordflow">if</span>(strcmp(chain_tmp,lig[j]-&gt;chain) !=0 || resnumber_tmp!=lig[j]-&gt;res_id){
<a name="l00687"></a>00687                 n_lig_molecules++;
<a name="l00688"></a>00688                 strcpy(chain_tmp,lig[j]-&gt;chain);
<a name="l00689"></a>00689                 resnumber_tmp =lig[j]-&gt;<a class="code" href="structs__atm.html#7c42c076ce151f4af210bef730b2b88f">res_id</a>;
<a name="l00690"></a>00690             }
<a name="l00691"></a>00691         }
<a name="l00692"></a>00692         
<a name="l00693"></a>00693         pos = 0 ;
<a name="l00694"></a>00694         <span class="keywordflow">while</span>(ncur) {
<a name="l00695"></a>00695                 pos ++ ;
<a name="l00696"></a>00696                 pcur = ncur-&gt;<a class="code" href="structnode__pocket.html#8dbdbb50f893fa45bba2d8c03aff6553">pocket</a> ;
<a name="l00697"></a>00697 
<a name="l00698"></a>00698                 <span class="comment">/*</span>
<a name="l00699"></a>00699 <span class="comment">                        TEST THE FIRST CRITERIA (DISTANCE TO BARYCENTER)</span>
<a name="l00700"></a>00700 <span class="comment">                 */</span>
<a name="l00701"></a>00701                 <span class="keywordflow">if</span>(! found[0]) {
<a name="l00702"></a>00702                         <span class="keywordflow">for</span> (j = 0 ; j &lt; nalig ; j++) {
<a name="l00703"></a>00703                                 dst = <a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(lig[j]-&gt;x, lig[j]-&gt;y, lig[j]-&gt;z, 
<a name="l00704"></a>00704                                                         pcur-&gt;<a class="code" href="structs__pocket.html#45fdf0337674ecb9e96cc7d52a08926f">bary</a>[0], pcur-&gt;<a class="code" href="structs__pocket.html#45fdf0337674ecb9e96cc7d52a08926f">bary</a>[1], pcur-&gt;<a class="code" href="structs__pocket.html#45fdf0337674ecb9e96cc7d52a08926f">bary</a>[2]) ;
<a name="l00705"></a>00705                                 <span class="keywordflow">if</span>(dst &lt; <a class="code" href="tpocket_8h.html#4eeee08381182520700c57cadfaedfc6">M_CRIT3_VAL</a>) {
<a name="l00706"></a>00706                                 <span class="comment">/* Criteria 3 OK  */</span>
<a name="l00707"></a>00707                                         ddata[i][<a class="code" href="tpocket_8h.html#0c30519fdb73369454e676c767169b21">M_MINDST</a>] = dst ;
<a name="l00708"></a>00708                                         ddata[i][<a class="code" href="tpocket_8h.html#9f33fc9d82bcb1d94ef6979c95728cb6">M_OREL3</a>] = (naccpck &lt;= 0.0)?-1.0 :(float)npneigh/(<span class="keywordtype">float</span>)naccpck*100.0 ;
<a name="l00709"></a>00709                                         ddata[i][<a class="code" href="tpocket_8h.html#d0de25ca6d220d4503697cb27f797855">M_POCKETVOL_C3</a>] = pcur-&gt;<a class="code" href="structs__pocket.html#aba02d3ca1a41adf62ad69884c85fed5">pdesc</a>-&gt;<a class="code" href="structs__desc.html#ec106f2a35f5676a6af920311aa4260e">volume</a> ;
<a name="l00710"></a>00710                                         idata[i][<a class="code" href="tpocket_8h.html#80a692e7785aa31225ca543a481789ad">M_POS3</a>] = pos ;
<a name="l00711"></a>00711                                         idata[i][<a class="code" href="tpocket_8h.html#d960be284bbc7a000c1fc5f6f9141443">M_NATM3</a>] = <a class="code" href="pocket_8c.html#d825b0da3b7bd342baba8ff1ea8d70f5">count_pocket_contacted_atms</a>(pcur) ;
<a name="l00712"></a>00712                                         found[0] = 1 ; break ;
<a name="l00713"></a>00713                                 }
<a name="l00714"></a>00714                         }
<a name="l00715"></a>00715                 }
<a name="l00716"></a>00716 
<a name="l00717"></a>00717                 <span class="comment">/*</span>
<a name="l00718"></a>00718 <span class="comment">                        TEST THE 2nd and 3rd CRITERIA (ATOMIC OVERLAP)</span>
<a name="l00719"></a>00719 <span class="comment">                 */</span>
<a name="l00720"></a>00720                 <span class="keywordflow">if</span>(!found[1] || !found[2]) {
<a name="l00721"></a>00721                         pneigh = <a class="code" href="pocket_8c.html#38455bc09be1fc0f535f441d7b8eba40">get_pocket_contacted_atms</a>(pcur, &amp;npneigh) ;
<a name="l00722"></a>00722                         <span class="keywordflow">if</span>(! found[1]) {
<a name="l00723"></a>00723                                 ov1 = <a class="code" href="atom_8c.html#a960d66d3bd7cce701a12f56999056b4">atm_corsp</a>(alneigh, nlneigh, pneigh, npneigh) ;
<a name="l00724"></a>00724                                 <span class="keywordflow">if</span>(ov1 &gt; <a class="code" href="tpocket_8h.html#94baf628f1bd73f18c66c1f0736343cd">M_CRIT1_VAL</a>) {
<a name="l00725"></a>00725                                         idata[i][<a class="code" href="tpocket_8h.html#55d6185709100ab5f72c2ae09abd787d">M_POS1</a>] = pos ;
<a name="l00726"></a>00726                                         ddata[i][<a class="code" href="tpocket_8h.html#9ee7191c5cb85afe6431ca9e8bb78b84">M_MAXPCT1</a>] = ov1 ;
<a name="l00727"></a>00727                                         ddata[i][<a class="code" href="tpocket_8h.html#79d6e70ebf2aed6ffebd46f2b372f500">M_OREL1</a>] = (nlneigh &lt;= 0.0)? -1.0 : (float)npneigh/(<span class="keywordtype">float</span>)nlneigh*100.0 ;
<a name="l00728"></a>00728                                         found[1] = 1 ;
<a name="l00729"></a>00729                                 }
<a name="l00730"></a>00730                         }
<a name="l00731"></a>00731 
<a name="l00732"></a>00732                         <span class="keywordflow">if</span>(! found[2]) {
<a name="l00733"></a>00733                                 ov2 = <a class="code" href="atom_8c.html#a960d66d3bd7cce701a12f56999056b4">atm_corsp</a>(accpck, naccpck, pneigh, npneigh) ;
<a name="l00734"></a>00734                                 <span class="keywordflow">if</span>(ov2 &gt; <a class="code" href="tpocket_8h.html#1d5fe1cd54529d6d91fa6d157209d187">M_CRIT2_VAL</a>) {
<a name="l00735"></a>00735                                         idata[i][<a class="code" href="tpocket_8h.html#f701a979ab853364762799988141247c">M_POS2</a>] = pos ;
<a name="l00736"></a>00736                                         ddata[i][<a class="code" href="tpocket_8h.html#a7cf116f3abc05c7b85010a420fb2030">M_MAXPCT2</a>] = ov2 ;
<a name="l00737"></a>00737                                         ddata[i][<a class="code" href="tpocket_8h.html#00d02fbf3b639031a1dac1143ebe05f8">M_OREL2</a>] = (naccpck &lt;= 0.0)?-1.0 : (float)npneigh/(<span class="keywordtype">float</span>)naccpck*100.0 ;
<a name="l00738"></a>00738                                         found[2] = 1 ;
<a name="l00739"></a>00739                                 }
<a name="l00740"></a>00740                         }
<a name="l00741"></a>00741                         <a class="code" href="memhandler_8c.html#a49400242a007d208c641f79856ea4c6">my_free</a>(pneigh) ;
<a name="l00742"></a>00742                 }
<a name="l00743"></a>00743 
<a name="l00744"></a>00744                 <span class="comment">/*</span>
<a name="l00745"></a>00745 <span class="comment">                        TEST THE 4th and 5th CRITERIA (VERTICE OVERLAPS)</span>
<a name="l00746"></a>00746 <span class="comment">                 */</span>
<a name="l00747"></a>00747                 <span class="keywordflow">if</span>(!found[3] || !found[4] || !found[5]) {
<a name="l00748"></a>00748                         pvert = <a class="code" href="pocket_8c.html#86288d8af02eeeb7c4a1b18df3a82af3">get_pocket_pvertices</a>(pcur) ;
<a name="l00749"></a>00749                         <span class="keywordflow">if</span>(!found[3]){
<a name="l00750"></a>00750                                 <span class="comment">/* Calculate proportion of ligand atom that lies within 3A</span>
<a name="l00751"></a>00751 <span class="comment">                                   of at least one vertice */</span>
<a name="l00752"></a>00752                             
<a name="l00753"></a>00753                                 ov3 = <a class="code" href="neighbor_8c.html#72eb34a8654b78fc8fe8e64b8d49b31a">count_atm_prop_vert_neigh</a>( lig, nalig,pvert, pcur-&gt;<a class="code" href="structs__pocket.html#50722d86f4f1bf5b66b092b2bcbc661f">size</a>, <a class="code" href="tpocket_8h.html#bfe7ce08e878d91f96ca004bace09338">M_CRIT4_D</a>,n_lig_molecules) ;
<a name="l00754"></a>00754                                 <span class="keywordflow">if</span>(ov3 &gt; <a class="code" href="tpocket_8h.html#e6144aeda44c4bb02f1f9497785d2510">M_CRIT4_VAL</a>) {
<a name="l00755"></a>00755                                         idata[i][<a class="code" href="tpocket_8h.html#bb10da42f932a55e6f7469e082397fe0">M_POS4</a>] = pos ;
<a name="l00756"></a>00756                                         ddata[i][<a class="code" href="tpocket_8h.html#43f46c8a7ba58d495585d938e4656df6">M_CRIT4</a>] = ov3 ;
<a name="l00757"></a>00757                                         ddata[i][<a class="code" href="tpocket_8h.html#0af1271fc889dca4c82976712cc0a403">M_OREL4</a>] = ov3*100 ;
<a name="l00758"></a>00758                                         found[3] = 1 ;
<a name="l00759"></a>00759                                 }
<a name="l00760"></a>00760                         }
<a name="l00761"></a>00761 
<a name="l00762"></a>00762                         <span class="keywordflow">if</span>(!found[4]){
<a name="l00763"></a>00763                                 <span class="comment">/* Calculate proportion of pocket vertice that lies within 3A</span>
<a name="l00764"></a>00764 <span class="comment">                                   of at least one ligand atom */</span>
<a name="l00765"></a>00765                                 ov4 = <a class="code" href="neighbor_8c.html#3740ecf8c19f6a9a230fc19553ec23ba">count_pocket_lig_vert_ovlp</a>(lig, nalig,
<a name="l00766"></a>00766                                                                                                  pvert, pcur-&gt;<a class="code" href="structs__pocket.html#50722d86f4f1bf5b66b092b2bcbc661f">size</a>, <a class="code" href="tpocket_8h.html#ae4ceec65f3391993a39f87da79e798b">M_CRIT5_D</a>) ;
<a name="l00767"></a>00767                                 <span class="keywordflow">if</span>(ov4 &gt; <a class="code" href="tpocket_8h.html#8e29f7a52f508cd17213fe9e6d7f9b03">M_CRIT5_VAL</a>) {
<a name="l00768"></a>00768                                         idata[i][<a class="code" href="tpocket_8h.html#de47012f24417359f7401df0e6d3b222">M_POS5</a>] = pos ;
<a name="l00769"></a>00769                                         ddata[i][<a class="code" href="tpocket_8h.html#f3720a200eb98c961e42ae97d1fb2698">M_CRIT5</a>] = ov4 ;
<a name="l00770"></a>00770                                         ddata[i][<a class="code" href="tpocket_8h.html#ebcf9560e00b7e3828b834b830a1e72f">M_OREL5</a>] = ov4*100 ;
<a name="l00771"></a>00771                                         found[4] = 1 ;
<a name="l00772"></a>00772                                 }
<a name="l00773"></a>00773                         }
<a name="l00774"></a>00774 
<a name="l00775"></a>00775                         <span class="keywordflow">if</span>(!found[5]){
<a name="l00776"></a>00776                                 ov3 = <a class="code" href="neighbor_8c.html#72eb34a8654b78fc8fe8e64b8d49b31a">count_atm_prop_vert_neigh</a>( lig, nalig,
<a name="l00777"></a>00777                                                                                          pvert, pcur-&gt;<a class="code" href="structs__pocket.html#50722d86f4f1bf5b66b092b2bcbc661f">size</a>, <a class="code" href="tpocket_8h.html#bfe7ce08e878d91f96ca004bace09338">M_CRIT4_D</a>,n_lig_molecules );
<a name="l00778"></a>00778                                 ov4 = <a class="code" href="neighbor_8c.html#3740ecf8c19f6a9a230fc19553ec23ba">count_pocket_lig_vert_ovlp</a>(lig, nalig,
<a name="l00779"></a>00779                                                                                                  pvert, pcur-&gt;<a class="code" href="structs__pocket.html#50722d86f4f1bf5b66b092b2bcbc661f">size</a>, <a class="code" href="tpocket_8h.html#ae4ceec65f3391993a39f87da79e798b">M_CRIT5_D</a>) ;
<a name="l00780"></a>00780                                 <span class="keywordflow">if</span>(ov4 &gt; <a class="code" href="tpocket_8h.html#8e29f7a52f508cd17213fe9e6d7f9b03">M_CRIT5_VAL</a> &amp;&amp; ov3 &gt; <a class="code" href="tpocket_8h.html#e6144aeda44c4bb02f1f9497785d2510">M_CRIT4_VAL</a>) {
<a name="l00781"></a>00781                                         idata[i][<a class="code" href="tpocket_8h.html#55c83a9eb2be092f1f272142b3714c32">M_POS6</a>] = pos ;
<a name="l00782"></a>00782                                         ddata[i][<a class="code" href="tpocket_8h.html#f2058736b04fdb6d2aea24275af14bf6">M_CRIT6</a>] = 1.0 ;
<a name="l00783"></a>00783                                         ddata[i][<a class="code" href="tpocket_8h.html#417edad52d6d7e0e74845144192f8597">M_POCKETVOL_C6</a>] = pcur-&gt;<a class="code" href="structs__pocket.html#aba02d3ca1a41adf62ad69884c85fed5">pdesc</a>-&gt;<a class="code" href="structs__desc.html#ec106f2a35f5676a6af920311aa4260e">volume</a> ;
<a name="l00784"></a>00784                                         ddata[i][<a class="code" href="tpocket_8h.html#4f6b6a46252c705fd388816519c92bc6">M_OREL6</a>] = ov4*100 ;
<a name="l00785"></a>00785                                         idata[i][<a class="code" href="tpocket_8h.html#21e61378a50f50ce77c9187fae3c678b">M_NATM6</a>] = <a class="code" href="pocket_8c.html#d825b0da3b7bd342baba8ff1ea8d70f5">count_pocket_contacted_atms</a>(pcur) ;
<a name="l00786"></a>00786                                         found[5] = 1 ;
<a name="l00787"></a>00787                                 }
<a name="l00788"></a>00788                         }
<a name="l00789"></a>00789                         <a class="code" href="memhandler_8c.html#a49400242a007d208c641f79856ea4c6">my_free</a>(pvert) ;
<a name="l00790"></a>00790                 }
<a name="l00791"></a>00791                 
<a name="l00792"></a>00792                 ncur = ncur-&gt;<a class="code" href="structnode__pocket.html#a33c910dd9e6996001374199f250267e">next</a> ;
<a name="l00793"></a>00793 
<a name="l00794"></a>00794                 <span class="comment">/* Break the loop if all criteria are OK */</span>
<a name="l00795"></a>00795                 <span class="keywordflow">if</span>(found[0] &amp;&amp; found[1] &amp;&amp; found[2] &amp;&amp; found[3] &amp;&amp; found[4] &amp;&amp; found[5]) break ;
<a name="l00796"></a>00796                 
<a name="l00797"></a>00797         }
<a name="l00798"></a>00798 
<a name="l00799"></a>00799         <span class="keywordflow">if</span> (! found[0]) {
<a name="l00800"></a>00800                 ddata[i][<a class="code" href="tpocket_8h.html#0c30519fdb73369454e676c767169b21">M_MINDST</a>] = 0.0 ;
<a name="l00801"></a>00801                 ddata[i][<a class="code" href="tpocket_8h.html#9f33fc9d82bcb1d94ef6979c95728cb6">M_OREL3</a>] = 0.0 ;
<a name="l00802"></a>00802                 idata[i][<a class="code" href="tpocket_8h.html#80a692e7785aa31225ca543a481789ad">M_POS3</a>] = 0 ;
<a name="l00803"></a>00803                 idata[i][<a class="code" href="tpocket_8h.html#d960be284bbc7a000c1fc5f6f9141443">M_NATM3</a>] = -1 ;
<a name="l00804"></a>00804                 ddata[i][<a class="code" href="tpocket_8h.html#d0de25ca6d220d4503697cb27f797855">M_POCKETVOL_C3</a>] = 0.0 ;
<a name="l00805"></a>00805         }
<a name="l00806"></a>00806 
<a name="l00807"></a>00807         <span class="keywordflow">if</span> (! found[1]) {
<a name="l00808"></a>00808                 ddata[i][<a class="code" href="tpocket_8h.html#9ee7191c5cb85afe6431ca9e8bb78b84">M_MAXPCT1</a>] = 0.0 ;
<a name="l00809"></a>00809                 ddata[i][<a class="code" href="tpocket_8h.html#79d6e70ebf2aed6ffebd46f2b372f500">M_OREL1</a>] = 0.0 ;
<a name="l00810"></a>00810                 idata[i][<a class="code" href="tpocket_8h.html#55d6185709100ab5f72c2ae09abd787d">M_POS1</a>] = 0 ;
<a name="l00811"></a>00811         }
<a name="l00812"></a>00812 
<a name="l00813"></a>00813         <span class="keywordflow">if</span> (! found[2]) {
<a name="l00814"></a>00814                 ddata[i][<a class="code" href="tpocket_8h.html#a7cf116f3abc05c7b85010a420fb2030">M_MAXPCT2</a>] = 0.0 ;
<a name="l00815"></a>00815                 ddata[i][<a class="code" href="tpocket_8h.html#00d02fbf3b639031a1dac1143ebe05f8">M_OREL2</a>] = 0.0 ;
<a name="l00816"></a>00816                 idata[i][<a class="code" href="tpocket_8h.html#f701a979ab853364762799988141247c">M_POS2</a>] = 0 ;
<a name="l00817"></a>00817         }
<a name="l00818"></a>00818 
<a name="l00819"></a>00819         <span class="keywordflow">if</span> (! found[3]) {
<a name="l00820"></a>00820                 ddata[i][<a class="code" href="tpocket_8h.html#43f46c8a7ba58d495585d938e4656df6">M_CRIT4</a>] = 0.0 ;
<a name="l00821"></a>00821                 ddata[i][<a class="code" href="tpocket_8h.html#0af1271fc889dca4c82976712cc0a403">M_OREL4</a>] = 0.0 ;
<a name="l00822"></a>00822                 idata[i][<a class="code" href="tpocket_8h.html#bb10da42f932a55e6f7469e082397fe0">M_POS4</a>] = 0 ;
<a name="l00823"></a>00823         }
<a name="l00824"></a>00824 
<a name="l00825"></a>00825         <span class="keywordflow">if</span> (! found[4]) {
<a name="l00826"></a>00826                 ddata[i][<a class="code" href="tpocket_8h.html#f3720a200eb98c961e42ae97d1fb2698">M_CRIT5</a>] = 0.0 ;
<a name="l00827"></a>00827                 ddata[i][<a class="code" href="tpocket_8h.html#ebcf9560e00b7e3828b834b830a1e72f">M_OREL5</a>] = 0.0 ;
<a name="l00828"></a>00828                 idata[i][<a class="code" href="tpocket_8h.html#de47012f24417359f7401df0e6d3b222">M_POS5</a>] = 0 ;
<a name="l00829"></a>00829         }
<a name="l00830"></a>00830         
<a name="l00831"></a>00831         <span class="keywordflow">if</span> (! found[5]) {
<a name="l00832"></a>00832                 ddata[i][<a class="code" href="tpocket_8h.html#f2058736b04fdb6d2aea24275af14bf6">M_CRIT6</a>] = 0.0 ;
<a name="l00833"></a>00833                 ddata[i][<a class="code" href="tpocket_8h.html#4f6b6a46252c705fd388816519c92bc6">M_OREL6</a>] = 0.0 ;
<a name="l00834"></a>00834                 idata[i][<a class="code" href="tpocket_8h.html#55c83a9eb2be092f1f272142b3714c32">M_POS6</a>] = 0 ;
<a name="l00835"></a>00835                 idata[i][<a class="code" href="tpocket_8h.html#21e61378a50f50ce77c9187fae3c678b">M_NATM6</a>] = -1 ;
<a name="l00836"></a>00836                 ddata[i][<a class="code" href="tpocket_8h.html#417edad52d6d7e0e74845144192f8597">M_POCKETVOL_C6</a>] = 0.0 ;
<a name="l00837"></a>00837         }
<a name="l00838"></a>00838 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="e363bc6ecb6d690b378de02edefc02d7"></a><!-- doxytag: member="tpocket.c::get_actual_pocket" ref="e363bc6ecb6d690b378de02edefc02d7" args="(s_pdb *cpdb, s_pdb *cpdb_nolig, int i, s_tparams *par, int *nb_atm)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structs__atm.html">s_atm</a>** get_actual_pocket           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs__pdb.html">s_pdb</a> *&nbsp;</td>
          <td class="paramname"> <em>cpdb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs__pdb.html">s_pdb</a> *&nbsp;</td>
          <td class="paramname"> <em>cpdb_nolig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs__tparams.html">s_tparams</a> *&nbsp;</td>
          <td class="paramname"> <em>par</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>nb_atm</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
## FUNCTION: get_actual_pocket<p>
## SPECIFICATION: Get atoms contacted by voronoi vertices present in the actual pocket and situated at a distance of M_DST_CRIT from each ligand atoms. This way of finding exact atoms contacted by the ligand is more accurate, but need an extra search by fpocket to find voronoi vertices in the complexe form without the ligand...<p>
## PARAMETRES: @ <a class="el" href="structs__pdb.html">s_pdb</a> *cpdb : The pdb structure of the complexe. @ <a class="el" href="structs__pdb.html">s_pdb</a> *cpdb_nolig : The pdb structure of the complexe WITHOUT the ligand @ int i : ID of the current test set @ <a class="el" href="structs__tparams.html">s_tparams</a> *par : Parameters @ int *nb_atm : Number of atom (this an output, it should be set here)<p>
## RETURN: <a class="el" href="structs__atm.html">s_atm</a> **: A 2D table containing pointers to atoms which defines the pocket. 
<p>Definition at line <a class="el" href="tpocket_8c-source.html#l00556">556</a> of file <a class="el" href="tpocket_8c-source.html">tpocket.c</a>.</p>

<p>References <a class="el" href="pocket_8c-source.html#l01214">c_lst_pocket_free()</a>, <a class="el" href="tparams_8h-source.html#l00099">s_tparams::fapo</a>, <a class="el" href="tparams_8h-source.html#l00099">s_tparams::fcomplex</a>, <a class="el" href="tparams_8h-source.html#l00099">s_tparams::fligan</a>, <a class="el" href="tparams_8h-source.html#l00115">s_tparams::fpar</a>, <a class="el" href="neighbor_8c-source.html#l00332">get_mol_ctd_atm_neigh()</a>, <a class="el" href="rpdb_8h-source.html#l00076">s_pdb::latm_lig</a>, <a class="el" href="tpocket_8h-source.html#l00051">M_CRIT1_D</a>, <a class="el" href="neighbor_8h-source.html#l00053">M_INTERFACE_SEARCH</a>, <a class="el" href="pocket_8h-source.html#l00092">c_lst_pockets::n_pockets</a>, <a class="el" href="rpdb_8h-source.html#l00078">s_pdb::natm_lig</a>, <a class="el" href="voronoi_8h-source.html#l00100">s_lst_vvertice::nvert</a>, <a class="el" href="voronoi_8h-source.html#l00096">s_lst_vvertice::pvertices</a>, <a class="el" href="fpocket_8c-source.html#l00082">search_pocket()</a>, and <a class="el" href="pocket_8h-source.html#l00094">c_lst_pockets::vertices</a>.</p>

<p>Referenced by <a class="el" href="tpocket_8c-source.html#l00440">test_set()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00557"></a>00557 {
<a name="l00558"></a>00558         <a class="code" href="structs__atm.html">s_atm</a> **neigh = NULL ;
<a name="l00559"></a>00559 
<a name="l00560"></a>00560         <a class="code" href="structc__lst__pockets.html">c_lst_pockets</a> *pockets = <a class="code" href="fpocket_8c.html#23faf120fcf6ef1442496cba08d4fbd1">search_pocket</a>(cpdb_nolig, par-&gt;<a class="code" href="structs__tparams.html#b6b1c97feba279871d8135b46d53d457">fpar</a>,cpdb);
<a name="l00561"></a>00561         <span class="keywordflow">if</span>(pockets &amp;&amp; pockets-&gt;<a class="code" href="structc__lst__pockets.html#c3a6d72365261579a557746bfc96aec3">n_pockets</a> &gt; 0) {
<a name="l00562"></a>00562                 <span class="comment">/* */</span>
<a name="l00563"></a>00563                 <span class="comment">/* Get the list of atoms contacted by the vertices near the ligand. */</span>
<a name="l00564"></a>00564                 
<a name="l00565"></a>00565                 neigh = <a class="code" href="neighbor_8c.html#60519bcf15270301f71419d124eb930c">get_mol_ctd_atm_neigh</a>(cpdb-&gt;<a class="code" href="structs__pdb.html#fe85c6dd76ee9c740d2869ee30621ea5">latm_lig</a>, cpdb-&gt;<a class="code" href="structs__pdb.html#659b83804ffc576f1307beac00c1486b">natm_lig</a>,
<a name="l00566"></a>00566                                                                           pockets-&gt;<a class="code" href="structc__lst__pockets.html#8d86cfec23ef9aa0079cf8258b39863e">vertices</a>-&gt;<a class="code" href="structs__lst__vvertice.html#638d9ede844bca411ed99cb8e22b0e56">pvertices</a>,
<a name="l00567"></a>00567                                                                           pockets-&gt;<a class="code" href="structc__lst__pockets.html#8d86cfec23ef9aa0079cf8258b39863e">vertices</a>-&gt;<a class="code" href="structs__lst__vvertice.html#c6b07ac45ca65ccd944b68afd4c18bfb">nvert</a>, <a class="code" href="tpocket_8h.html#3d02f3b0d5c749f487fcc0e0536d3782">M_CRIT1_D</a>,
<a name="l00568"></a>00568                                                                           <a class="code" href="neighbor_8h.html#1c318ac74ea9b85f4cc72cc40b4709c8">M_INTERFACE_SEARCH</a>, nb_atm) ;
<a name="l00569"></a>00569 
<a name="l00570"></a>00570                 <a class="code" href="pocket_8c.html#a9afcc69c1f7bdce1f22b0c48397b242">c_lst_pocket_free</a>(pockets) ;
<a name="l00571"></a>00571         }
<a name="l00572"></a>00572         <span class="keywordflow">else</span> {
<a name="l00573"></a>00573                 fprintf(stderr, <span class="stringliteral">"! No pocket found for apo %s and complex %s ligand %s...\n"</span>, 
<a name="l00574"></a>00574                                                 par-&gt;<a class="code" href="structs__tparams.html#c04974099c0ce34a0c8a4df7c91f3f43">fapo</a>[i], par-&gt;<a class="code" href="structs__tparams.html#02f5ffbfc8da616c952b154ad889e91a">fcomplex</a>[i], par-&gt;<a class="code" href="structs__tparams.html#e613f8bd5bff9e433a427643c0127a0a">fligan</a>[i]) ;
<a name="l00575"></a>00575 
<a name="l00576"></a>00576                 <span class="keywordflow">if</span>(pockets) <a class="code" href="pocket_8c.html#a9afcc69c1f7bdce1f22b0c48397b242">c_lst_pocket_free</a>(pockets) ;
<a name="l00577"></a>00577         }
<a name="l00578"></a>00578 
<a name="l00579"></a>00579         <span class="keywordflow">return</span> neigh ;
<a name="l00580"></a>00580 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="acc267e0329f8f2875cc0d2819bb88b8"></a><!-- doxytag: member="tpocket.c::get_actual_pocket_DEPRECATED" ref="acc267e0329f8f2875cc0d2819bb88b8" args="(s_pdb *cpdb, float lig_dist_crit, int *nb_atm)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structs__atm.html">s_atm</a>** get_actual_pocket_DEPRECATED           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs__pdb.html">s_pdb</a> *&nbsp;</td>
          <td class="paramname"> <em>cpdb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>lig_dist_crit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>nb_atm</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
## FUNCTION: get_actual_pocket<p>
## SPECIFICATION: Get atoms situated at a distance of lig_dist_crit from each ligand atoms. This is a quite inacurate way of defining the pocket -&gt; DEPRECATED If the distance criteria used does not allow any identification, we will test a larger distance until 6A.<p>
## PARAMETRES: @ <a class="el" href="structs__pdb.html">s_pdb</a> *cpdb : The pdb structure of the complexe. @ float lig_dist_crit : The distance criteria @ int *nb_atm : OUTPUT: Number of atom found in the pocket<p>
## RETURN: <a class="el" href="structs__atm.html">s_atm</a> **: A 2D table containing pointers to atoms which defines the pocket. 
<p>Definition at line <a class="el" href="tpocket_8c-source.html#l00601">601</a> of file <a class="el" href="tpocket_8c-source.html">tpocket.c</a>.</p>

<p>References <a class="el" href="neighbor_8c-source.html#l00090">get_mol_atm_neigh()</a>, <a class="el" href="rpdb_8h-source.html#l00076">s_pdb::latm_lig</a>, <a class="el" href="rpdb_8h-source.html#l00074">s_pdb::latoms_p</a>, <a class="el" href="memhandler_8c-source.html#l00255">my_free()</a>, <a class="el" href="rpdb_8h-source.html#l00078">s_pdb::natm_lig</a>, and <a class="el" href="rpdb_8h-source.html#l00078">s_pdb::natoms</a>.</p>

<p>Referenced by <a class="el" href="tpocket_8c-source.html#l00440">test_set()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00602"></a>00602 {
<a name="l00603"></a>00603         <span class="comment">/* Getting the ligan's neighbors. */</span>
<a name="l00604"></a>00604         <a class="code" href="structs__atm.html">s_atm</a> **alneigh = <a class="code" href="neighbor_8c.html#48bd2094854cf343b3f75e93997bea04">get_mol_atm_neigh</a>(cpdb-&gt;<a class="code" href="structs__pdb.html#fe85c6dd76ee9c740d2869ee30621ea5">latm_lig</a>, cpdb-&gt;<a class="code" href="structs__pdb.html#659b83804ffc576f1307beac00c1486b">natm_lig</a>,
<a name="l00605"></a>00605                                                                                 cpdb-&gt;<a class="code" href="structs__pdb.html#4517e3a82dbf0f34e73d1865e484dbfd">latoms_p</a>, cpdb-&gt;<a class="code" href="structs__pdb.html#85aaf7bdb931bb303af1ca736a998b98">natoms</a>,
<a name="l00606"></a>00606                                                                                 lig_dist_crit, nb_atm) ;
<a name="l00607"></a>00607         <span class="keywordflow">if</span>(*nb_atm &lt;= 0) {
<a name="l00608"></a>00608                 <span class="keywordflow">if</span>(alneigh) <a class="code" href="memhandler_8c.html#a49400242a007d208c641f79856ea4c6">my_free</a>(alneigh) ;
<a name="l00609"></a>00609                 alneigh = <a class="code" href="neighbor_8c.html#48bd2094854cf343b3f75e93997bea04">get_mol_atm_neigh</a>(cpdb-&gt;<a class="code" href="structs__pdb.html#fe85c6dd76ee9c740d2869ee30621ea5">latm_lig</a>, cpdb-&gt;<a class="code" href="structs__pdb.html#659b83804ffc576f1307beac00c1486b">natm_lig</a>,
<a name="l00610"></a>00610                                                                         cpdb-&gt;<a class="code" href="structs__pdb.html#4517e3a82dbf0f34e73d1865e484dbfd">latoms_p</a>, cpdb-&gt;<a class="code" href="structs__pdb.html#85aaf7bdb931bb303af1ca736a998b98">natoms</a>,
<a name="l00611"></a>00611                                                                         lig_dist_crit+1.0, nb_atm) ;
<a name="l00612"></a>00612 
<a name="l00613"></a>00613                 <span class="keywordflow">if</span>(*nb_atm &lt;= 0) {
<a name="l00614"></a>00614                         <span class="keywordflow">if</span>(alneigh) <a class="code" href="memhandler_8c.html#a49400242a007d208c641f79856ea4c6">my_free</a>(alneigh) ;
<a name="l00615"></a>00615                         alneigh = <a class="code" href="neighbor_8c.html#48bd2094854cf343b3f75e93997bea04">get_mol_atm_neigh</a>(cpdb-&gt;<a class="code" href="structs__pdb.html#fe85c6dd76ee9c740d2869ee30621ea5">latm_lig</a>, cpdb-&gt;<a class="code" href="structs__pdb.html#659b83804ffc576f1307beac00c1486b">natm_lig</a>,
<a name="l00616"></a>00616                                                                                 cpdb-&gt;<a class="code" href="structs__pdb.html#4517e3a82dbf0f34e73d1865e484dbfd">latoms_p</a>, cpdb-&gt;<a class="code" href="structs__pdb.html#85aaf7bdb931bb303af1ca736a998b98">natoms</a>,
<a name="l00617"></a>00617                                                                                 lig_dist_crit+2.0, nb_atm) ;
<a name="l00618"></a>00618                         <span class="keywordflow">if</span>(*nb_atm &lt;= 0) {
<a name="l00619"></a>00619                                 <span class="keywordflow">if</span>(alneigh) <a class="code" href="memhandler_8c.html#a49400242a007d208c641f79856ea4c6">my_free</a>(alneigh) ;
<a name="l00620"></a>00620                                 alneigh = NULL ;
<a name="l00621"></a>00621                         }
<a name="l00622"></a>00622                 }
<a name="l00623"></a>00623         }
<a name="l00624"></a>00624         
<a name="l00625"></a>00625         <span class="keywordflow">return</span> alneigh ;
<a name="l00626"></a>00626 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="95fe61d30e081cb52dac47d841c562cf"></a><!-- doxytag: member="tpocket.c::set_basic_overlap_volume" ref="95fe61d30e081cb52dac47d841c562cf" args="(s_atm **lig, int natoms, float lig_vol, s_pocket *pocket, int idiscret)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float set_basic_overlap_volume           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs__atm.html">s_atm</a> **&nbsp;</td>
          <td class="paramname"> <em>lig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>natoms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>lig_vol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs__pocket.html">s_pocket</a> *&nbsp;</td>
          <td class="paramname"> <em>pocket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>idiscret</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
## FUNCTION: set_basic_overlap_volume<p>
## SPECIFICATION: This function will set an overlap volume between each pocket and the ligand. Discrete aproximation. (algo in idiscret*idiscret*idiscret operation minimum)<p>
## PARAMETRES: @ <a class="el" href="structs__atm.html">s_atm</a> **lig : The ligand atoms. @ int natoms natoms : Number of atoms of the ligand. @ float lig_vol : Volume of the ligand @ <a class="el" href="structs__pocket.html">s_pocket</a> *pockets : The pocket @ int idiscret : Discretisation of the space: splitt the space in N*N*N cubes.<p>
## RETURN: 
<p>Definition at line <a class="el" href="tpocket_8c-source.html#l01047">1047</a> of file <a class="el" href="tpocket_8c-source.html">tpocket.c</a>.</p>

<p>References <a class="el" href="voronoi__lst_8h-source.html#l00064">c_lst_vertices::first</a>, <a class="el" href="voronoi__lst_8h-source.html#l00056">node_vertice::next</a>, <a class="el" href="pocket_8h-source.html#l00061">s_pocket::pdesc</a>, <a class="el" href="atom_8h-source.html#l00070">s_atm::radius</a>, <a class="el" href="voronoi_8h-source.html#l00075">s_vvertice::ray</a>, <a class="el" href="pocket_8h-source.html#l00063">s_pocket::v_lst</a>, <a class="el" href="voronoi__lst_8h-source.html#l00058">node_vertice::vertice</a>, <a class="el" href="pocket_8h-source.html#l00064">s_pocket::vol_corresp</a>, <a class="el" href="descriptors_8h-source.html#l00058">s_desc::volume</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::x</a>, <a class="el" href="atom_8h-source.html#l00056">s_atm::x</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::y</a>, <a class="el" href="atom_8h-source.html#l00056">s_atm::y</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::z</a>, and <a class="el" href="atom_8h-source.html#l00056">s_atm::z</a>.</p>

<p>Referenced by <a class="el" href="tpocket_8c-source.html#l00881">set_overlap_volumes()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01049"></a>01049 {
<a name="l01050"></a>01050         <a class="code" href="structc__lst__vertices.html">c_lst_vertices</a> *vertices = pocket-&gt;<a class="code" href="structs__pocket.html#cf07f539404d23c1956373f8c93a4fcc">v_lst</a> ;
<a name="l01051"></a>01051         <a class="code" href="structs__vvertice.html">s_vvertice</a> *vcur = NULL ;
<a name="l01052"></a>01052 
<a name="l01053"></a>01053         <span class="keywordtype">int</span> i = 0, j = 0,
<a name="l01054"></a>01054                 nb_in = 0,
<a name="l01055"></a>01055                 found = 0,
<a name="l01056"></a>01056                 niter = 0 ;
<a name="l01057"></a>01057 
<a name="l01058"></a>01058         <span class="keywordtype">float</span> discret = 1.0/(float)idiscret ;
<a name="l01059"></a>01059 
<a name="l01060"></a>01060         <span class="keywordtype">float</span> x = 0.0, y = 0.0, z = 0.0,
<a name="l01061"></a>01061                   xstep = 0.0, ystep = 0.0, zstep = 0.0 ;
<a name="l01062"></a>01062 
<a name="l01063"></a>01063         <span class="keywordtype">float</span> xmin = 0.0, xmax = 0.0,
<a name="l01064"></a>01064                   ymin = 0.0, ymax = 0.0,
<a name="l01065"></a>01065                   zmin = 0.0, zmax = 0.0,
<a name="l01066"></a>01066                   xtmp = 0.0, ytmp = 0.0, ztmp = 0.0,
<a name="l01067"></a>01067                   vbox = 0.0, full_vol = 0.0;
<a name="l01068"></a>01068 
<a name="l01069"></a>01069         <a class="code" href="structs__atm.html">s_atm</a> *acur = NULL ;
<a name="l01070"></a>01070 
<a name="l01071"></a>01071         <span class="comment">/* First, search extrems coordinates in the ligan */</span>
<a name="l01072"></a>01072         <span class="keywordflow">for</span>(i = 0 ; i &lt; natoms ; i++) {
<a name="l01073"></a>01073                 acur = lig[i] ;
<a name="l01074"></a>01074                 <span class="keywordflow">if</span>(i == 0) {
<a name="l01075"></a>01075                         xmin = acur-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a> - acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a> ; xmax = acur-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a> + acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a> ;
<a name="l01076"></a>01076                         ymin = acur-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a> - acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a> ; ymax = acur-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a> + acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a> ;
<a name="l01077"></a>01077                         zmin = acur-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a> - acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a> ; zmax = acur-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a> + acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a> ;
<a name="l01078"></a>01078                 }
<a name="l01079"></a>01079                 <span class="keywordflow">else</span> {
<a name="l01080"></a>01080                 <span class="comment">/* Update the minimum and maximum extreme point */</span>
<a name="l01081"></a>01081                         <span class="keywordflow">if</span>(xmin &gt; (xtmp = acur-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a> - acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a>)) xmin = xtmp ;
<a name="l01082"></a>01082                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(xmax &lt; (xtmp = acur-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a> + acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a>)) xmax = xtmp ;
<a name="l01083"></a>01083         
<a name="l01084"></a>01084                         <span class="keywordflow">if</span>(ymin &gt; (ytmp = acur-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a> - acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a>)) ymin = ytmp ;
<a name="l01085"></a>01085                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ymax &lt; (ytmp = acur-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a> + acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a>)) ymax = ytmp ;
<a name="l01086"></a>01086         
<a name="l01087"></a>01087                         <span class="keywordflow">if</span>(zmin &gt; (ztmp = acur-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a> - acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a>)) zmin = ztmp ;
<a name="l01088"></a>01088                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(zmax &lt; (ztmp = acur-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a> + acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a>)) zmax = ztmp ;
<a name="l01089"></a>01089                 }
<a name="l01090"></a>01090         }
<a name="l01091"></a>01091 
<a name="l01092"></a>01092         <a class="code" href="structnode__vertice.html">node_vertice</a> *cur = vertices-&gt;<a class="code" href="structc__lst__vertices.html#72562067d308bcfcf32605e112e30c1a">first</a> ;
<a name="l01093"></a>01093         <span class="comment">/* Continue with the pocket */</span>
<a name="l01094"></a>01094         <span class="keywordflow">while</span>(cur) {
<a name="l01095"></a>01095                 vcur = cur-&gt;<a class="code" href="structnode__vertice.html#7e7063f6403dfd8f0a8f83462e27729b">vertice</a> ;
<a name="l01096"></a>01096                 <span class="keywordflow">if</span>(xmin &gt; (xtmp = vcur-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a> - vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a>)) xmin = xtmp ;
<a name="l01097"></a>01097                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(xmax &lt; (xtmp = vcur-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a> + vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a>)) xmax = xtmp ;
<a name="l01098"></a>01098         
<a name="l01099"></a>01099                 <span class="keywordflow">if</span>(ymin &gt; (ytmp = vcur-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a> - vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a>)) ymin = ytmp ;
<a name="l01100"></a>01100                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ymax &lt; (ytmp = vcur-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a> + vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a>)) ymax = ytmp ;
<a name="l01101"></a>01101         
<a name="l01102"></a>01102                 <span class="keywordflow">if</span>(zmin &gt; (ztmp = vcur-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a> - vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a>)) zmin = ztmp ;
<a name="l01103"></a>01103                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(zmax &lt; (ztmp = vcur-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a> + vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a>)) zmax = ztmp ;
<a name="l01104"></a>01104 
<a name="l01105"></a>01105                 cur = cur-&gt;<a class="code" href="structnode__vertice.html#61b34ff349d05cc65a4d8b9e2c77ff3e">next</a> ;
<a name="l01106"></a>01106         }
<a name="l01107"></a>01107 
<a name="l01108"></a>01108 
<a name="l01109"></a>01109         <span class="comment">/* Next calculate the box volume */</span>
<a name="l01110"></a>01110         vbox = (xmax - xmin)*(ymax - ymin)*(zmax - zmin) ;
<a name="l01111"></a>01111 
<a name="l01112"></a>01112         xstep = discret * (xmax - xmin) ;
<a name="l01113"></a>01113         ystep = discret * (ymax - ymin) ;
<a name="l01114"></a>01114         zstep = discret * (zmax - zmin) ;
<a name="l01115"></a>01115 
<a name="l01116"></a>01116         <span class="comment">/* Then apply monte carlo approximation of the volume */</span>
<a name="l01117"></a>01117         <span class="keywordflow">for</span>(x = xmin ; x &lt; xmax ; x += xstep) {
<a name="l01118"></a>01118                 <span class="keywordflow">for</span>(y = ymin ; y &lt; ymax ; y += ystep) { 
<a name="l01119"></a>01119                         <span class="keywordflow">for</span>(z = zmin ; z &lt; zmax ; z += zstep) {
<a name="l01120"></a>01120                                 found = 0 ;
<a name="l01121"></a>01121                                 cur = vertices-&gt;<a class="code" href="structc__lst__vertices.html#72562067d308bcfcf32605e112e30c1a">first</a> ;
<a name="l01122"></a>01122                                 <span class="keywordflow">while</span>(cur) {
<a name="l01123"></a>01123                                         vcur = cur-&gt;<a class="code" href="structnode__vertice.html#7e7063f6403dfd8f0a8f83462e27729b">vertice</a> ;
<a name="l01124"></a>01124                                         xtmp = vcur-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a> - x ;
<a name="l01125"></a>01125                                         ytmp = vcur-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a> - y ;
<a name="l01126"></a>01126                                         ztmp = vcur-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a> - z ;
<a name="l01127"></a>01127                 
<a name="l01128"></a>01128                                 <span class="comment">/* Compare r^2 and dist(center, random_point)^2 */</span>
<a name="l01129"></a>01129                                         <span class="keywordflow">if</span>((vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a>*vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a>) &gt; (xtmp*xtmp + ytmp*ytmp + ztmp*ztmp)) {
<a name="l01130"></a>01130                                         <span class="comment">/* The point is inside one of the vertice!! */</span>
<a name="l01131"></a>01131                                                 nb_in ++ ; found = 1 ; break ;
<a name="l01132"></a>01132                                         }
<a name="l01133"></a>01133                                         cur = cur-&gt;<a class="code" href="structnode__vertice.html#61b34ff349d05cc65a4d8b9e2c77ff3e">next</a> ;
<a name="l01134"></a>01134                                 }
<a name="l01135"></a>01135                 
<a name="l01136"></a>01136                                 <span class="keywordflow">if</span>(!found) {
<a name="l01137"></a>01137                                         <span class="keywordflow">for</span>(j = 0 ; j &lt; natoms ; j++) {
<a name="l01138"></a>01138                                                 acur = lig[j] ;
<a name="l01139"></a>01139                                                 xtmp = acur-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a> - x ;
<a name="l01140"></a>01140                                                 ytmp = acur-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a> - y ;
<a name="l01141"></a>01141                                                 ztmp = acur-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a> - z ;
<a name="l01142"></a>01142                         
<a name="l01143"></a>01143                                         <span class="comment">/* Compare r^2 and dist(center, random_point)^2 */</span>
<a name="l01144"></a>01144                                                 <span class="keywordflow">if</span>((acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a>*acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a>) &gt; (xtmp*xtmp + ytmp*ytmp + ztmp*ztmp)) {
<a name="l01145"></a>01145                                                 <span class="comment">/* The point is inside one of the vertice!! */</span>
<a name="l01146"></a>01146                                                         nb_in ++ ; break ;
<a name="l01147"></a>01147                                                 }
<a name="l01148"></a>01148                                         }
<a name="l01149"></a>01149                                 }
<a name="l01150"></a>01150                                 niter++ ;
<a name="l01151"></a>01151                         }
<a name="l01152"></a>01152                 }
<a name="l01153"></a>01153         }
<a name="l01154"></a>01154 
<a name="l01155"></a>01155         full_vol = ((float)nb_in)/((float)niter)*vbox ; 
<a name="l01156"></a>01156         pocket-&gt;<a class="code" href="structs__pocket.html#8acccf468d8c33f26035f1c854a89a42">vol_corresp</a> = ((pocket-&gt;<a class="code" href="structs__pocket.html#aba02d3ca1a41adf62ad69884c85fed5">pdesc</a>-&gt;<a class="code" href="structs__desc.html#ec106f2a35f5676a6af920311aa4260e">volume</a> + lig_vol) - full_vol)/lig_vol ;
<a name="l01157"></a>01157 
<a name="l01158"></a>01158         <span class="comment">/* Ok lets just return the volume Vpok = Nb_in/Niter*Vbox */</span>
<a name="l01159"></a>01159         <span class="keywordflow">return</span> pocket-&gt;<a class="code" href="structs__pocket.html#8acccf468d8c33f26035f1c854a89a42">vol_corresp</a> ;
<a name="l01160"></a>01160 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="fc101509a7044f511ab7ba086f181be4"></a><!-- doxytag: member="tpocket.c::set_mc_overlap_volume" ref="fc101509a7044f511ab7ba086f181be4" args="(s_atm **lig, int natoms, float lig_vol, s_pocket *pocket, int niter)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float set_mc_overlap_volume           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs__atm.html">s_atm</a> **&nbsp;</td>
          <td class="paramname"> <em>lig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>natoms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>lig_vol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs__pocket.html">s_pocket</a> *&nbsp;</td>
          <td class="paramname"> <em>pocket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>niter</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
## FUNCTION: set_mc_overlap_volume<p>
## SPECIFICATION: This function will set an overlap volume between each pocket and the ligand. Method: monte Carlo aproximation.<p>
## PARAMETRES: @ <a class="el" href="structs__atm.html">s_atm</a> **lig : The ligand atoms. @ int natoms natoms : Number of atoms of the ligand. @ float lig_vol : Volume of the ligand @ <a class="el" href="structs__pocket.html">s_pocket</a> *pockets : The pocket @ int niter : Number of monte-carlo iterations<p>
## RETURN: 
<p>Definition at line <a class="el" href="tpocket_8c-source.html#l00924">924</a> of file <a class="el" href="tpocket_8c-source.html">tpocket.c</a>.</p>

<p>References <a class="el" href="voronoi__lst_8h-source.html#l00064">c_lst_vertices::first</a>, <a class="el" href="voronoi__lst_8h-source.html#l00056">node_vertice::next</a>, <a class="el" href="pocket_8h-source.html#l00061">s_pocket::pdesc</a>, <a class="el" href="atom_8h-source.html#l00070">s_atm::radius</a>, <a class="el" href="utils_8c-source.html#l00123">rand_uniform()</a>, <a class="el" href="voronoi_8h-source.html#l00075">s_vvertice::ray</a>, <a class="el" href="pocket_8h-source.html#l00063">s_pocket::v_lst</a>, <a class="el" href="voronoi__lst_8h-source.html#l00058">node_vertice::vertice</a>, <a class="el" href="pocket_8h-source.html#l00064">s_pocket::vol_corresp</a>, <a class="el" href="descriptors_8h-source.html#l00058">s_desc::volume</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::x</a>, <a class="el" href="atom_8h-source.html#l00056">s_atm::x</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::y</a>, <a class="el" href="atom_8h-source.html#l00056">s_atm::y</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::z</a>, and <a class="el" href="atom_8h-source.html#l00056">s_atm::z</a>.</p>

<p>Referenced by <a class="el" href="tpocket_8c-source.html#l00881">set_overlap_volumes()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00926"></a>00926 {
<a name="l00927"></a>00927         <a class="code" href="structc__lst__vertices.html">c_lst_vertices</a> *vertices = pocket-&gt;<a class="code" href="structs__pocket.html#cf07f539404d23c1956373f8c93a4fcc">v_lst</a> ;
<a name="l00928"></a>00928         <a class="code" href="structs__vvertice.html">s_vvertice</a> *vcur = NULL ;
<a name="l00929"></a>00929 
<a name="l00930"></a>00930         <span class="keywordtype">int</span> i = 0, j = 0,
<a name="l00931"></a>00931                 nb_in = 0,
<a name="l00932"></a>00932                 found = 0 ;
<a name="l00933"></a>00933 
<a name="l00934"></a>00934         <span class="keywordtype">float</span> xmin = 0.0, xmax = 0.0,
<a name="l00935"></a>00935                   ymin = 0.0, ymax = 0.0,
<a name="l00936"></a>00936                   zmin = 0.0, zmax = 0.0,
<a name="l00937"></a>00937                   xtmp = 0.0, ytmp = 0.0, ztmp = 0.0,
<a name="l00938"></a>00938                   xr   = 0.0, yr   = 0.0, zr   = 0.0,
<a name="l00939"></a>00939                   vbox = 0.0, full_vol = 0.0;
<a name="l00940"></a>00940 
<a name="l00941"></a>00941         <a class="code" href="structs__atm.html">s_atm</a> *acur = NULL ;
<a name="l00942"></a>00942 
<a name="l00943"></a>00943         <span class="comment">/* First, search extrems coordinates in the ligan */</span>
<a name="l00944"></a>00944         <span class="keywordflow">for</span>(i = 0 ; i &lt; natoms ; i++) {
<a name="l00945"></a>00945                 acur = lig[i] ;
<a name="l00946"></a>00946                 <span class="keywordflow">if</span>(i == 0) {
<a name="l00947"></a>00947                         xmin = acur-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a> - acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a> ; xmax = acur-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a> + acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a> ;
<a name="l00948"></a>00948                         ymin = acur-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a> - acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a> ; ymax = acur-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a> + acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a> ;
<a name="l00949"></a>00949                         zmin = acur-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a> - acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a> ; zmax = acur-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a> + acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a> ;
<a name="l00950"></a>00950                 }
<a name="l00951"></a>00951                 <span class="keywordflow">else</span> {
<a name="l00952"></a>00952                 <span class="comment">/* Update the minimum and maximum extreme point */</span>
<a name="l00953"></a>00953                         <span class="keywordflow">if</span>(xmin &gt; (xtmp = acur-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a> - acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a>)) xmin = xtmp ;
<a name="l00954"></a>00954                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(xmax &lt; (xtmp = acur-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a> + acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a>)) xmax = xtmp ;
<a name="l00955"></a>00955         
<a name="l00956"></a>00956                         <span class="keywordflow">if</span>(ymin &gt; (ytmp = acur-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a> - acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a>)) ymin = ytmp ;
<a name="l00957"></a>00957                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ymax &lt; (ytmp = acur-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a> + acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a>)) ymax = ytmp ;
<a name="l00958"></a>00958         
<a name="l00959"></a>00959                         <span class="keywordflow">if</span>(zmin &gt; (ztmp = acur-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a> - acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a>)) zmin = ztmp ;
<a name="l00960"></a>00960                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(zmax &lt; (ztmp = acur-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a> + acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a>)) zmax = ztmp ;
<a name="l00961"></a>00961                 }
<a name="l00962"></a>00962         }
<a name="l00963"></a>00963 
<a name="l00964"></a>00964         <a class="code" href="structnode__vertice.html">node_vertice</a> *cur = vertices-&gt;<a class="code" href="structc__lst__vertices.html#72562067d308bcfcf32605e112e30c1a">first</a> ;
<a name="l00965"></a>00965         <span class="comment">/* Continue with the pocket */</span>
<a name="l00966"></a>00966         <span class="keywordflow">while</span>(cur) {
<a name="l00967"></a>00967                 vcur = cur-&gt;<a class="code" href="structnode__vertice.html#7e7063f6403dfd8f0a8f83462e27729b">vertice</a> ;
<a name="l00968"></a>00968                 <span class="keywordflow">if</span>(xmin &gt; (xtmp = vcur-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a> - vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a>)) xmin = xtmp ;
<a name="l00969"></a>00969                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(xmax &lt; (xtmp = vcur-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a> + vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a>)) xmax = xtmp ;
<a name="l00970"></a>00970         
<a name="l00971"></a>00971                 <span class="keywordflow">if</span>(ymin &gt; (ytmp = vcur-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a> - vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a>)) ymin = ytmp ;
<a name="l00972"></a>00972                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ymax &lt; (ytmp = vcur-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a> + vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a>)) ymax = ytmp ;
<a name="l00973"></a>00973         
<a name="l00974"></a>00974                 <span class="keywordflow">if</span>(zmin &gt; (ztmp = vcur-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a> - vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a>)) zmin = ztmp ;
<a name="l00975"></a>00975                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(zmax &lt; (ztmp = vcur-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a> + vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a>)) zmax = ztmp ;
<a name="l00976"></a>00976 
<a name="l00977"></a>00977                 cur = cur-&gt;<a class="code" href="structnode__vertice.html#61b34ff349d05cc65a4d8b9e2c77ff3e">next</a> ;
<a name="l00978"></a>00978         }
<a name="l00979"></a>00979 
<a name="l00980"></a>00980 
<a name="l00981"></a>00981         <span class="comment">/* Next calculate the box volume */</span>
<a name="l00982"></a>00982         vbox = (xmax - xmin)*(ymax - ymin)*(zmax - zmin) ;
<a name="l00983"></a>00983 
<a name="l00984"></a>00984         <span class="comment">/* Then apply monte carlo approximation of the volume */</span>
<a name="l00985"></a>00985         <span class="keywordflow">for</span>(i = 0 ; i &lt; niter ; i++) {
<a name="l00986"></a>00986                 found = 0 ;
<a name="l00987"></a>00987                 xr = <a class="code" href="utils_8c.html#5492196e16ed2d16bae1df8483ef79ed">rand_uniform</a>(xmin, xmax) ;
<a name="l00988"></a>00988                 yr = <a class="code" href="utils_8c.html#5492196e16ed2d16bae1df8483ef79ed">rand_uniform</a>(ymin, ymax) ;
<a name="l00989"></a>00989                 zr = <a class="code" href="utils_8c.html#5492196e16ed2d16bae1df8483ef79ed">rand_uniform</a>(zmin, zmax) ;
<a name="l00990"></a>00990 
<a name="l00991"></a>00991                 cur = vertices-&gt;<a class="code" href="structc__lst__vertices.html#72562067d308bcfcf32605e112e30c1a">first</a> ;
<a name="l00992"></a>00992                 <span class="keywordflow">while</span>(cur) {
<a name="l00993"></a>00993                         vcur = cur-&gt;<a class="code" href="structnode__vertice.html#7e7063f6403dfd8f0a8f83462e27729b">vertice</a> ;
<a name="l00994"></a>00994                         xtmp = vcur-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a> - xr ;
<a name="l00995"></a>00995                         ytmp = vcur-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a> - yr ;
<a name="l00996"></a>00996                         ztmp = vcur-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a> - zr ;
<a name="l00997"></a>00997 
<a name="l00998"></a>00998                 <span class="comment">/* Compare r^2 and dist(center, random_point)^2 */</span>
<a name="l00999"></a>00999                         <span class="keywordflow">if</span>((vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a>*vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a>) &gt; (xtmp*xtmp + ytmp*ytmp + ztmp*ztmp)) {
<a name="l01000"></a>01000                         <span class="comment">/* The point is inside one of the vertice!!*/</span> 
<a name="l01001"></a>01001                                 nb_in ++ ; found = 1 ; break ;
<a name="l01002"></a>01002                         }
<a name="l01003"></a>01003                         cur = cur-&gt;<a class="code" href="structnode__vertice.html#61b34ff349d05cc65a4d8b9e2c77ff3e">next</a> ;
<a name="l01004"></a>01004                 }
<a name="l01005"></a>01005 
<a name="l01006"></a>01006                 <span class="keywordflow">if</span>(!found) {
<a name="l01007"></a>01007                         <span class="keywordflow">for</span>(j = 0 ; j &lt; natoms ; j++) {
<a name="l01008"></a>01008                                 acur = lig[j] ;
<a name="l01009"></a>01009                                 xtmp = acur-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a> - xr ;
<a name="l01010"></a>01010                                 ytmp = acur-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a> - yr ;
<a name="l01011"></a>01011                                 ztmp = acur-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a> - zr ;
<a name="l01012"></a>01012         
<a name="l01013"></a>01013                         <span class="comment">/* Compare r^2 and dist(center, random_point)^2 */</span>
<a name="l01014"></a>01014                                 <span class="keywordflow">if</span>((acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a>*acur-&gt;<a class="code" href="structs__atm.html#28c2d3bc2d95eb928ea6b5d37184d7f4">radius</a>) &gt; (xtmp*xtmp + ytmp*ytmp + ztmp*ztmp)) {
<a name="l01015"></a>01015                                 <span class="comment">/* The point is inside one of the vertice!! */</span>
<a name="l01016"></a>01016                                         nb_in ++ ; break ;
<a name="l01017"></a>01017                                 }
<a name="l01018"></a>01018                         }
<a name="l01019"></a>01019                 }
<a name="l01020"></a>01020         }
<a name="l01021"></a>01021 
<a name="l01022"></a>01022         full_vol = ((float)nb_in)/((float)niter)*vbox ; 
<a name="l01023"></a>01023         pocket-&gt;<a class="code" href="structs__pocket.html#8acccf468d8c33f26035f1c854a89a42">vol_corresp</a> = ((pocket-&gt;<a class="code" href="structs__pocket.html#aba02d3ca1a41adf62ad69884c85fed5">pdesc</a>-&gt;<a class="code" href="structs__desc.html#ec106f2a35f5676a6af920311aa4260e">volume</a> + lig_vol) - full_vol)/lig_vol ;
<a name="l01024"></a>01024 
<a name="l01025"></a>01025         <span class="keywordflow">return</span> pocket-&gt;<a class="code" href="structs__pocket.html#8acccf468d8c33f26035f1c854a89a42">vol_corresp</a> ;
<a name="l01026"></a>01026 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="38be2f04793a64026710b077203bb3ea"></a><!-- doxytag: member="tpocket.c::set_overlap_volumes" ref="38be2f04793a64026710b077203bb3ea" args="(s_pocket *pocket, s_atm **lig, int natoms, float lig_vol, s_fparams *params)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float set_overlap_volumes           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs__pocket.html">s_pocket</a> *&nbsp;</td>
          <td class="paramname"> <em>pocket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs__atm.html">s_atm</a> **&nbsp;</td>
          <td class="paramname"> <em>lig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>natoms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>lig_vol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs__fparams.html">s_fparams</a> *&nbsp;</td>
          <td class="paramname"> <em>params</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
-- --<p>
ALL THE FOPLLOWING FUNCTIONS SHOULD BE USED TO CALCULATE AN OVERLAP VOLUME BETWEEN A GIVEN POPCKET AND THE REAL POCKET.<p>
THE FUNCTION set_overlap_volumes WILL SET AN OVERLAP VOLUME FOR EACH POCKET IN THE LIST GIVEN IN ARGUMENT, USING MONTE-CARLO OR BASIC DISCRETE ALGORITHM DEPENDING ON THE PARAMETERS OF THE PROGRAM.<p>
BOTH ALGORITHM CAN BE USED INDEPENDENLTLY WITHOUT THE NEED OF A PARAMETER STRUCTURE (<a class="el" href="structs__fparams.html">s_fparams</a>)<p>
-- -- ## FUNCTION: void set_overlap_volumes<p>
## SPECIFICATION: This function will set an overlap volume between a pocket, defined here by its voronoi vertices, and the ligand. Depending on the parameters, the method used will be either Monte Carlo approximation, or discret basic approximation.<p>
## PARAMETRES: @ <a class="el" href="structs__pocket.html">s_pocket</a> *pockets : The pocket @ <a class="el" href="structs__atm.html">s_atm</a> **lig : The ligand atoms. @ int natoms natoms : Number of atoms of the ligand. @ float lig_vol : Volume of the ligand @ <a class="el" href="structs__fparams.html">s_fparams</a> *params : Parameters, giving the algorithm to use and the corresponding parameter.<p>
## RETURN: float: The overlap volume found 
<p>Definition at line <a class="el" href="tpocket_8c-source.html#l00881">881</a> of file <a class="el" href="tpocket_8c-source.html">tpocket.c</a>.</p>

<p>References <a class="el" href="fparams_8h-source.html#l00141">s_fparams::basic_volume_div</a>, <a class="el" href="voronoi__lst_8h-source.html#l00067">c_lst_vertices::n_vertices</a>, <a class="el" href="fparams_8h-source.html#l00141">s_fparams::nb_mcv_iter</a>, <a class="el" href="tpocket_8c-source.html#l01047">set_basic_overlap_volume()</a>, <a class="el" href="tpocket_8c-source.html#l00924">set_mc_overlap_volume()</a>, and <a class="el" href="pocket_8h-source.html#l00063">s_pocket::v_lst</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00883"></a>00883 {
<a name="l00884"></a>00884         <span class="comment">/* The function to use for calculation */</span>
<a name="l00885"></a>00885         float (*pf_set_vol)(<a class="code" href="structs__atm.html">s_atm</a>**, int, float, <a class="code" href="structs__pocket.html">s_pocket</a>*, int ) = NULL ;      
<a name="l00886"></a>00886         <span class="keywordtype">int</span> crit = 0,
<a name="l00887"></a>00887                 method = 0 ;
<a name="l00888"></a>00888 
<a name="l00889"></a>00889         <span class="keywordflow">if</span>(params-&gt;<a class="code" href="structs__fparams.html#289a1193bf0ffa2f737cd9dc914b63e0">basic_volume_div</a> &lt;= 0) {
<a name="l00890"></a>00890                 pf_set_vol = <a class="code" href="tpocket_8c.html#fc101509a7044f511ab7ba086f181be4">set_mc_overlap_volume</a> ;
<a name="l00891"></a>00891                 crit = params-&gt;<a class="code" href="structs__fparams.html#8caeadbae2db7d24763497290e6b9220">nb_mcv_iter</a> ;
<a name="l00892"></a>00892         }
<a name="l00893"></a>00893         <span class="keywordflow">else</span> {
<a name="l00894"></a>00894                 pf_set_vol = <a class="code" href="tpocket_8c.html#95fe61d30e081cb52dac47d841c562cf">set_basic_overlap_volume</a> ;
<a name="l00895"></a>00895                 crit = params-&gt;<a class="code" href="structs__fparams.html#289a1193bf0ffa2f737cd9dc914b63e0">basic_volume_div</a> ;
<a name="l00896"></a>00896                 method = 1 ;
<a name="l00897"></a>00897         }
<a name="l00898"></a>00898 
<a name="l00899"></a>00899         <span class="keywordflow">if</span>(pocket-&gt;<a class="code" href="structs__pocket.html#cf07f539404d23c1956373f8c93a4fcc">v_lst</a>-&gt;<a class="code" href="structc__lst__vertices.html#390c82c4f8bf495bdaf9c8ea95863c17">n_vertices</a> &gt; 150) {
<a name="l00900"></a>00900                 <span class="keywordflow">if</span>(method == 0 &amp;&amp; crit &lt; 20000) crit = 20000 ;
<a name="l00901"></a>00901         }
<a name="l00902"></a>00902         
<a name="l00903"></a>00903         <span class="keywordflow">return</span> pf_set_vol(lig, natoms, lig_vol, pocket, crit) ;
<a name="l00904"></a>00904 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="8cd4d6f69c53d2fc3655e1a77ae1f0c0"></a><!-- doxytag: member="tpocket.c::test_fpocket" ref="8cd4d6f69c53d2fc3655e1a77ae1f0c0" args="(s_tparams *par)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void test_fpocket           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs__tparams.html">s_tparams</a> *&nbsp;</td>
          <td class="paramname"> <em>par</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
## FUNCTION: test_fpocket<p>
## SPECIFICATION: Test fpocket for a set of pdb files. The output is writen in this function, and consists of two files (see documentation for details)<p>
## PARAMETRES: @ <a class="el" href="structs__tparams.html">s_tparams</a> *par: Parameters, contain the fpocket parameters, and the list of data set information.<p>
## RETURN: void 
<p>Definition at line <a class="el" href="tpocket_8c-source.html#l00082">82</a> of file <a class="el" href="tpocket_8c-source.html">tpocket.c</a>.</p>

<p>References <a class="el" href="tparams_8h-source.html#l00099">s_tparams::fapo</a>, <a class="el" href="tparams_8h-source.html#l00099">s_tparams::fcomplex</a>, <a class="el" href="tparams_8h-source.html#l00099">s_tparams::fligan</a>, <a class="el" href="tparams_8h-source.html#l00115">s_tparams::fpar</a>, <a class="el" href="tparams_8h-source.html#l00104">s_tparams::g_output</a>, <a class="el" href="tpocket_8h-source.html#l00070">M_CRIT4</a>, <a class="el" href="tpocket_8h-source.html#l00071">M_CRIT5</a>, <a class="el" href="tpocket_8h-source.html#l00072">M_CRIT6</a>, <a class="el" href="tpocket_8h-source.html#l00079">M_LIGMASS</a>, <a class="el" href="tpocket_8h-source.html#l00080">M_LIGVOL</a>, <a class="el" href="tpocket_8h-source.html#l00067">M_MAXPCT1</a>, <a class="el" href="tpocket_8h-source.html#l00068">M_MAXPCT2</a>, <a class="el" href="tpocket_8h-source.html#l00069">M_MINDST</a>, <a class="el" href="tpocket_8h-source.html#l00092">M_NATM3</a>, <a class="el" href="tpocket_8h-source.html#l00093">M_NATM6</a>, <a class="el" href="tpocket_8h-source.html#l00066">M_NDDATA</a>, <a class="el" href="tpocket_8h-source.html#l00084">M_NIDATA</a>, <a class="el" href="tpocket_8h-source.html#l00085">M_NPOCKET</a>, <a class="el" href="tpocket_8h-source.html#l00097">M_OK</a>, <a class="el" href="tpocket_8h-source.html#l00073">M_OREL1</a>, <a class="el" href="tpocket_8h-source.html#l00074">M_OREL2</a>, <a class="el" href="tpocket_8h-source.html#l00075">M_OREL3</a>, <a class="el" href="tpocket_8h-source.html#l00076">M_OREL4</a>, <a class="el" href="tpocket_8h-source.html#l00077">M_OREL5</a>, <a class="el" href="tpocket_8h-source.html#l00078">M_OREL6</a>, <a class="el" href="tpocket_8h-source.html#l00081">M_POCKETVOL_C3</a>, <a class="el" href="tpocket_8h-source.html#l00082">M_POCKETVOL_C6</a>, <a class="el" href="tpocket_8h-source.html#l00086">M_POS1</a>, <a class="el" href="tpocket_8h-source.html#l00087">M_POS2</a>, <a class="el" href="tpocket_8h-source.html#l00088">M_POS3</a>, <a class="el" href="tpocket_8h-source.html#l00089">M_POS4</a>, <a class="el" href="tpocket_8h-source.html#l00090">M_POS5</a>, <a class="el" href="tpocket_8h-source.html#l00091">M_POS6</a>, <a class="el" href="tparams_8h-source.html#l00110">s_tparams::nfiles</a>, <a class="el" href="tparams_8h-source.html#l00103">s_tparams::p_output</a>, <a class="el" href="fparams_8h-source.html#l00136">s_fparams::pdb_path</a>, <a class="el" href="utils_8c-source.html#l00638">remove_path()</a>, and <a class="el" href="tpocket_8c-source.html#l00440">test_set()</a>.</p>

<p>Referenced by <a class="el" href="tpmain_8c-source.html#l00063">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00083"></a>00083 {
<a name="l00084"></a>00084         <span class="keywordflow">if</span>(! par || par-&gt;<a class="code" href="structs__tparams.html#143ed7e330d24052d70eb0bdd4852f56">nfiles</a> &lt;= 0)  return ;
<a name="l00085"></a>00085         
<a name="l00086"></a>00086         <span class="keywordtype">int</span> nranks = 13,  novlp = 5, novlp2 = 9,novlp3 = 8,
<a name="l00087"></a>00087                 i, j, k, nok = 0  ;
<a name="l00088"></a>00088         <span class="keywordtype">int</span> ranks [] = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 15, 20, 50} ;
<a name="l00089"></a>00089         <span class="keywordtype">float</span> ovlp[] = {50.0, 60.0, 70.0, 80.0,90.0} ;
<a name="l00090"></a>00090         <span class="keywordtype">float</span> ovlp2[] = {0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 0.9, 1.0} ;
<a name="l00091"></a>00091         <span class="keywordtype">float</span> ovlp3[] = {0.2, 0.25, 0.3, 0.35, 0.4, 0.5, 0.6, 0.7} ;
<a name="l00092"></a>00092         
<a name="l00093"></a>00093         <span class="keywordtype">float</span> mean_ov1 = 0.0, mean_ov2 = 0.0, mean_dst = 0.0, mean_ov4 = 0.0, mean_ov5 = 0.0,
<a name="l00094"></a>00094                   mean_ovr1 = 0.0, mean_ovr2 = 0.0, mean_ovr3 = 0.0, mean_ovr4 = 0.0, mean_ovr5 = 0.0, mean_ovr6 = 0.0,
<a name="l00095"></a>00095                   mean_pvol3 = 0.0, mean_pvol6 = 0.0 ;
<a name="l00096"></a>00096 
<a name="l00097"></a>00097         <span class="keywordtype">float</span> mean_lvol = 0.0 ;
<a name="l00098"></a>00098         <span class="keywordtype">int</span> mean_nbatm3 = 0, mean_nbatm6 = 0 ;
<a name="l00099"></a>00099         
<a name="l00100"></a>00100         <span class="keywordtype">int</span> n1, n2, n3, n4, n5, n6, N = 0 ;
<a name="l00101"></a>00101 
<a name="l00102"></a>00102         <span class="comment">/* Store statistics for each files: */</span>
<a name="l00103"></a>00103         <span class="keywordtype">int</span> status[par-&gt;<a class="code" href="structs__tparams.html#143ed7e330d24052d70eb0bdd4852f56">nfiles</a>] ;
<a name="l00104"></a>00104         <span class="keywordtype">float</span> ddata [par-&gt;<a class="code" href="structs__tparams.html#143ed7e330d24052d70eb0bdd4852f56">nfiles</a>][<a class="code" href="tpocket_8h.html#8e2e371b1d4305b46b40d120308df192">M_NDDATA</a>];
<a name="l00105"></a>00105         <span class="keywordtype">int</span> idata [par-&gt;<a class="code" href="structs__tparams.html#143ed7e330d24052d70eb0bdd4852f56">nfiles</a>][<a class="code" href="tpocket_8h.html#a5ae97e569e24bb806371eb76491a0fd">M_NIDATA</a>];
<a name="l00106"></a>00106 
<a name="l00107"></a>00107         <span class="comment">/* Test all files */</span>
<a name="l00108"></a>00108         <span class="keywordflow">for</span>(i = 0 ; i &lt; par-&gt;<a class="code" href="structs__tparams.html#143ed7e330d24052d70eb0bdd4852f56">nfiles</a> ; i++) {
<a name="l00109"></a>00109                 strcpy(par-&gt;<a class="code" href="structs__tparams.html#b6b1c97feba279871d8135b46d53d457">fpar</a>-&gt;<a class="code" href="structs__fparams.html#4e1b3892d1e42947408cdcaed497bf97">pdb_path</a>, par-&gt;<a class="code" href="structs__tparams.html#c04974099c0ce34a0c8a4df7c91f3f43">fapo</a>[i]) ;
<a name="l00110"></a>00110                 status [i] = <a class="code" href="tpocket_8c.html#ef1f6d3f495f1245b15ee0507078f853">test_set</a>(par, i, ddata, idata) ;
<a name="l00111"></a>00111                 fprintf(stdout, <span class="stringliteral">"&gt; %3d : %s output code %d"</span>, i+1, par-&gt;<a class="code" href="structs__tparams.html#c04974099c0ce34a0c8a4df7c91f3f43">fapo</a>[i],
<a name="l00112"></a>00112                                                                                                            status [i]) ;
<a name="l00113"></a>00113                 <span class="keywordflow">if</span>(i == par-&gt;<a class="code" href="structs__tparams.html#143ed7e330d24052d70eb0bdd4852f56">nfiles</a> - 1) fprintf(stdout, <span class="stringliteral">"\n"</span>) ;
<a name="l00114"></a>00114                 <span class="keywordflow">else</span> fprintf(stdout, <span class="stringliteral">"\r"</span>) ;
<a name="l00115"></a>00115                 fflush(stdout) ;
<a name="l00116"></a>00116 
<a name="l00117"></a>00117                 <span class="keywordflow">if</span>(status[i] == <a class="code" href="tpocket_8h.html#5cd6feedc59d55eefbb739b3e8546b74">M_OK</a>) N++ ;
<a name="l00118"></a>00118         }
<a name="l00119"></a>00119 
<a name="l00120"></a>00120         <span class="comment">/* Printing each complexe statistics */</span>
<a name="l00121"></a>00121         FILE *fp = fopen(par-&gt;<a class="code" href="structs__tparams.html#d6498c7e5aab53c03e2e6e28ab20cf5b">p_output</a>, <span class="stringliteral">"w"</span>) ;
<a name="l00122"></a>00122         <span class="keywordflow">if</span>(fp) {
<a name="l00123"></a>00123                 n1 = 0, n2 = 0, n3 = 0, n4 = 0, n5 = 0, n6 = 0 ;
<a name="l00124"></a>00124                 fprintf(fp, <span class="stringliteral">"LIG | COMPLEXE | APO | NB_PCK | CRIT1 | CRIT2 | CRIT3 | CRIT4 | CRIT5 | CRIT6 | POS1 | POS2 | POS3 | POS4 | POS5 | POS6 | REL_OVLP1 | REL_OVLP2 | REL_OVLP3 | REL_OVLP4 | REL_OVLP5 | REL_OVLP6 | LIGMASS | LIGVOL | PVOL3 | NATM3 | PVOL6 | NATM6 \n"</span>) ;
<a name="l00125"></a>00125                 <span class="keywordflow">for</span>(i = 0 ; i &lt; par-&gt;<a class="code" href="structs__tparams.html#143ed7e330d24052d70eb0bdd4852f56">nfiles</a> ; i++) {
<a name="l00126"></a>00126                         <a class="code" href="utils_8c.html#9096591006dbde3b8c0bca29e6943c4d">remove_path</a>(par-&gt;<a class="code" href="structs__tparams.html#02f5ffbfc8da616c952b154ad889e91a">fcomplex</a>[i]) ;
<a name="l00127"></a>00127                         <a class="code" href="utils_8c.html#9096591006dbde3b8c0bca29e6943c4d">remove_path</a>(par-&gt;<a class="code" href="structs__tparams.html#c04974099c0ce34a0c8a4df7c91f3f43">fapo</a>[i]) ;
<a name="l00128"></a>00128                         <span class="keywordflow">if</span>(status[i] == <a class="code" href="tpocket_8h.html#5cd6feedc59d55eefbb739b3e8546b74">M_OK</a>) {
<a name="l00129"></a>00129                                 fprintf(fp, <span class="stringliteral">"%s %s %s %5d %7.2f %7.2f %7.2f %7.2f %7.2f %7.2f %4d %4d %4d %4d %4d %4d %8.2f %8.2f %8.2f %8.2f %8.2f %8.2f %9.2f %9.2f %12.2f %4d %12.2f %4d\n"</span>,
<a name="l00130"></a>00130                                                 par-&gt;<a class="code" href="structs__tparams.html#e613f8bd5bff9e433a427643c0127a0a">fligan</a>[i], par-&gt;<a class="code" href="structs__tparams.html#02f5ffbfc8da616c952b154ad889e91a">fcomplex</a>[i], par-&gt;<a class="code" href="structs__tparams.html#c04974099c0ce34a0c8a4df7c91f3f43">fapo</a>[i], idata[i][<a class="code" href="tpocket_8h.html#e5cbb0ee984e561f26cb5e5b3711ccd2">M_NPOCKET</a>],
<a name="l00131"></a>00131                                                 ddata[i][<a class="code" href="tpocket_8h.html#9ee7191c5cb85afe6431ca9e8bb78b84">M_MAXPCT1</a>], ddata[i][<a class="code" href="tpocket_8h.html#a7cf116f3abc05c7b85010a420fb2030">M_MAXPCT2</a>], ddata[i][<a class="code" href="tpocket_8h.html#0c30519fdb73369454e676c767169b21">M_MINDST</a>], ddata[i][<a class="code" href="tpocket_8h.html#43f46c8a7ba58d495585d938e4656df6">M_CRIT4</a>], ddata[i][<a class="code" href="tpocket_8h.html#f3720a200eb98c961e42ae97d1fb2698">M_CRIT5</a>], ddata[i][<a class="code" href="tpocket_8h.html#f2058736b04fdb6d2aea24275af14bf6">M_CRIT6</a>],
<a name="l00132"></a>00132                                                 idata[i][<a class="code" href="tpocket_8h.html#55d6185709100ab5f72c2ae09abd787d">M_POS1</a>], idata[i][<a class="code" href="tpocket_8h.html#f701a979ab853364762799988141247c">M_POS2</a>], idata[i][<a class="code" href="tpocket_8h.html#80a692e7785aa31225ca543a481789ad">M_POS3</a>], idata[i][<a class="code" href="tpocket_8h.html#bb10da42f932a55e6f7469e082397fe0">M_POS4</a>], idata[i][<a class="code" href="tpocket_8h.html#de47012f24417359f7401df0e6d3b222">M_POS5</a>], idata[i][<a class="code" href="tpocket_8h.html#55c83a9eb2be092f1f272142b3714c32">M_POS6</a>],
<a name="l00133"></a>00133                                                 ddata[i][<a class="code" href="tpocket_8h.html#79d6e70ebf2aed6ffebd46f2b372f500">M_OREL1</a>], ddata[i][<a class="code" href="tpocket_8h.html#00d02fbf3b639031a1dac1143ebe05f8">M_OREL2</a>], ddata[i][<a class="code" href="tpocket_8h.html#9f33fc9d82bcb1d94ef6979c95728cb6">M_OREL3</a>], ddata[i][<a class="code" href="tpocket_8h.html#0af1271fc889dca4c82976712cc0a403">M_OREL4</a>], ddata[i][<a class="code" href="tpocket_8h.html#ebcf9560e00b7e3828b834b830a1e72f">M_OREL5</a>], ddata[i][<a class="code" href="tpocket_8h.html#4f6b6a46252c705fd388816519c92bc6">M_OREL6</a>],
<a name="l00134"></a>00134                                                 ddata[i][<a class="code" href="tpocket_8h.html#a8a643689a5895de4cfd867bfc8b447e">M_LIGMASS</a>], ddata[i][<a class="code" href="tpocket_8h.html#28cb3f177a19e81236bad5ec7d0b4f70">M_LIGVOL</a>], ddata[i][<a class="code" href="tpocket_8h.html#d0de25ca6d220d4503697cb27f797855">M_POCKETVOL_C3</a>], idata[i][<a class="code" href="tpocket_8h.html#d960be284bbc7a000c1fc5f6f9141443">M_NATM3</a>], ddata[i][<a class="code" href="tpocket_8h.html#417edad52d6d7e0e74845144192f8597">M_POCKETVOL_C6</a>], idata[i][<a class="code" href="tpocket_8h.html#21e61378a50f50ce77c9187fae3c678b">M_NATM6</a>]) ;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136                                 <span class="keywordflow">if</span>(idata[i][<a class="code" href="tpocket_8h.html#55d6185709100ab5f72c2ae09abd787d">M_POS1</a>] &gt; 0) {
<a name="l00137"></a>00137                                         mean_ov1 += ddata[i][<a class="code" href="tpocket_8h.html#9ee7191c5cb85afe6431ca9e8bb78b84">M_MAXPCT1</a>] ;
<a name="l00138"></a>00138                                         mean_ovr1 += ddata[i][<a class="code" href="tpocket_8h.html#79d6e70ebf2aed6ffebd46f2b372f500">M_OREL1</a>];
<a name="l00139"></a>00139                                         n1++ ;
<a name="l00140"></a>00140                                 }
<a name="l00141"></a>00141 
<a name="l00142"></a>00142                                 <span class="keywordflow">if</span>(idata[i][<a class="code" href="tpocket_8h.html#f701a979ab853364762799988141247c">M_POS2</a>] &gt; 0) {
<a name="l00143"></a>00143                                         mean_ov2 += ddata[i][<a class="code" href="tpocket_8h.html#a7cf116f3abc05c7b85010a420fb2030">M_MAXPCT2</a>] ;
<a name="l00144"></a>00144                                         mean_ovr2 += ddata[i][<a class="code" href="tpocket_8h.html#00d02fbf3b639031a1dac1143ebe05f8">M_OREL2</a>];
<a name="l00145"></a>00145                                         n2++ ;
<a name="l00146"></a>00146                                 }
<a name="l00147"></a>00147 
<a name="l00148"></a>00148                                 <span class="keywordflow">if</span>(idata[i][<a class="code" href="tpocket_8h.html#80a692e7785aa31225ca543a481789ad">M_POS3</a>] &gt; 0) {
<a name="l00149"></a>00149                                         mean_dst += ddata[i][<a class="code" href="tpocket_8h.html#0c30519fdb73369454e676c767169b21">M_MINDST</a>];
<a name="l00150"></a>00150                                         mean_ovr3 += ddata[i][<a class="code" href="tpocket_8h.html#9f33fc9d82bcb1d94ef6979c95728cb6">M_OREL3</a>];
<a name="l00151"></a>00151                                         mean_pvol3 += ddata[i][<a class="code" href="tpocket_8h.html#d0de25ca6d220d4503697cb27f797855">M_POCKETVOL_C3</a>] ;
<a name="l00152"></a>00152                                         mean_nbatm3 += idata[i][<a class="code" href="tpocket_8h.html#d960be284bbc7a000c1fc5f6f9141443">M_NATM3</a>] ;
<a name="l00153"></a>00153                                         n3 ++ ;
<a name="l00154"></a>00154                                 }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156                                 <span class="keywordflow">if</span>(idata[i][<a class="code" href="tpocket_8h.html#bb10da42f932a55e6f7469e082397fe0">M_POS4</a>] &gt; 0) {
<a name="l00157"></a>00157                                         mean_ov4 += ddata[i][<a class="code" href="tpocket_8h.html#43f46c8a7ba58d495585d938e4656df6">M_CRIT4</a>];
<a name="l00158"></a>00158                                         mean_ovr4 += ddata[i][<a class="code" href="tpocket_8h.html#0af1271fc889dca4c82976712cc0a403">M_OREL4</a>];
<a name="l00159"></a>00159                                         n4 ++ ;
<a name="l00160"></a>00160                                 }
<a name="l00161"></a>00161 
<a name="l00162"></a>00162                                 <span class="keywordflow">if</span>(idata[i][<a class="code" href="tpocket_8h.html#de47012f24417359f7401df0e6d3b222">M_POS5</a>] &gt; 0) {
<a name="l00163"></a>00163                                         mean_ov5 += ddata[i][<a class="code" href="tpocket_8h.html#f3720a200eb98c961e42ae97d1fb2698">M_CRIT5</a>];
<a name="l00164"></a>00164                                         mean_ovr5 += ddata[i][<a class="code" href="tpocket_8h.html#ebcf9560e00b7e3828b834b830a1e72f">M_OREL5</a>];
<a name="l00165"></a>00165                                         n5 ++ ;
<a name="l00166"></a>00166                                 }
<a name="l00167"></a>00167 
<a name="l00168"></a>00168                                 <span class="keywordflow">if</span>(idata[i][<a class="code" href="tpocket_8h.html#55c83a9eb2be092f1f272142b3714c32">M_POS6</a>] &gt; 0) {
<a name="l00169"></a>00169                                         mean_ovr6 += ddata[i][<a class="code" href="tpocket_8h.html#ebcf9560e00b7e3828b834b830a1e72f">M_OREL5</a>];
<a name="l00170"></a>00170                                         mean_pvol6 += ddata[i][<a class="code" href="tpocket_8h.html#417edad52d6d7e0e74845144192f8597">M_POCKETVOL_C6</a>] ;
<a name="l00171"></a>00171                                         mean_nbatm6 += idata[i][<a class="code" href="tpocket_8h.html#21e61378a50f50ce77c9187fae3c678b">M_NATM6</a>] ;
<a name="l00172"></a>00172                                         n6 ++ ;
<a name="l00173"></a>00173                                 }
<a name="l00174"></a>00174                         }
<a name="l00175"></a>00175                         <span class="keywordflow">else</span> {
<a name="l00176"></a>00176                                 fprintf(fp, <span class="stringliteral">"%s %s %s %5d %7.2f %7.2f %7.2f %7.2f %7.2f %7.2f %4d %4d %4d %4d %4d %4d %8.2f %8.2f %8.2f %8.2f %8.2f %8.2f %9.2f %9.2f %12.2f %4d %12.2f %4d \n"</span>,
<a name="l00177"></a>00177                                                 par-&gt;<a class="code" href="structs__tparams.html#e613f8bd5bff9e433a427643c0127a0a">fligan</a>[i], par-&gt;<a class="code" href="structs__tparams.html#02f5ffbfc8da616c952b154ad889e91a">fcomplex</a>[i], par-&gt;<a class="code" href="structs__tparams.html#c04974099c0ce34a0c8a4df7c91f3f43">fapo</a>[i], -1, 
<a name="l00178"></a>00178                                                 -1.0, -1.0, -1.0, -1.0, -1.0, -1.0,
<a name="l00179"></a>00179                                                 -1, -1, -1, -1, -1, -1,
<a name="l00180"></a>00180                                                 -1.0, -1.0, -1.0, -1.0, -1.0, -1.0,
<a name="l00181"></a>00181                                                 -1.0, -1.0, -1.0, -1, -1.0, -1) ;
<a name="l00182"></a>00182                         }
<a name="l00183"></a>00183                         mean_lvol += ddata[i][<a class="code" href="tpocket_8h.html#28cb3f177a19e81236bad5ec7d0b4f70">M_LIGVOL</a>] ;
<a name="l00184"></a>00184                 }
<a name="l00185"></a>00185 
<a name="l00186"></a>00186                 mean_ov1 /= (float) n1 ; mean_ovr1 /= (float) n1 ;
<a name="l00187"></a>00187                 mean_ov2 /= (float) n2 ; mean_ovr2 /= (float) n2 ;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189                 mean_dst /= (float) n3 ; mean_ovr3 /= (float) n3 ;
<a name="l00190"></a>00190                 mean_pvol3 /= (float) n3 ;
<a name="l00191"></a>00191                 mean_nbatm3 /= (float) n3 ;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193                 mean_ov4 /= (float) n4 ; mean_ovr4 /= (float) n4 ;
<a name="l00194"></a>00194                 mean_ov5 /= (float) n5 ; mean_ovr5 /= (float) n5 ;
<a name="l00195"></a>00195                 
<a name="l00196"></a>00196                 mean_ovr6 /= (float) n6 ;
<a name="l00197"></a>00197                 mean_pvol6 /= (float) n6 ;
<a name="l00198"></a>00198                 mean_nbatm6 /= (float) n6 ;
<a name="l00199"></a>00199 
<a name="l00200"></a>00200                 mean_lvol /= (float) par-&gt;<a class="code" href="structs__tparams.html#143ed7e330d24052d70eb0bdd4852f56">nfiles</a> ;
<a name="l00201"></a>00201 
<a name="l00202"></a>00202                 fclose(fp) ;
<a name="l00203"></a>00203         }
<a name="l00204"></a>00204         <span class="keywordflow">else</span> fprintf(stdout, <span class="stringliteral">"The file %s could not be opened\n"</span>, par-&gt;<a class="code" href="structs__tparams.html#d6498c7e5aab53c03e2e6e28ab20cf5b">p_output</a>) ;
<a name="l00205"></a>00205 
<a name="l00206"></a>00206         <span class="comment">/* Printing global statistics */</span>
<a name="l00207"></a>00207         FILE *fg = fopen(par-&gt;<a class="code" href="structs__tparams.html#bb1ee051c4e5c66e60d68d2087b3b1ef">g_output</a>, <span class="stringliteral">"w"</span>) ;
<a name="l00208"></a>00208         <span class="keywordflow">if</span>(fg) {
<a name="l00209"></a>00209                 <span class="comment">/* Write the first criteria statistics */</span>
<a name="l00210"></a>00210                 fprintf(fg, <span class="stringliteral">"===================== General statistics on all complexes =======================\n"</span>) ;
<a name="l00211"></a>00211 
<a name="l00212"></a>00212 
<a name="l00213"></a>00213                 <span class="comment">/* Write the first criteria statistics */</span>
<a name="l00214"></a>00214                 fprintf(fg, <span class="stringliteral">"\n\t--\n"</span>) ;
<a name="l00215"></a>00215                 fprintf(fg,   <span class="stringliteral">"\t-                       _ Distance criteria _                      -\n"</span>) ;
<a name="l00216"></a>00216                 fprintf(fg,   <span class="stringliteral">"\t--\n\n"</span>) ;
<a name="l00217"></a>00217                 fprintf(fg, <span class="stringliteral">"   Ratio of good predictions (dist = 4A) \n"</span>) ;
<a name="l00218"></a>00218                 fprintf(fg, <span class="stringliteral">"\n"</span>) ;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220                 <span class="keywordflow">for</span>(i = 0 ; i &lt; nranks ; i++) {
<a name="l00221"></a>00221                         nok = 0 ;
<a name="l00222"></a>00222                         <span class="keywordflow">for</span>(k = 0 ; k &lt; par-&gt;<a class="code" href="structs__tparams.html#143ed7e330d24052d70eb0bdd4852f56">nfiles</a> ; k++) {
<a name="l00223"></a>00223                                 <span class="keywordflow">if</span>(status[k] == <a class="code" href="tpocket_8h.html#5cd6feedc59d55eefbb739b3e8546b74">M_OK</a> &amp;&amp; idata[k][<a class="code" href="tpocket_8h.html#80a692e7785aa31225ca543a481789ad">M_POS3</a>] &lt;= ranks[i]
<a name="l00224"></a>00224                                 &amp;&amp; idata[k][<a class="code" href="tpocket_8h.html#80a692e7785aa31225ca543a481789ad">M_POS3</a>] &gt; 0) {
<a name="l00225"></a>00225                                         nok ++ ;
<a name="l00226"></a>00226                                 }
<a name="l00227"></a>00227                         }
<a name="l00228"></a>00228                         <span class="comment">//printf("%d NOK: %d, %d, %f\n", ranks[i], nok, N, ((float)nok) / ((float) N)) ;</span>
<a name="l00229"></a>00229                         fprintf(fg, <span class="stringliteral">"Rank &lt;= %2d  :\t\t%6.2f\n"</span>, ranks[i],
<a name="l00230"></a>00230                                         ((<span class="keywordtype">float</span>)nok) / ((<span class="keywordtype">float</span>) N)) ;
<a name="l00231"></a>00231                 }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233                 fprintf(fg, <span class="stringliteral">"-\n"</span>) ;
<a name="l00234"></a>00234                 fprintf(fg, <span class="stringliteral">"Mean distance                   : %8.2f\n"</span>, mean_dst) ;
<a name="l00235"></a>00235                 fprintf(fg, <span class="stringliteral">"Mean relative overlap           : %8.2f\n"</span>, mean_ovr3) ;
<a name="l00236"></a>00236                 fprintf(fg, <span class="stringliteral">"Mean pocket volume (estimation) : %8.2f\n"</span>, mean_pvol3) ;
<a name="l00237"></a>00237                 fprintf(fg, <span class="stringliteral">"Mean ligand volume (estimation) : %8.2f\n"</span>, mean_lvol) ;
<a name="l00238"></a>00238                 fprintf(fg, <span class="stringliteral">"Mean number of pocket atom      : %4d\n"</span>, mean_nbatm3) ;
<a name="l00239"></a>00239 
<a name="l00240"></a>00240 
<a name="l00241"></a>00241                 <span class="comment">/* Write the 2nd criteria statistics */</span>
<a name="l00242"></a>00242                 fprintf(fg, <span class="stringliteral">"\n\t--\n"</span>) ;
<a name="l00243"></a>00243                 fprintf(fg,   <span class="stringliteral">"\t- _ 1st overlap criteria (use of ligand's alpha sphere neighbors)_ -\n"</span>) ;
<a name="l00244"></a>00244                 fprintf(fg,   <span class="stringliteral">"\t--\n\n"</span>) ;
<a name="l00245"></a>00245                 fprintf(fg,<span class="stringliteral">"           :"</span>);
<a name="l00246"></a>00246                 <span class="keywordflow">for</span>( j = 0 ; j &lt; novlp ; j++) {
<a name="l00247"></a>00247                                 fprintf(fg, <span class="stringliteral">"  &gt;%5.2f  :"</span>, ovlp[j]) ;
<a name="l00248"></a>00248                 }
<a name="l00249"></a>00249                 fprintf(fg,<span class="stringliteral">"\n"</span>);
<a name="l00250"></a>00250                 fprintf(fg,<span class="stringliteral">"--"</span>);
<a name="l00251"></a>00251                 <span class="keywordflow">for</span>( j = 0 ; j &lt; novlp ; j++) {
<a name="l00252"></a>00252                         fprintf(fg, <span class="stringliteral">"-"</span>) ;
<a name="l00253"></a>00253                 }
<a name="l00254"></a>00254                 fprintf(fg,<span class="stringliteral">"\n"</span>);
<a name="l00255"></a>00255                 
<a name="l00256"></a>00256                 <span class="keywordflow">for</span>(i = 0 ; i &lt; nranks ; i++) {
<a name="l00257"></a>00257                         fprintf(fg, <span class="stringliteral">"Rank &lt;= %2d :"</span>, ranks[i]) ;
<a name="l00258"></a>00258                         <span class="keywordflow">for</span>( j = 0 ; j &lt; novlp ; j++) {
<a name="l00259"></a>00259                                 nok = 0 ;
<a name="l00260"></a>00260                                 <span class="keywordflow">for</span>(k = 0 ; k &lt; par-&gt;<a class="code" href="structs__tparams.html#143ed7e330d24052d70eb0bdd4852f56">nfiles</a> ; k++) {
<a name="l00261"></a>00261                                         <span class="keywordflow">if</span>( status[k] == <a class="code" href="tpocket_8h.html#5cd6feedc59d55eefbb739b3e8546b74">M_OK</a> &amp;&amp;
<a name="l00262"></a>00262                                                 ddata[k][<a class="code" href="tpocket_8h.html#a7cf116f3abc05c7b85010a420fb2030">M_MAXPCT2</a>] &gt;= ovlp[j] &amp;&amp;
<a name="l00263"></a>00263                                                 idata[k][<a class="code" href="tpocket_8h.html#f701a979ab853364762799988141247c">M_POS2</a>] &lt;= ranks[i] &amp;&amp;
<a name="l00264"></a>00264                                                 idata[k][<a class="code" href="tpocket_8h.html#f701a979ab853364762799988141247c">M_POS2</a>] &gt; 0) {
<a name="l00265"></a>00265                                                 nok ++ ;
<a name="l00266"></a>00266                                         }
<a name="l00267"></a>00267                                 }
<a name="l00268"></a>00268                                 fprintf(fg, <span class="stringliteral">"  %6.2f  :"</span>, ((<span class="keywordtype">float</span>)nok) / ((<span class="keywordtype">float</span>) N)) ;
<a name="l00269"></a>00269                         }
<a name="l00270"></a>00270                         fprintf(fg, <span class="stringliteral">"\n"</span>) ;
<a name="l00271"></a>00271                 }
<a name="l00272"></a>00272                 fprintf(fg, <span class="stringliteral">"-\n"</span>) ;
<a name="l00273"></a>00273                 fprintf(fg, <span class="stringliteral">"Mean overlap          : %8.2f\n"</span>, mean_ov2) ;
<a name="l00274"></a>00274                 fprintf(fg, <span class="stringliteral">"Mean relative overlap : %8.2f\n"</span>, mean_ovr2) ;
<a name="l00275"></a>00275 
<a name="l00276"></a>00276                 <span class="comment">/* Write the 3rd criteria statistics */</span>
<a name="l00277"></a>00277                 
<a name="l00278"></a>00278                 fprintf(fg, <span class="stringliteral">"\n\t--\n"</span>) ;
<a name="l00279"></a>00279                 fprintf(fg,   <span class="stringliteral">"\t-        _ 2nd overlap criteria (simple distance criteria) _       -\n"</span>) ;
<a name="l00280"></a>00280                 fprintf(fg,   <span class="stringliteral">"\t--\n\n"</span>) ;
<a name="l00281"></a>00281                 fprintf(fg,<span class="stringliteral">"           :"</span>);
<a name="l00282"></a>00282 
<a name="l00283"></a>00283                 <span class="keywordflow">for</span>( j = 0 ; j &lt; novlp ; j++) {
<a name="l00284"></a>00284                                 fprintf(fg, <span class="stringliteral">"  &gt;%5.2f  :"</span>, ovlp[j]) ;
<a name="l00285"></a>00285                 }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287                 fprintf(fg,<span class="stringliteral">"\n"</span>);
<a name="l00288"></a>00288                 fprintf(fg,<span class="stringliteral">"---"</span>);
<a name="l00289"></a>00289 
<a name="l00290"></a>00290                 <span class="keywordflow">for</span>( j = 0 ; j &lt; novlp ; j++) {
<a name="l00291"></a>00291                         fprintf(fg, <span class="stringliteral">"-"</span>) ;
<a name="l00292"></a>00292                 }
<a name="l00293"></a>00293                 fprintf(fg,<span class="stringliteral">"\n"</span>);
<a name="l00294"></a>00294 
<a name="l00295"></a>00295                 <span class="keywordflow">for</span>(i = 0 ; i &lt; nranks ; i++) {
<a name="l00296"></a>00296                         fprintf(fg, <span class="stringliteral">"Rank &lt;= %2d :"</span>, ranks[i]) ;
<a name="l00297"></a>00297                         <span class="keywordflow">for</span>( j = 0 ; j &lt; novlp ; j++) {
<a name="l00298"></a>00298                                 nok = 0 ;
<a name="l00299"></a>00299                                 <span class="keywordflow">for</span>(k = 0 ; k &lt; par-&gt;<a class="code" href="structs__tparams.html#143ed7e330d24052d70eb0bdd4852f56">nfiles</a> ; k++) {
<a name="l00300"></a>00300                                         <span class="keywordflow">if</span>( status[k] == <a class="code" href="tpocket_8h.html#5cd6feedc59d55eefbb739b3e8546b74">M_OK</a>
<a name="l00301"></a>00301                                                 &amp;&amp; ddata[k][<a class="code" href="tpocket_8h.html#9ee7191c5cb85afe6431ca9e8bb78b84">M_MAXPCT1</a>] &gt;= ovlp[j]
<a name="l00302"></a>00302                                                 &amp;&amp; idata[k][<a class="code" href="tpocket_8h.html#55d6185709100ab5f72c2ae09abd787d">M_POS1</a>] &lt;= ranks[i]
<a name="l00303"></a>00303                                                 &amp;&amp; idata[k][<a class="code" href="tpocket_8h.html#55d6185709100ab5f72c2ae09abd787d">M_POS1</a>] &gt; 0) {
<a name="l00304"></a>00304                                                 nok ++ ;
<a name="l00305"></a>00305                                         }
<a name="l00306"></a>00306                                 }
<a name="l00307"></a>00307                                 fprintf(fg, <span class="stringliteral">"  %6.2f  :"</span>, ((<span class="keywordtype">float</span>)nok) / ((<span class="keywordtype">float</span>) N)) ;
<a name="l00308"></a>00308                         }
<a name="l00309"></a>00309                         fprintf(fg, <span class="stringliteral">"\n"</span>) ;
<a name="l00310"></a>00310                 }
<a name="l00311"></a>00311                 fprintf(fg, <span class="stringliteral">"-\n"</span>) ;
<a name="l00312"></a>00312                 fprintf(fg, <span class="stringliteral">"Mean overlap          : %f\n"</span>, mean_ov1) ;
<a name="l00313"></a>00313                 fprintf(fg, <span class="stringliteral">"Mean relative overlap : %f\n"</span>, mean_ovr1) ;
<a name="l00314"></a>00314 
<a name="l00315"></a>00315                 <span class="comment">/* Write the 4th criteria statistics */</span>
<a name="l00316"></a>00316                 
<a name="l00317"></a>00317                 fprintf(fg, <span class="stringliteral">"\n\t--\n"</span>) ;
<a name="l00318"></a>00318                 fprintf(fg,   <span class="stringliteral">"\t-          _ 4th overlap criteria (alpha sphere overlap) _         -\n"</span>) ;
<a name="l00319"></a>00319                 fprintf(fg,   <span class="stringliteral">"\t--\n\n"</span>) ;
<a name="l00320"></a>00320                 fprintf(fg,<span class="stringliteral">"           :"</span>);
<a name="l00321"></a>00321                 <span class="keywordflow">for</span>( j = 0 ; j &lt; novlp2 ; j++) {
<a name="l00322"></a>00322                                 fprintf(fg, <span class="stringliteral">"  &gt;%5.2f  :"</span>, ovlp2[j]) ;
<a name="l00323"></a>00323                 }
<a name="l00324"></a>00324                 fprintf(fg,<span class="stringliteral">"\n"</span>);
<a name="l00325"></a>00325                 fprintf(fg,<span class="stringliteral">"----"</span>);
<a name="l00326"></a>00326                 <span class="keywordflow">for</span>( j = 0 ; j &lt; novlp2 ; j++) {
<a name="l00327"></a>00327                         fprintf(fg, <span class="stringliteral">"-"</span>) ;
<a name="l00328"></a>00328                 }
<a name="l00329"></a>00329                 fprintf(fg,<span class="stringliteral">"\n"</span>);
<a name="l00330"></a>00330 
<a name="l00331"></a>00331                 <span class="keywordflow">for</span>(i = 0 ; i &lt; nranks ; i++) {
<a name="l00332"></a>00332                         fprintf(fg, <span class="stringliteral">"Rank &lt;= %2d :"</span>, ranks[i]) ;
<a name="l00333"></a>00333                         <span class="keywordflow">for</span>( j = 0 ; j &lt; novlp2 ; j++) {
<a name="l00334"></a>00334                                 nok = 0 ;
<a name="l00335"></a>00335                                 <span class="keywordflow">for</span>(k = 0 ; k &lt; par-&gt;<a class="code" href="structs__tparams.html#143ed7e330d24052d70eb0bdd4852f56">nfiles</a> ; k++) {
<a name="l00336"></a>00336                                         <span class="keywordflow">if</span>( status[k] == <a class="code" href="tpocket_8h.html#5cd6feedc59d55eefbb739b3e8546b74">M_OK</a> &amp;&amp;
<a name="l00337"></a>00337                                                 ddata[k][<a class="code" href="tpocket_8h.html#43f46c8a7ba58d495585d938e4656df6">M_CRIT4</a>] &gt;= ovlp2[j] &amp;&amp;
<a name="l00338"></a>00338                                                 idata[k][<a class="code" href="tpocket_8h.html#bb10da42f932a55e6f7469e082397fe0">M_POS4</a>] &lt;= ranks[i] &amp;&amp;
<a name="l00339"></a>00339                                                 idata[k][<a class="code" href="tpocket_8h.html#bb10da42f932a55e6f7469e082397fe0">M_POS4</a>] &gt; 0) {
<a name="l00340"></a>00340                                                 nok ++ ;
<a name="l00341"></a>00341                                         }
<a name="l00342"></a>00342                                 }
<a name="l00343"></a>00343                                 fprintf(fg, <span class="stringliteral">"  %6.2f  :"</span>, ((<span class="keywordtype">float</span>)nok) / ((<span class="keywordtype">float</span>) N)) ;
<a name="l00344"></a>00344                         }
<a name="l00345"></a>00345                         fprintf(fg, <span class="stringliteral">"\n"</span>) ;
<a name="l00346"></a>00346                 }
<a name="l00347"></a>00347                 fprintf(fg, <span class="stringliteral">"-\n"</span>) ;
<a name="l00348"></a>00348                 fprintf(fg, <span class="stringliteral">"Mean overlap          : %f\n"</span>, mean_ov4) ;
<a name="l00349"></a>00349                 fprintf(fg, <span class="stringliteral">"Mean relative overlap : %f\n"</span>, mean_ovr4) ;
<a name="l00350"></a>00350 
<a name="l00351"></a>00351                 <span class="comment">/* Write the 4th criteria statistics */</span>
<a name="l00352"></a>00352                 
<a name="l00353"></a>00353                 fprintf(fg, <span class="stringliteral">"\n\t--\n"</span>) ;
<a name="l00354"></a>00354                 fprintf(fg,   <span class="stringliteral">"\t-          _ 5th overlap criteria (alpha sphere overlap) _         -\n"</span>) ;
<a name="l00355"></a>00355                 fprintf(fg,   <span class="stringliteral">"\t--\n\n"</span>) ;
<a name="l00356"></a>00356                 fprintf(fg,<span class="stringliteral">"           :"</span>);
<a name="l00357"></a>00357                 <span class="keywordflow">for</span>( j = 0 ; j &lt; novlp3 ; j++) {
<a name="l00358"></a>00358                                 fprintf(fg, <span class="stringliteral">"  &gt;%5.2f  :"</span>, ovlp3[j]) ;
<a name="l00359"></a>00359                 }
<a name="l00360"></a>00360                 fprintf(fg,<span class="stringliteral">"\n"</span>);
<a name="l00361"></a>00361                 fprintf(fg,<span class="stringliteral">"----"</span>);
<a name="l00362"></a>00362                 <span class="keywordflow">for</span>( j = 0 ; j &lt; novlp3 ; j++) {
<a name="l00363"></a>00363                         fprintf(fg, <span class="stringliteral">"-"</span>) ;
<a name="l00364"></a>00364                 }
<a name="l00365"></a>00365                 fprintf(fg,<span class="stringliteral">"\n"</span>);
<a name="l00366"></a>00366 
<a name="l00367"></a>00367                 <span class="keywordflow">for</span>(i = 0 ; i &lt; nranks ; i++) {
<a name="l00368"></a>00368                         fprintf(fg, <span class="stringliteral">"Rank &lt;= %2d :"</span>, ranks[i]) ;
<a name="l00369"></a>00369                         <span class="keywordflow">for</span>( j = 0 ; j &lt; novlp3 ; j++) {
<a name="l00370"></a>00370                                 nok = 0 ;
<a name="l00371"></a>00371                                 <span class="keywordflow">for</span>(k = 0 ; k &lt; par-&gt;<a class="code" href="structs__tparams.html#143ed7e330d24052d70eb0bdd4852f56">nfiles</a> ; k++) {
<a name="l00372"></a>00372                                         <span class="keywordflow">if</span>( status[k] == <a class="code" href="tpocket_8h.html#5cd6feedc59d55eefbb739b3e8546b74">M_OK</a> &amp;&amp;
<a name="l00373"></a>00373                                                 ddata[k][<a class="code" href="tpocket_8h.html#f3720a200eb98c961e42ae97d1fb2698">M_CRIT5</a>] &gt;= ovlp3[j] &amp;&amp;
<a name="l00374"></a>00374                                                 idata[k][<a class="code" href="tpocket_8h.html#de47012f24417359f7401df0e6d3b222">M_POS5</a>] &lt;= ranks[i] &amp;&amp;
<a name="l00375"></a>00375                                                 idata[k][<a class="code" href="tpocket_8h.html#de47012f24417359f7401df0e6d3b222">M_POS5</a>] &gt; 0) {
<a name="l00376"></a>00376                                                 nok ++ ;
<a name="l00377"></a>00377                                         }
<a name="l00378"></a>00378                                 }
<a name="l00379"></a>00379                                 fprintf(fg, <span class="stringliteral">"  %6.2f  :"</span>, ((<span class="keywordtype">float</span>)nok) / ((<span class="keywordtype">float</span>) N)) ;
<a name="l00380"></a>00380                         }
<a name="l00381"></a>00381                         fprintf(fg, <span class="stringliteral">"\n"</span>) ;
<a name="l00382"></a>00382                 }
<a name="l00383"></a>00383                 fprintf(fg, <span class="stringliteral">"-\n"</span>) ;
<a name="l00384"></a>00384                 fprintf(fg, <span class="stringliteral">"Mean overlap          : %f\n"</span>, mean_ov5) ;
<a name="l00385"></a>00385                 fprintf(fg, <span class="stringliteral">"Mean relative overlap : %f\n"</span>, mean_ovr5) ;
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 
<a name="l00388"></a>00388                 fprintf(fg, <span class="stringliteral">"\n\t--\n"</span>) ;
<a name="l00389"></a>00389                 fprintf(fg,   <span class="stringliteral">"\t-      _ Concensus overlap criteria (alpha sphere overlap) _       -\n"</span>) ;
<a name="l00390"></a>00390                 fprintf(fg,   <span class="stringliteral">"\t--\n\n"</span>) ;
<a name="l00391"></a>00391                 fprintf(fg, <span class="stringliteral">"   Ratio of good predictions (dist = 3A) \n"</span>) ;
<a name="l00392"></a>00392                 fprintf(fg, <span class="stringliteral">"\n"</span>) ;
<a name="l00393"></a>00393 
<a name="l00394"></a>00394                 <span class="keywordflow">for</span>(i = 0 ; i &lt; nranks ; i++) {
<a name="l00395"></a>00395                         nok = 0 ;
<a name="l00396"></a>00396                         <span class="keywordflow">for</span>(k = 0 ; k &lt; par-&gt;<a class="code" href="structs__tparams.html#143ed7e330d24052d70eb0bdd4852f56">nfiles</a> ; k++) {
<a name="l00397"></a>00397                                 <span class="keywordflow">if</span>(status[k] == <a class="code" href="tpocket_8h.html#5cd6feedc59d55eefbb739b3e8546b74">M_OK</a> &amp;&amp; idata[k][<a class="code" href="tpocket_8h.html#55c83a9eb2be092f1f272142b3714c32">M_POS6</a>] &lt;= ranks[i]
<a name="l00398"></a>00398                                 &amp;&amp; idata[k][<a class="code" href="tpocket_8h.html#55c83a9eb2be092f1f272142b3714c32">M_POS6</a>] &gt; 0) {
<a name="l00399"></a>00399                                         nok ++ ;
<a name="l00400"></a>00400                                 }
<a name="l00401"></a>00401                         }
<a name="l00402"></a>00402                         <span class="comment">//printf("%d NOK: %d, %d, %f\n", ranks[i], nok, N, ((float)nok) / ((float) N)) ;</span>
<a name="l00403"></a>00403                         fprintf(fg, <span class="stringliteral">"Rank &lt;= %2d  :\t\t%6.2f\n"</span>, ranks[i],
<a name="l00404"></a>00404                                         ((<span class="keywordtype">float</span>)nok) / ((<span class="keywordtype">float</span>) N)) ;
<a name="l00405"></a>00405                 }
<a name="l00406"></a>00406 
<a name="l00407"></a>00407                 fprintf(fg, <span class="stringliteral">"-\n"</span>) ;
<a name="l00408"></a>00408                 fprintf(fg, <span class="stringliteral">"Mean relative overlap           : %7.2f\n"</span>, mean_ovr6) ;
<a name="l00409"></a>00409                 fprintf(fg, <span class="stringliteral">"Mean pocket volume (estimation) : %10.2f\n"</span>, mean_pvol6) ;
<a name="l00410"></a>00410                 fprintf(fg, <span class="stringliteral">"Mean number of pocket atom      : %4d\n"</span>, mean_nbatm6) ;
<a name="l00411"></a>00411 
<a name="l00412"></a>00412                 fclose(fg) ;
<a name="l00413"></a>00413         }
<a name="l00414"></a>00414         <span class="keywordflow">else</span> fprintf(stdout, <span class="stringliteral">"The file %s could not be opened\n"</span>, par-&gt;<a class="code" href="structs__tparams.html#bb1ee051c4e5c66e60d68d2087b3b1ef">g_output</a>) ;
<a name="l00415"></a>00415 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="ef1f6d3f495f1245b15ee0507078f853"></a><!-- doxytag: member="tpocket.c::test_set" ref="ef1f6d3f495f1245b15ee0507078f853" args="(s_tparams *par, int i, float ddata[][M_NDDATA], int idata[][M_NIDATA])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int test_set           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs__tparams.html">s_tparams</a> *&nbsp;</td>
          <td class="paramname"> <em>par</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>ddata</em>[][M_NDDATA], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>idata</em>[][M_NIDATA]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
## FUNCTION: void test_set(s_tparams *par)<p>
## SPECIFICATION: Test fpocket for a single set of apo/complexe/ligand.<p>
## PARAMETRES: @ <a class="el" href="structs__tparams.html">s_tparams</a> *par : Parameters, contain the fpocket parameters, and the list of data set to test. @ int i : ID if the current test set. Used to fill the two following statistic arrays @ float ddata[][] : Used to store statistics for the evaluation (float) @ float idata[][] : Used to store statistics for the evaluation (integers)<p>
## RETURN: int - A flag saying whether or not the evaluation is successfull. Values: M_LIGNOTFOUND -2 M_PDBOPENFAILED -1 M_OK 0 M_NOPOCKETFOUND 1 
<p>
Load the apo form, the complexe form with ligand, and the complexe form without ligand. The complexe without ligand will allow us to get exact atoms contacted by voronoi vertices detected by fpocket on the complexe form and then detect which atoms are involved in the interaction. 
<p>Definition at line <a class="el" href="tpocket_8c-source.html#l00440">440</a> of file <a class="el" href="tpocket_8c-source.html">tpocket.c</a>.</p>

<p>References <a class="el" href="pocket_8c-source.html#l01214">c_lst_pocket_free()</a>, <a class="el" href="tpocket_8c-source.html#l00661">check_pockets()</a>, <a class="el" href="tparams_8h-source.html#l00099">s_tparams::fapo</a>, <a class="el" href="tparams_8h-source.html#l00099">s_tparams::fcomplex</a>, <a class="el" href="tparams_8h-source.html#l00099">s_tparams::fligan</a>, <a class="el" href="tparams_8h-source.html#l00115">s_tparams::fpar</a>, <a class="el" href="rpdb_8c-source.html#l00794">free_pdb_atoms()</a>, <a class="el" href="tpocket_8c-source.html#l00556">get_actual_pocket()</a>, <a class="el" href="tpocket_8c-source.html#l00601">get_actual_pocket_DEPRECATED()</a>, <a class="el" href="atom_8c-source.html#l00112">get_mol_mass_ptr()</a>, <a class="el" href="atom_8c-source.html#l00179">get_mol_volume_ptr()</a>, <a class="el" href="tparams_8h-source.html#l00111">s_tparams::keep_fpout</a>, <a class="el" href="rpdb_8h-source.html#l00076">s_pdb::latm_lig</a>, <a class="el" href="tpocket_8h-source.html#l00052">M_CRIT2_D</a>, <a class="el" href="rpdb_8h-source.html#l00050">M_DONT_KEEP_LIG</a>, <a class="el" href="rpdb_8h-source.html#l00049">M_KEEP_LIG</a>, <a class="el" href="tpocket_8h-source.html#l00079">M_LIGMASS</a>, <a class="el" href="tpocket_8h-source.html#l00095">M_LIGNOTFOUND</a>, <a class="el" href="tpocket_8h-source.html#l00080">M_LIGVOL</a>, <a class="el" href="tpocket_8h-source.html#l00098">M_NOPOCKETFOUND</a>, <a class="el" href="tpocket_8h-source.html#l00085">M_NPOCKET</a>, <a class="el" href="tpocket_8h-source.html#l00097">M_OK</a>, <a class="el" href="memhandler_8c-source.html#l00255">my_free()</a>, <a class="el" href="pocket_8h-source.html#l00092">c_lst_pockets::n_pockets</a>, <a class="el" href="rpdb_8h-source.html#l00078">s_pdb::natm_lig</a>, <a class="el" href="fparams_8h-source.html#l00141">s_fparams::nb_mcv_iter</a>, <a class="el" href="rpdb_8c-source.html#l00478">rpdb_open()</a>, <a class="el" href="rpdb_8c-source.html#l00599">rpdb_read()</a>, <a class="el" href="fpocket_8c-source.html#l00082">search_pocket()</a>, <a class="el" href="pocket_8c-source.html#l00507">set_pockets_bary()</a>, and <a class="el" href="fpout_8c-source.html#l00079">write_out_fpocket()</a>.</p>

<p>Referenced by <a class="el" href="tpocket_8c-source.html#l00082">test_fpocket()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00441"></a>00441 {
<a name="l00442"></a>00442         <a class="code" href="structs__atm.html">s_atm</a> **accpck = NULL,
<a name="l00443"></a>00443                   **accpck2 = NULL ;
<a name="l00444"></a>00444         
<a name="l00445"></a>00445         <span class="keywordtype">char</span> *fa = par-&gt;<a class="code" href="structs__tparams.html#c04974099c0ce34a0c8a4df7c91f3f43">fapo</a>[i], 
<a name="l00446"></a>00446                  *fc = par-&gt;<a class="code" href="structs__tparams.html#02f5ffbfc8da616c952b154ad889e91a">fcomplex</a>[i],
<a name="l00447"></a>00447                  *lig = par-&gt;<a class="code" href="structs__tparams.html#e613f8bd5bff9e433a427643c0127a0a">fligan</a>[i] ;
<a name="l00448"></a>00448         
<a name="l00449"></a>00449         <span class="keywordtype">int</span> naccpck = 0,
<a name="l00450"></a>00450                 naccpck2 = 0 ;
<a name="l00451"></a>00451 <span class="comment"></span>
<a name="l00452"></a>00452 <span class="comment">        /** Load the apo form, the complexe form with ligand, and the complexe form </span>
<a name="l00453"></a>00453 <span class="comment">          * without ligand. The complexe without ligand will allow us to get exact </span>
<a name="l00454"></a>00454 <span class="comment">          * atoms contacted by voronoi vertices detected by fpocket on the complexe </span>
<a name="l00455"></a>00455 <span class="comment">          * form and then detect which atoms are involved in the interaction.</span>
<a name="l00456"></a>00456 <span class="comment">         **/</span>
<a name="l00457"></a>00457         <a class="code" href="structs__pdb.html">s_pdb</a> *apdb = <a class="code" href="rpdb_8c.html#29ed3bff6fdc59fd8bf806a35c3127d7">rpdb_open</a>(fa, lig, <a class="code" href="rpdb_8h.html#067223f2b95bbd02c1861d7d45f393b7">M_DONT_KEEP_LIG</a>) ;
<a name="l00458"></a>00458         <a class="code" href="structs__pdb.html">s_pdb</a> *cpdb = <a class="code" href="rpdb_8c.html#29ed3bff6fdc59fd8bf806a35c3127d7">rpdb_open</a>(fc, lig, <a class="code" href="rpdb_8h.html#66a6a8deb20e74fd1fd4e597b46ead20">M_KEEP_LIG</a>);
<a name="l00459"></a>00459         <a class="code" href="structs__pdb.html">s_pdb</a> *cpdb_nolig = <a class="code" href="rpdb_8c.html#29ed3bff6fdc59fd8bf806a35c3127d7">rpdb_open</a>(fc, lig, <a class="code" href="rpdb_8h.html#067223f2b95bbd02c1861d7d45f393b7">M_DONT_KEEP_LIG</a>) ;
<a name="l00460"></a>00460         
<a name="l00461"></a>00461         <span class="comment">/* Check that both pdb files are opened */</span>
<a name="l00462"></a>00462         <span class="keywordflow">if</span>(! apdb || !cpdb) {
<a name="l00463"></a>00463                 fprintf(stderr, <span class="stringliteral">"!! PDB loading failed for %s-%s ligand %s... %p %p\n"</span>, 
<a name="l00464"></a>00464                                                 fc, fa, lig, apdb, cpdb) ;
<a name="l00465"></a>00465                 <span class="keywordflow">if</span>(cpdb) <a class="code" href="rpdb_8c.html#fda283d39ae56654675e9e858f5ffdea">free_pdb_atoms</a>(cpdb) ;
<a name="l00466"></a>00466                 <span class="keywordflow">if</span>(apdb) <a class="code" href="rpdb_8c.html#fda283d39ae56654675e9e858f5ffdea">free_pdb_atoms</a>(apdb) ;
<a name="l00467"></a>00467                 
<a name="l00468"></a>00468                 <span class="keywordflow">return</span> <a class="code" href="tpocket_8h.html#f1f197c848ea30563bf106ce74877e4b">M_LIGNOTFOUND</a> ;
<a name="l00469"></a>00469         }
<a name="l00470"></a>00470         
<a name="l00471"></a>00471         <span class="comment">/* Check now if the ligand have been found */</span>
<a name="l00472"></a>00472         <span class="keywordflow">if</span>(cpdb-&gt;<a class="code" href="structs__pdb.html#659b83804ffc576f1307beac00c1486b">natm_lig</a> &lt;= 0) {
<a name="l00473"></a>00473                 
<a name="l00474"></a>00474                 fprintf(stderr, <span class="stringliteral">"! Ligand '%s' not found in the complex %s...\n"</span>,
<a name="l00475"></a>00475                                                 lig, fc) ;
<a name="l00476"></a>00476                 
<a name="l00477"></a>00477                 <span class="keywordflow">return</span> <a class="code" href="tpocket_8h.html#f1f197c848ea30563bf106ce74877e4b">M_LIGNOTFOUND</a> ;
<a name="l00478"></a>00478         }
<a name="l00479"></a>00479         
<a name="l00480"></a>00480         
<a name="l00481"></a>00481         <span class="comment">/* PDBs and ligand OK, now read PDB and launch fpocket */</span>
<a name="l00482"></a>00482         
<a name="l00483"></a>00483         <span class="comment">/* Get rid of HETATM in the apo structure*/</span>
<a name="l00484"></a>00484         <a class="code" href="rpdb_8c.html#1ec399102f369c72b06a9944616715b0">rpdb_read</a>(apdb, lig, <a class="code" href="rpdb_8h.html#067223f2b95bbd02c1861d7d45f393b7">M_DONT_KEEP_LIG</a>) ;
<a name="l00485"></a>00485         <a class="code" href="rpdb_8c.html#1ec399102f369c72b06a9944616715b0">rpdb_read</a>(cpdb, lig, <a class="code" href="rpdb_8h.html#66a6a8deb20e74fd1fd4e597b46ead20">M_KEEP_LIG</a>) ;
<a name="l00486"></a>00486         <a class="code" href="rpdb_8c.html#1ec399102f369c72b06a9944616715b0">rpdb_read</a>(cpdb_nolig, lig, <a class="code" href="rpdb_8h.html#067223f2b95bbd02c1861d7d45f393b7">M_DONT_KEEP_LIG</a>) ;
<a name="l00487"></a>00487 
<a name="l00488"></a>00488         <a class="code" href="structc__lst__pockets.html">c_lst_pockets</a> *pockets = <a class="code" href="fpocket_8c.html#23faf120fcf6ef1442496cba08d4fbd1">search_pocket</a>(apdb, par-&gt;<a class="code" href="structs__tparams.html#b6b1c97feba279871d8135b46d53d457">fpar</a>,cpdb);
<a name="l00489"></a>00489         <a class="code" href="pocket_8c.html#0759e3da9e6dc6d3fd5d5cf7c3020410">set_pockets_bary</a>(pockets) ;
<a name="l00490"></a>00490         
<a name="l00491"></a>00491         <span class="comment">/* Check that at least one pocket have been found */</span>
<a name="l00492"></a>00492         <span class="keywordflow">if</span>(!pockets || pockets-&gt;<a class="code" href="structc__lst__pockets.html#c3a6d72365261579a557746bfc96aec3">n_pockets</a> &lt;= 0) {
<a name="l00493"></a>00493                 <span class="keywordflow">if</span>(pockets) <a class="code" href="pocket_8c.html#a9afcc69c1f7bdce1f22b0c48397b242">c_lst_pocket_free</a>(pockets) ;
<a name="l00494"></a>00494                 <span class="keywordflow">return</span> <a class="code" href="tpocket_8h.html#b8726dc885fede7aa6c328402b78e685">M_NOPOCKETFOUND</a> ;
<a name="l00495"></a>00495         }
<a name="l00496"></a>00496         
<a name="l00497"></a>00497         <span class="comment">/* Everything is OK, so now perform the evaluation*/</span>
<a name="l00498"></a>00498         
<a name="l00499"></a>00499         <span class="comment">/* We found pocket on the apo form get volume and mass of the ligand */</span>
<a name="l00500"></a>00500         idata[i][<a class="code" href="tpocket_8h.html#e5cbb0ee984e561f26cb5e5b3711ccd2">M_NPOCKET</a>] = pockets-&gt;<a class="code" href="structc__lst__pockets.html#c3a6d72365261579a557746bfc96aec3">n_pockets</a> ;
<a name="l00501"></a>00501         ddata[i][<a class="code" href="tpocket_8h.html#a8a643689a5895de4cfd867bfc8b447e">M_LIGMASS</a>] = <a class="code" href="atom_8c.html#6c124482d4ea1d4956cb095413e4b3af">get_mol_mass_ptr</a>(cpdb-&gt;<a class="code" href="structs__pdb.html#fe85c6dd76ee9c740d2869ee30621ea5">latm_lig</a>, cpdb-&gt;<a class="code" href="structs__pdb.html#659b83804ffc576f1307beac00c1486b">natm_lig</a>) ;
<a name="l00502"></a>00502         ddata[i][<a class="code" href="tpocket_8h.html#28cb3f177a19e81236bad5ec7d0b4f70">M_LIGVOL</a>]  = <a class="code" href="atom_8c.html#d0f577a82cfdb135f707700c2b84e6a5">get_mol_volume_ptr</a>(cpdb-&gt;<a class="code" href="structs__pdb.html#fe85c6dd76ee9c740d2869ee30621ea5">latm_lig</a>, cpdb-&gt;<a class="code" href="structs__pdb.html#659b83804ffc576f1307beac00c1486b">natm_lig</a>, 
<a name="l00503"></a>00503                                                                                          par-&gt;<a class="code" href="structs__tparams.html#b6b1c97feba279871d8135b46d53d457">fpar</a>-&gt;<a class="code" href="structs__fparams.html#8caeadbae2db7d24763497290e6b9220">nb_mcv_iter</a>);
<a name="l00504"></a>00504 
<a name="l00505"></a>00505         <span class="comment">/* Get atoms involved in the actual pocket */</span>
<a name="l00506"></a>00506         accpck = <a class="code" href="tpocket_8c.html#acc267e0329f8f2875cc0d2819bb88b8">get_actual_pocket_DEPRECATED</a>(cpdb, <a class="code" href="tpocket_8h.html#de2e7ef36ef5eb24d8adb8ab1b703b42">M_CRIT2_D</a>, &amp;naccpck) ;
<a name="l00507"></a>00507         accpck2 = <a class="code" href="tpocket_8c.html#e363bc6ecb6d690b378de02edefc02d7">get_actual_pocket</a>(cpdb, cpdb_nolig, i, par, &amp;naccpck2) ;
<a name="l00508"></a>00508 
<a name="l00509"></a>00509         fflush(stdout) ;
<a name="l00510"></a>00510         <span class="keywordflow">if</span> (naccpck2 &lt;= 0) {
<a name="l00511"></a>00511                 fprintf(stdout, <span class="stringliteral">"! Warning: actual pocket has 0 atoms!! %s %d\n"</span>, fa,
<a name="l00512"></a>00512                                                 naccpck2) ;
<a name="l00513"></a>00513         }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515         <span class="comment">/* Calculate evaluation criterias */</span>
<a name="l00516"></a>00516         <a class="code" href="tpocket_8c.html#081ca9804d0a726ea01ed54d22ea4b51">check_pockets</a>(pockets, accpck2, naccpck2, cpdb-&gt;<a class="code" href="structs__pdb.html#fe85c6dd76ee9c740d2869ee30621ea5">latm_lig</a>, cpdb-&gt;<a class="code" href="structs__pdb.html#659b83804ffc576f1307beac00c1486b">natm_lig</a>, 
<a name="l00517"></a>00517                                   accpck, naccpck, ddata, idata, i) ;
<a name="l00518"></a>00518 
<a name="l00519"></a>00519         <span class="keywordflow">if</span>(par-&gt;<a class="code" href="structs__tparams.html#bba73c22e1d59615c2e25e27d8f99543">keep_fpout</a> != 0) {
<a name="l00520"></a>00520                 <a class="code" href="fpout_8c.html#d3ae1c465f038fad47776a4e1649e995">write_out_fpocket</a>(pockets, apdb, par-&gt;<a class="code" href="structs__tparams.html#c04974099c0ce34a0c8a4df7c91f3f43">fapo</a>[i]) ;
<a name="l00521"></a>00521         }
<a name="l00522"></a>00522         <span class="comment">/* write_pdb_com(cpdb, par-&gt;fcomplex[i]) ; */</span>
<a name="l00523"></a>00523         
<a name="l00524"></a>00524         <span class="comment">/* Free memory */</span>
<a name="l00525"></a>00525         <a class="code" href="pocket_8c.html#a9afcc69c1f7bdce1f22b0c48397b242">c_lst_pocket_free</a>(pockets) ;
<a name="l00526"></a>00526         <a class="code" href="memhandler_8c.html#a49400242a007d208c641f79856ea4c6">my_free</a>(accpck) ;
<a name="l00527"></a>00527         <a class="code" href="rpdb_8c.html#fda283d39ae56654675e9e858f5ffdea">free_pdb_atoms</a>(apdb) ;
<a name="l00528"></a>00528         <a class="code" href="rpdb_8c.html#fda283d39ae56654675e9e858f5ffdea">free_pdb_atoms</a>(cpdb) ;
<a name="l00529"></a>00529         <a class="code" href="rpdb_8c.html#fda283d39ae56654675e9e858f5ffdea">free_pdb_atoms</a>(cpdb_nolig) ;
<a name="l00530"></a>00530                 
<a name="l00531"></a>00531         <span class="keywordflow">return</span> <a class="code" href="tpocket_8h.html#5cd6feedc59d55eefbb739b3e8546b74">M_OK</a> ;
<a name="l00532"></a>00532 }
</pre></div>
<p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Jun 7 16:44:23 2010 for fpocket by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
